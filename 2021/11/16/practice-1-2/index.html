<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hot5656.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"},"path":"/search.json","localsearch":{"enable":"enable","trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="Create app + layoutinstall123npx create-react-app ecommerce-frontcd ecommerce-frontyarn start">
<meta property="og:type" content="article">
<meta property="og:title" content="Practice React Ecommerce - Front End">
<meta property="og:url" content="https://hot5656.github.io/2021/11/16/practice-1-2/index.html">
<meta property="og:site_name" content="Robert 雜記">
<meta property="og:description" content="Create app + layoutinstall123npx create-react-app ecommerce-frontcd ecommerce-frontyarn start">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2021-11-16T02:16:11.000Z">
<meta property="article:modified_time" content="2022-06-09T03:38:35.433Z">
<meta property="article:author" content="Robert Kao">
<meta property="article:tag" content="react">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://hot5656.github.io/2021/11/16/practice-1-2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>
<title>Practice React Ecommerce - Front End | Robert 雜記</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Robert 雜記</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔列表</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-app-layout"><span class="nav-number">1.</span> <span class="nav-text">Create app + layout</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#install"><span class="nav-number">1.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#clear-doesn-amp-apos-t-need-files"><span class="nav-number">1.2.</span> <span class="nav-text">clear doesn&amp;apos;t need files</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-Index-js"><span class="nav-number">1.2.1.</span> <span class="nav-text">.&#x2F;src&#x2F;Index.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-App-js"><span class="nav-number">1.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;App.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Pages-layout-env"><span class="nav-number">2.</span> <span class="nav-text">add Pages + layout + env</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#install-1"><span class="nav-number">2.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#source"><span class="nav-number">2.2.</span> <span class="nav-text">source</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-public-x2F-index-html-add-bootstrapt"><span class="nav-number">2.2.1.</span> <span class="nav-text">.&#x2F;public&#x2F;index.html : add bootstrapt</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-Index-js-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;Index.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js"><span class="nav-number">2.2.3.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-user-x2F-Signup-js"><span class="nav-number">2.2.4.</span> <span class="nav-text">.&#x2F;src&#x2F;user&#x2F;Signup.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-user-x2F-Signin-js"><span class="nav-number">2.2.5.</span> <span class="nav-text">.&#x2F;src&#x2F;user&#x2F;Signin.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Home-js"><span class="nav-number">2.2.6.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Home.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Layout-js"><span class="nav-number">2.2.7.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Layout.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Menu-js"><span class="nav-number">2.2.8.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Menu.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#set-env"><span class="nav-number">2.3.</span> <span class="nav-text">set env</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-env"><span class="nav-number">2.3.1.</span> <span class="nav-text">.&#x2F;.env</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-config-js"><span class="nav-number">2.3.2.</span> <span class="nav-text">.&#x2F;src&#x2F;config.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Singup-Singin-and-Singout"><span class="nav-number">3.</span> <span class="nav-text">add Singup, Singin and Singout</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Menu-js-1"><span class="nav-number">3.1.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Menu.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-auth-x2F-index-js"><span class="nav-number">3.2.</span> <span class="nav-text">.&#x2F;src&#x2F;auth&#x2F;index.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-user-x2F-Signin-js-1"><span class="nav-number">3.3.</span> <span class="nav-text">.&#x2F;src&#x2F;user&#x2F;Signin.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-user-x2F-Signup-js-1"><span class="nav-number">3.4.</span> <span class="nav-text">.&#x2F;src&#x2F;user&#x2F;Signup.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Admin-x2F-user-Dashboard"><span class="nav-number">4.</span> <span class="nav-text">add Admin&#x2F;user Dashboard</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-1"><span class="nav-number">4.1.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Menu-js-2"><span class="nav-number">4.2.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Menu.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-user-x2F-Signin-js-2"><span class="nav-number">4.3.</span> <span class="nav-text">.&#x2F;src&#x2F;user&#x2F;Signin.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-auth-x2F-AdminAuth-js"><span class="nav-number">4.4.</span> <span class="nav-text">.&#x2F;src&#x2F;auth&#x2F;AdminAuth.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-auth-x2F-UserAuth-js"><span class="nav-number">4.5.</span> <span class="nav-text">.&#x2F;src&#x2F;auth&#x2F;UserAuth.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-AdminDashboard-js"><span class="nav-number">4.6.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;AdminDashboard.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-UserDashboard-js"><span class="nav-number">4.7.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;UserDashboard.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-category-x2F-product-show-products"><span class="nav-number">5.</span> <span class="nav-text">add category&#x2F;product + show products</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-2"><span class="nav-number">5.1.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-styles-css"><span class="nav-number">5.2.</span> <span class="nav-text">.&#x2F;src&#x2F;styles.css</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Layout-js-1"><span class="nav-number">5.3.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Layout.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Home-js-1"><span class="nav-number">5.4.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Home.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiCore-js"><span class="nav-number">5.5.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Card-js"><span class="nav-number">5.6.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Card.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-ShowImage-js"><span class="nav-number">5.7.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;ShowImage.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiAdmin-js"><span class="nav-number">5.8.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-addCategory-js"><span class="nav-number">5.9.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;addCategory.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-AddProduct-js"><span class="nav-number">5.10.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;AddProduct.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Shop-page-Category-Price-filter"><span class="nav-number">6.</span> <span class="nav-text">add Shop page + Category, Price filter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-3"><span class="nav-number">6.1.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Menu-js-3"><span class="nav-number">6.2.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Menu.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Shop-js"><span class="nav-number">6.3.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Shop.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Checkbox-js"><span class="nav-number">6.4.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Checkbox.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Radiobox-js"><span class="nav-number">6.5.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Radiobox.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-fixPrices-js"><span class="nav-number">6.6.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;fixPrices.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiCore-js-1"><span class="nav-number">6.7.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Card-js-1"><span class="nav-number">6.8.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Card.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Products-search"><span class="nav-number">7.</span> <span class="nav-text">add Products search</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#install-2"><span class="nav-number">7.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Front-End"><span class="nav-number">7.2.</span> <span class="nav-text">Front End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Home-js-2"><span class="nav-number">7.2.1.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Home.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Search-js"><span class="nav-number">7.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Search.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiCore-js-2"><span class="nav-number">7.2.3.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bakc-End"><span class="nav-number">7.3.</span> <span class="nav-text">Bakc End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-routes-x2F-product-js"><span class="nav-number">7.3.1.</span> <span class="nav-text">.&#x2F;routes&#x2F;product.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controller-x2F-product-js"><span class="nav-number">7.3.2.</span> <span class="nav-text">.&#x2F;controller&#x2F;product.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Product-Page-with-Related-Products"><span class="nav-number">8.</span> <span class="nav-text">add Product Page with Related Products</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#install-3"><span class="nav-number">8.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Front-End-1"><span class="nav-number">8.2.</span> <span class="nav-text">Front End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-4"><span class="nav-number">8.2.1.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Product-js"><span class="nav-number">8.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Product.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Card-js-2"><span class="nav-number">8.2.3.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Card.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiCore-js-3"><span class="nav-number">8.2.4.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-styles-css-1"><span class="nav-number">8.2.5.</span> <span class="nav-text">.&#x2F;src&#x2F;styles.css</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Home-js-3"><span class="nav-number">8.2.6.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Home.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Shop-js-1"><span class="nav-number">8.2.7.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Shop.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Back-End"><span class="nav-number">8.3.</span> <span class="nav-text">Back End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controller-x2F-product-js-1"><span class="nav-number">8.3.1.</span> <span class="nav-text">.&#x2F;controller&#x2F;product.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Cart"><span class="nav-number">9.</span> <span class="nav-text">add Cart</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Cart-js"><span class="nav-number">9.1.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Cart.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-5"><span class="nav-number">9.2.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Card-js-3"><span class="nav-number">9.3.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Card.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-cartHelpers-js"><span class="nav-number">9.4.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;cartHelpers.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Menu-js-4"><span class="nav-number">9.5.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Menu.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Checkbox-js-1"><span class="nav-number">9.6.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Checkbox.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x2F-src-x2F-styles-css-2"><span class="nav-number">9.7.</span> <span class="nav-text">.&#x2F;src&#x2F;styles.css</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Payment-Gateway"><span class="nav-number">10.</span> <span class="nav-text">Payment Gateway</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Back-End-1"><span class="nav-number">10.1.</span> <span class="nav-text">Back End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#install-4"><span class="nav-number">10.1.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-app-js"><span class="nav-number">10.1.2.</span> <span class="nav-text">.&#x2F;app.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-routes-x2F-braintree-js"><span class="nav-number">10.1.3.</span> <span class="nav-text">.&#x2F;routes&#x2F;braintree.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controllers-x2F-braintree-js"><span class="nav-number">10.1.4.</span> <span class="nav-text">.&#x2F;controllers&#x2F;braintree.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#env"><span class="nav-number">10.1.5.</span> <span class="nav-text">.env</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Front-End-2"><span class="nav-number">10.2.</span> <span class="nav-text">Front End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#install-5"><span class="nav-number">10.2.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Checkout-js"><span class="nav-number">10.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Checkout.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiCore-js-4"><span class="nav-number">10.2.3.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Cart-js-1"><span class="nav-number">10.2.4.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Cart.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-cartHelpers-js-1"><span class="nav-number">10.2.5.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;cartHelpers.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Order"><span class="nav-number">11.</span> <span class="nav-text">add Order</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Back-End-2"><span class="nav-number">11.1.</span> <span class="nav-text">Back End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-app-js-1"><span class="nav-number">11.1.1.</span> <span class="nav-text">.&#x2F;app.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-routes-x2F-order-js"><span class="nav-number">11.1.2.</span> <span class="nav-text">.&#x2F;routes&#x2F;order.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-models-x2F-orders-js"><span class="nav-number">11.1.3.</span> <span class="nav-text">.&#x2F;models&#x2F;orders.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controllers-x2F-order-js"><span class="nav-number">11.1.4.</span> <span class="nav-text">.&#x2F;controllers&#x2F;order.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controllers-x2F-user-js"><span class="nav-number">11.1.5.</span> <span class="nav-text">.&#x2F;controllers&#x2F;user.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controller-x2F-product-js-2"><span class="nav-number">11.1.6.</span> <span class="nav-text">.&#x2F;controller&#x2F;product.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Front-End-3"><span class="nav-number">11.2.</span> <span class="nav-text">Front End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-6"><span class="nav-number">11.2.1.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-Orders-js"><span class="nav-number">11.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;Orders.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-UserDashboard-js-1"><span class="nav-number">11.2.3.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;UserDashboard.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-Checkout-js-1"><span class="nav-number">11.2.4.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;Checkout.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiCore-js-5"><span class="nav-number">11.2.5.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiAdmin-js-1"><span class="nav-number">11.2.6.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-user-profile-user-purchase-history"><span class="nav-number">12.</span> <span class="nav-text">add user profile + user purchase history</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Back-End-3"><span class="nav-number">12.1.</span> <span class="nav-text">Back End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-routes-x2F-user-js"><span class="nav-number">12.1.1.</span> <span class="nav-text">.&#x2F;routes&#x2F;user.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controllers-x2F-order-js-1"><span class="nav-number">12.1.2.</span> <span class="nav-text">.&#x2F;controllers&#x2F;order.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controllers-x2F-user-js-1"><span class="nav-number">12.1.3.</span> <span class="nav-text">.&#x2F;controllers&#x2F;user.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Front-End-4"><span class="nav-number">12.2.</span> <span class="nav-text">Front End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-7"><span class="nav-number">12.2.1.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-UserDashboard-js-2"><span class="nav-number">12.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;UserDashboard.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-user-x2F-Profile-js"><span class="nav-number">12.2.3.</span> <span class="nav-text">.&#x2F;src&#x2F;user&#x2F;Profile.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-user-x2F-apiUser-js"><span class="nav-number">12.2.4.</span> <span class="nav-text">.&#x2F;src&#x2F;user&#x2F;apiUser.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-Manage-Orders-and-Products"><span class="nav-number">13.</span> <span class="nav-text">add Manage Orders and Products</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Back-End-4"><span class="nav-number">13.1.</span> <span class="nav-text">Back End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-controller-x2F-product-js-3"><span class="nav-number">13.1.1.</span> <span class="nav-text">.&#x2F;controller&#x2F;product.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Front-End-5"><span class="nav-number">13.2.</span> <span class="nav-text">Front End</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-AppRoutes-js-8"><span class="nav-number">13.2.1.</span> <span class="nav-text">.&#x2F;src&#x2F;AppRoutes.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-core-x2F-AdminDashboard-js-1"><span class="nav-number">13.2.2.</span> <span class="nav-text">.&#x2F;src&#x2F;core&#x2F;AdminDashboard.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ApiAdmin-js-2"><span class="nav-number">13.2.3.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-ManageProducts-js"><span class="nav-number">13.2.4.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;ManageProducts.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#x2F-src-x2F-admin-x2F-UpdateProduct-js"><span class="nav-number">13.2.5.</span> <span class="nav-text">.&#x2F;src&#x2F;admin&#x2F;UpdateProduct.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="nav-number">14.</span> <span class="nav-text">參考資料</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Robert Kao"
      src="/images/head.png">
  <p class="site-author-name" itemprop="name">Robert Kao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">170</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">66</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://hot5656.github.io/2021/11/16/practice-1-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="Robert Kao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Robert 雜記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Practice React Ecommerce - Front End
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2021-11-16 10:16:11" itemprop="dateCreated datePublished" datetime="2021-11-16T10:16:11+08:00">2021-11-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2022-06-09 11:38:35" itemprop="dateModified" datetime="2022-06-09T11:38:35+08:00">2022-06-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/11/16/practice-1-2/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/11/16/practice-1-2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>212k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>3:13</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="Create-app-layout"><a href="#Create-app-layout" class="headerlink" title="Create app + layout"></a>Create app + layout</h3><h4 id="install"><a href="#install" class="headerlink" title="install"></a>install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app ecommerce-front</span><br><span class="line"><span class="built_in">cd</span> ecommerce-front</span><br><span class="line">yarn start</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h4 id="clear-doesn-amp-apos-t-need-files"><a href="#clear-doesn-amp-apos-t-need-files" class="headerlink" title="clear doesn&amp;apos;t need files"></a>clear doesn&amp;apos;t need files</h4><h5 id="x2F-src-x2F-Index-js"><a href="#x2F-src-x2F-Index-js" class="headerlink" title=".&#x2F;src&#x2F;Index.js"></a>.&#x2F;src&#x2F;Index.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/Index.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-App-js"><a href="#x2F-src-x2F-App-js" class="headerlink" title=".&#x2F;src&#x2F;App.js"></a>.&#x2F;src&#x2F;App.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/App.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello from React<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br></pre></td></tr></table></figure>
<h3 id="add-Pages-layout-env"><a href="#add-Pages-layout-env" class="headerlink" title="add Pages + layout + env"></a>add Pages + layout + env</h3><h4 id="install-1"><a href="#install-1" class="headerlink" title="install"></a>install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install for router</span></span><br><span class="line">npm i react-router-dom</span><br><span class="line"><span class="comment"># Browserslist not support, install new version</span></span><br><span class="line"><span class="comment"># error -&gt; Browserslist: caniuse-lite is outdated. Please run:</span></span><br><span class="line"><span class="comment">#         npx browserslist@latest --update-db</span></span><br><span class="line">npx browserslist@latest --update-db</span><br><span class="line"><span class="comment"># install for env</span></span><br><span class="line">npm i dotenv</span><br></pre></td></tr></table></figure>

<h4 id="source"><a href="#source" class="headerlink" title="source"></a>source</h4><h5 id="x2F-public-x2F-index-html-add-bootstrapt"><a href="#x2F-public-x2F-index-html-add-bootstrapt" class="headerlink" title=".&#x2F;public&#x2F;index.html : add bootstrapt"></a>.&#x2F;public&#x2F;index.html : add bootstrapt</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;%PUBLIC_URL%/favicon.ico&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;theme-color&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#000000&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Web site created using create-react-app&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;%PUBLIC_URL%/logo192.png&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;manifest&quot;</span> <span class="attr">href</span>=<span class="string">&quot;%PUBLIC_URL%/manifest.json&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">integrity</span>=<span class="string">&quot;sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>React App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	......</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-Index-js-1"><a href="#x2F-src-x2F-Index-js-1" class="headerlink" title=".&#x2F;src&#x2F;Index.js"></a>.&#x2F;src&#x2F;Index.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/Index.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AppRoutes <span class="keyword">from</span> <span class="string">&quot;./AppRoutes&quot;</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">AppRoutes</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-AppRoutes-js"><a href="#x2F-src-x2F-AppRoutes-js" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="comment">// import Menu from &quot;./core/Menu&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* &lt;Menu /&gt; */</span>&#125;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-user-x2F-Signup-js"><a href="#x2F-src-x2F-user-x2F-Signup-js" class="headerlink" title=".&#x2F;src&#x2F;user&#x2F;Signup.js"></a>.&#x2F;src&#x2F;user&#x2F;Signup.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/user/Signup.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Singup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;Singup render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout title=<span class="string">&quot;Singup Page&quot;</span> description=<span class="string">&quot;Singup to Node React E-commerce &quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;&quot;</span>&gt;&#123;API&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;&#123;process.env.REACT_APP_API_URL&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-user-x2F-Signin-js"><a href="#x2F-src-x2F-user-x2F-Signin-js" class="headerlink" title=".&#x2F;src&#x2F;user&#x2F;Signin.js"></a>.&#x2F;src&#x2F;user&#x2F;Signin.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/user/Signin.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Singin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;Singin render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout title=<span class="string">&quot;Singin Page&quot;</span> description=<span class="string">&quot;Singin to Node React E-commerce &quot;</span>&gt;</span><br><span class="line">      ...</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Home-js"><a href="#x2F-src-x2F-core-x2F-Home-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Home.js"></a>.&#x2F;src&#x2F;core&#x2F;Home.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Home.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;Home render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout title=<span class="string">&quot;Home Page&quot;</span> description=<span class="string">&quot;Node React E-commerce &quot;</span>&gt;</span><br><span class="line">      ...</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Layout-js"><a href="#x2F-src-x2F-core-x2F-Layout-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Layout.js"></a>.&#x2F;src&#x2F;core&#x2F;Layout.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable react/prop-types */</span></span><br><span class="line"><span class="comment">// ./src/core/Layout.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Menu <span class="keyword">from</span> <span class="string">&quot;./Menu&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  title = <span class="string">&quot;Title&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  description = <span class="string">&quot;Destription&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  className,</span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Menu /&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;jumbotron&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;&#123;title&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;lead&quot;</span>&gt;&#123;description&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&#123;className&#125;&gt;&#123;children&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Menu-js"><a href="#x2F-src-x2F-core-x2F-Menu-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Menu.js"></a>.&#x2F;src&#x2F;core&#x2F;Menu.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Menu.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="comment">// add history, doesn&#x27;t install</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&quot;history&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isActive = <span class="function">(<span class="params">history, path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (history.location.pathname === path) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ff9900&quot;</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Menu = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// add history</span></span><br><span class="line">  <span class="keyword">const</span> history = createBrowserHistory(props);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;nav nav-tabs bg-primary&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> style=&#123;isActive(history, <span class="string">&quot;/&quot;</span>)&#125; to=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">            Home</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link</span><br><span class="line">            className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">            style=&#123;isActive(history, <span class="string">&quot;/signup&quot;</span>)&#125;</span><br><span class="line">            to=<span class="string">&quot;/signup&quot;</span></span><br><span class="line">          &gt;</span><br><span class="line">            Signup</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link</span><br><span class="line">            className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">            style=&#123;isActive(history, <span class="string">&quot;/signin&quot;</span>)&#125;</span><br><span class="line">            to=<span class="string">&quot;/signin&quot;</span></span><br><span class="line">          &gt;</span><br><span class="line">            Signin</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Menu;</span><br></pre></td></tr></table></figure>

<h4 id="set-env"><a href="#set-env" class="headerlink" title="set env"></a>set env</h4><h5 id="x2F-env"><a href="#x2F-env" class="headerlink" title=".&#x2F;.env"></a>.&#x2F;.env</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REACT_APP_API_URL=http://localhost:8000/api</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-config-js"><a href="#x2F-src-x2F-config-js" class="headerlink" title=".&#x2F;src&#x2F;config.js"></a>.&#x2F;src&#x2F;config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> API = process.env.REACT_APP_API_URL;</span><br></pre></td></tr></table></figure>

<h3 id="add-Singup-Singin-and-Singout"><a href="#add-Singup-Singin-and-Singout" class="headerlink" title="add Singup, Singin and Singout"></a>add Singup, Singin and Singout</h3><h4 id="x2F-src-x2F-core-x2F-Menu-js-1"><a href="#x2F-src-x2F-core-x2F-Menu-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Menu.js"></a>.&#x2F;src&#x2F;core&#x2F;Menu.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Menu.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link, useNavigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="comment">// add history, doesn&#x27;t install</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&quot;history&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signout, isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isActive = <span class="function">(<span class="params">history, path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (history.location.pathname === path) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ff9900&quot;</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Menu = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// add history</span></span><br><span class="line">  <span class="keyword">const</span> history = createBrowserHistory(props);</span><br><span class="line">  <span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSignout = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 指執行 callback function next</span></span><br><span class="line">    signout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      navigate(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// console.log(&quot;Manu render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;nav nav-tabs bg-primary&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> style=&#123;isActive(history, <span class="string">&quot;/&quot;</span>)&#125; to=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">            Home</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">        &#123;!isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;Fragment&gt;</span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signup&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signup&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signup</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signin&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signin&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signin</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/Fragment&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &#123;<span class="comment">/* 因直接執行而不是切到另一頁,使用 span 即可 */</span>&#125;</span><br><span class="line">            &lt;span</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;&#123; <span class="attr">cursor</span>: <span class="string">&quot;pointer&quot;</span>, <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;&#125;</span><br><span class="line">              onClick=&#123;handleSignout&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              Signout</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Menu;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-auth-x2F-index-js"><a href="#x2F-src-x2F-auth-x2F-index-js" class="headerlink" title=".&#x2F;src&#x2F;auth&#x2F;index.js"></a>.&#x2F;src&#x2F;auth&#x2F;index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/auth/index.js</span></span><br><span class="line"><span class="comment">// import &#123; getNodeText &#125; from &quot;@testing-library/react&quot;;</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> signup = <span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/signup`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(user),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      <span class="comment">// then 處理, 若有 check data 要加 retuen</span></span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;data:&quot;, data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> signin = <span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/signin`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(user),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      <span class="comment">// then 處理, 若有 check data 要加 retuen</span></span><br><span class="line">      <span class="comment">// .then((data) =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//   console.log(&quot;data:&quot;, data);</span></span><br><span class="line">      <span class="comment">//   return data;</span></span><br><span class="line">      <span class="comment">// &#125;)</span></span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> authenticate = <span class="function">(<span class="params">data, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;jwt&quot;</span>, <span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> signout = <span class="function">(<span class="params">next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.removeItem(<span class="string">&quot;jwt&quot;</span>);</span><br><span class="line">    next();</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/signout`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      <span class="comment">// .then((response) =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//   console.log(&quot;signout&quot;, response);</span></span><br><span class="line">      <span class="comment">// &#125;)</span></span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="built_in">console</span>.log(err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">			&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isAuthenticated = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;jwt&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;jwt&quot;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [DOM] Input elements should have autocomplete attributes (suggested: &quot;current-password&quot;): (More info: https://goo.gl/9p2vKq)</span></span><br><span class="line"><span class="comment">/* &lt;input type=&quot;password&quot; name=&quot;password&quot; autocomplete=&quot;on&quot;&gt;&lt;/input&gt; */</span></span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-user-x2F-Signin-js-1"><a href="#x2F-src-x2F-user-x2F-Signin-js-1" class="headerlink" title=".&#x2F;src&#x2F;user&#x2F;Signin.js"></a>.&#x2F;src&#x2F;user&#x2F;Signin.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/user/Signin.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// v6 change Redirect to Navigate</span></span><br><span class="line"><span class="keyword">import</span> &#123; Navigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signin, authenticate &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Singin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    email: <span class="string">&quot;key6@gmail.com&quot;</span>,</span><br><span class="line">    password: <span class="string">&quot;rrrrrr5&quot;</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    redirectToReferrer: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; email, password, error, loading, redirectToReferrer &#125; = values;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      [e.target.name]: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSubmit</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line"></span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      loading: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// catch 傳回用 .then 處理</span></span><br><span class="line">    signin(&#123; email, password &#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// undefidata === undefined 表 server 未回應</span></span><br><span class="line">      <span class="keyword">if</span> (data === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;Server not response&quot;);</span></span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: <span class="string">&quot;Server not response&quot;</span>,</span><br><span class="line">          loading: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">          loading: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;data:&quot;, data);</span></span><br><span class="line">        authenticate(data, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setValues(&#123;</span><br><span class="line">            ...values,</span><br><span class="line">            error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            redirectToReferrer: <span class="literal">true</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> signInForm = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;form&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Email&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;email&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;email&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Password&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;password&quot;</span></span><br><span class="line">          type=<span class="string">&quot;password&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;password&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleSubmit&#125; className=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><br><span class="line">        Submit</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: error ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;error&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> showLoading = <span class="function">() =&gt;</span></span><br><span class="line">    loading &amp;&amp; (</span><br><span class="line">      &lt;div className=<span class="string">&quot;alert alert-info&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;Loading...&lt;/h2&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> redirectUser = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (redirectToReferrer) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Singup Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Singup to Node React E-commerce&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container col-md-6 col-md-3&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &#123;showError()&#125;</span><br><span class="line">      &#123;showLoading()&#125;</span><br><span class="line">      &#123;signInForm()&#125;</span><br><span class="line">      &#123;redirectUser()&#125;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-user-x2F-Signup-js-1"><a href="#x2F-src-x2F-user-x2F-Signup-js-1" class="headerlink" title=".&#x2F;src&#x2F;user&#x2F;Signup.js"></a>.&#x2F;src&#x2F;user&#x2F;Signup.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ./src/user/Signup.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signup &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Singup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    email: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    password: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    success: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; name, email, password, error, success &#125; = values;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      [e.target.name]: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSubmit</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="comment">// catch 傳回用 .then 處理</span></span><br><span class="line">    signup(&#123; name, email, password &#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// undefidata === undefined 表 server 未回應</span></span><br><span class="line">      <span class="keyword">if</span> (data === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;Server not response&quot;);</span></span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: <span class="string">&quot;Server not response&quot;</span>,</span><br><span class="line">          success: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">          success: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          email: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          password: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          success: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> signUpForm = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;form&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Name&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;name&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;name&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Email&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;email&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;email&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Password&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;password&quot;</span></span><br><span class="line">          type=<span class="string">&quot;password&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;password&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleSubmit&#125; className=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><br><span class="line">        Submit</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: error ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;error&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> showSuccess = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-info&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: success ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      New acount is coreated. Please &lt;Link to=<span class="string">&quot;/signin&quot;</span>&gt;Sigin&lt;/Link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Singup Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Singup to Node React E-commerce&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container col-md-6 col-md-3&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &#123;showError()&#125;</span><br><span class="line">      &#123;showSuccess()&#125;</span><br><span class="line">      &#123;signUpForm()&#125;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="add-Admin-x2F-user-Dashboard"><a href="#add-Admin-x2F-user-Dashboard" class="headerlink" title="add Admin&#x2F;user Dashboard"></a>add Admin&#x2F;user Dashboard</h3><h4 id="x2F-src-x2F-AppRoutes-js-1"><a href="#x2F-src-x2F-AppRoutes-js-1" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-Menu-js-2"><a href="#x2F-src-x2F-core-x2F-Menu-js-2" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Menu.js"></a>.&#x2F;src&#x2F;core&#x2F;Menu.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Menu.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link, useNavigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="comment">// add history, doesn&#x27;t install</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&quot;history&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signout, isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isActive = <span class="function">(<span class="params">history, path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (history.location.pathname === path) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ff9900&quot;</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Menu = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// add history</span></span><br><span class="line">  <span class="keyword">const</span> history = createBrowserHistory(props);</span><br><span class="line">  <span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSignout = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 指執行 callback function next</span></span><br><span class="line">    signout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      navigate(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// console.log(&quot;Manu render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;nav nav-tabs bg-primary&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> style=&#123;isActive(history, <span class="string">&quot;/&quot;</span>)&#125; to=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">            Home</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; isAuthenticated().user.role === <span class="number">0</span> &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &lt;Link</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;isActive(history, <span class="string">&quot;/user/dashboard&quot;</span>)&#125;</span><br><span class="line">              to=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              Dashboard</span><br><span class="line">            &lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line"></span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; isAuthenticated().user.role === <span class="number">1</span> &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &lt;Link</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;isActive(history, <span class="string">&quot;/admin/dashboard&quot;</span>)&#125;</span><br><span class="line">              to=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              Dashboard</span><br><span class="line">            &lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line"></span><br><span class="line">        &#123;!isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;Fragment&gt;</span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signup&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signup&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signup</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signin&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signin&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signin</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/Fragment&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &#123;<span class="comment">/* 因直接執行而不是切到另一頁,使用 span 即可 */</span>&#125;</span><br><span class="line">            &lt;span</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;&#123; <span class="attr">cursor</span>: <span class="string">&quot;pointer&quot;</span>, <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;&#125;</span><br><span class="line">              onClick=&#123;handleSignout&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              Signout</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Menu;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-user-x2F-Signin-js-2"><a href="#x2F-src-x2F-user-x2F-Signin-js-2" class="headerlink" title=".&#x2F;src&#x2F;user&#x2F;Signin.js"></a>.&#x2F;src&#x2F;user&#x2F;Signin.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/user/Signin.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// v6 change Redirect to Navigate</span></span><br><span class="line"><span class="keyword">import</span> &#123; Navigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signin, authenticate, isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Singin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    email: <span class="string">&quot;key6@gmail.com&quot;</span>,</span><br><span class="line">    password: <span class="string">&quot;rrrrrr5&quot;</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    redirectToReferrer: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; email, password, error, loading, redirectToReferrer &#125; = values;</span><br><span class="line">  <span class="keyword">const</span> &#123; user &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      [e.target.name]: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSubmit</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line"></span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      loading: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// catch 傳回用 .then 處理</span></span><br><span class="line">    signin(&#123; email, password &#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// undefidata === undefined 表 server 未回應</span></span><br><span class="line">      <span class="keyword">if</span> (data === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;Server not response&quot;);</span></span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: <span class="string">&quot;Server not response&quot;</span>,</span><br><span class="line">          loading: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">          loading: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;data:&quot;, data);</span></span><br><span class="line">        authenticate(data, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setValues(&#123;</span><br><span class="line">            ...values,</span><br><span class="line">            error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            redirectToReferrer: <span class="literal">true</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> signInForm = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;form&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Email&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;email&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;email&#125;</span><br><span class="line">          autoComplete=<span class="string">&quot;email&quot;</span></span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Password&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;password&quot;</span></span><br><span class="line">          type=<span class="string">&quot;password&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;password&#125;</span><br><span class="line">          autoComplete=<span class="string">&quot;new-password&quot;</span></span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleSubmit&#125; className=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><br><span class="line">        Submit</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: error ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;error&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> showLoading = <span class="function">() =&gt;</span></span><br><span class="line">    loading &amp;&amp; (</span><br><span class="line">      &lt;div className=<span class="string">&quot;alert alert-info&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;Loading...&lt;/h2&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> redirectUser = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (redirectToReferrer) &#123;</span><br><span class="line">      <span class="keyword">if</span> (user &amp;&amp; user.role === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/admin/dashboard&quot;</span> /&gt;</span></span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/user/dashboard&quot;</span> /&gt;</span></span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// loggin already, redirect to /</span></span><br><span class="line">    <span class="keyword">if</span> (isAuthenticated()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Singup Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Singup to Node React E-commerce&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container col-md-6 col-md-3&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &#123;showError()&#125;</span><br><span class="line">      &#123;showLoading()&#125;</span><br><span class="line">      &#123;signInForm()&#125;</span><br><span class="line">      &#123;redirectUser()&#125;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-auth-x2F-AdminAuth-js"><a href="#x2F-src-x2F-auth-x2F-AdminAuth-js" class="headerlink" title=".&#x2F;src&#x2F;auth&#x2F;AdminAuth.js"></a>.&#x2F;src&#x2F;auth&#x2F;AdminAuth.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/auth/AdminAuth.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Navigate, useLocation &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check children: JSX.Element</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AdimnRequireAuth</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  children: JSX.Element,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> location = useLocation();</span><br><span class="line">  <span class="keyword">if</span> (!isAuthenticated() || isAuthenticated().user.role !== <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;not isAuthenticated&quot;</span>);</span><br><span class="line">    <span class="comment">// Redirect them to the /login page, but save the current location they were</span></span><br><span class="line">    <span class="comment">// trying to go to when they were redirected. This allows us to send them</span></span><br><span class="line">    <span class="comment">// along to that page after they login, which is a nicer user experience</span></span><br><span class="line">    <span class="comment">// than dropping them off on the home page.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/signin&quot;</span> <span class="attr">state</span>=<span class="string">&#123;&#123;</span> <span class="attr">from:</span> <span class="attr">location</span> &#125;&#125; /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-auth-x2F-UserAuth-js"><a href="#x2F-src-x2F-auth-x2F-UserAuth-js" class="headerlink" title=".&#x2F;src&#x2F;auth&#x2F;UserAuth.js"></a>.&#x2F;src&#x2F;auth&#x2F;UserAuth.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/auth/UserAuth.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Navigate, useLocation &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check children: JSX.Element</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UserRequireAuth</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  children: JSX.Element,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> location = useLocation();</span><br><span class="line">  <span class="keyword">if</span> (!isAuthenticated()) &#123;</span><br><span class="line">    <span class="comment">// Redirect them to the /login page, but save the current location they were</span></span><br><span class="line">    <span class="comment">// trying to go to when they were redirected. This allows us to send them</span></span><br><span class="line">    <span class="comment">// along to that page after they login, which is a nicer user experience</span></span><br><span class="line">    <span class="comment">// than dropping them off on the home page.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/signin&quot;</span> <span class="attr">state</span>=<span class="string">&#123;&#123;</span> <span class="attr">from:</span> <span class="attr">location</span> &#125;&#125; /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-AdminDashboard-js"><a href="#x2F-src-x2F-core-x2F-AdminDashboard-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;AdminDashboard.js"></a>.&#x2F;src&#x2F;core&#x2F;AdminDashboard.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/AdminDashboard.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AdmintDashboard</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    user: &#123; name, email, role &#125;,</span><br><span class="line">  &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> adminLinks = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;Admin Links&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/create/category&quot;</span>&gt;</span><br><span class="line">            Create Category</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/create/product&quot;</span>&gt;</span><br><span class="line">            Create Product</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> adminInfo = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;&#123;<span class="string">`G&#x27;Day <span class="subst">$&#123;name&#125;</span>!`</span>&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;name&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;email&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &#123;role === <span class="number">1</span> ? <span class="string">&quot;Admin&quot;</span> : <span class="string">&quot;Registrred User&quot;</span>&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Dashboard Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;User Dashboard&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-3&quot;</span>&gt;&#123;adminLinks()&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-9&quot;</span>&gt;&#123;adminInfo()&#125;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-UserDashboard-js"><a href="#x2F-src-x2F-core-x2F-UserDashboard-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;UserDashboard.js"></a>.&#x2F;src&#x2F;core&#x2F;UserDashboard.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/UserDashboard.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UsertDashboard</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    user: &#123; name, email, role &#125;,</span><br><span class="line">  &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userLinks = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;User Links&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/cart&quot;</span>&gt;</span><br><span class="line">            My Cart</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/profile/update&quot;</span>&gt;</span><br><span class="line">            Update Profile</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;&#123;<span class="string">`G&#x27;Day <span class="subst">$&#123;name&#125;</span>!`</span>&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;name&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;email&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &#123;role === <span class="number">1</span> ? <span class="string">&quot;Admin&quot;</span> : <span class="string">&quot;Registrred User&quot;</span>&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> purchaseHistory = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;histtory&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Dashboard Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;User Dashboard&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &#123;<span class="comment">/* &lt;div className=&quot;card md-5&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;h3 className=&quot;card-header&quot;&gt;User Information&lt;/h3&gt;</span></span><br><span class="line"><span class="comment">        &lt;ul className=&quot;list-group&quot;&gt;</span></span><br><span class="line"><span class="comment">          &lt;li className=&quot;list-group-item&quot;&gt;&#123;name&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">          &lt;li className=&quot;list-group-item&quot;&gt;&#123;email&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">          &lt;li className=&quot;list-group-item&quot;&gt;</span></span><br><span class="line"><span class="comment">            &#123;role === 1 ? &quot;Admin&quot; : &quot;Registrred User&quot;&#125;</span></span><br><span class="line"><span class="comment">          &lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">      &lt;/div&gt; */</span>&#125;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* &lt;div className=&quot;card md-5&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;h3 className=&quot;card-header&quot;&gt;Purchase history&lt;/h3&gt;</span></span><br><span class="line"><span class="comment">        &lt;ul className=&quot;list-group&quot;&gt;</span></span><br><span class="line"><span class="comment">          &lt;li className=&quot;list-group-item&quot;&gt;histtory&lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">      &lt;/div&gt; */</span>&#125;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-3&quot;</span>&gt;&#123;userLinks()&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-9&quot;</span>&gt;</span><br><span class="line">          &#123;userInfo()&#125;</span><br><span class="line">          &#123;purchaseHistory()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="add-category-x2F-product-show-products"><a href="#add-category-x2F-product-show-products" class="headerlink" title="add category&#x2F;product + show products"></a>add category&#x2F;product + show products</h3><h4 id="x2F-src-x2F-AppRoutes-js-2"><a href="#x2F-src-x2F-AppRoutes-js-2" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddCategory <span class="keyword">from</span> <span class="string">&quot;./admin/AddCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddProduct <span class="keyword">from</span> <span class="string">&quot;./admin/AddProduct&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/category&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddCategory /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/product&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-styles-css"><a href="#x2F-src-x2F-styles-css" class="headerlink" title=".&#x2F;src&#x2F;styles.css"></a>.&#x2F;src&#x2F;styles.css</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ./src/styles.css */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* board radis </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span>,</span><br><span class="line"><span class="selector-class">.jumbotron</span>,</span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* product image on card </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.product-img</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* jumbotron animation</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.jumbotron</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30</span>wh;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30vh</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(-<span class="number">45deg</span>, <span class="number">#ee7752</span>, <span class="number">#e73c7e</span>, <span class="number">#23a6d5</span>, <span class="number">#23d5ab</span>);</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">400%</span> <span class="number">400%</span>;</span><br><span class="line">  -webkit-<span class="attribute">animation</span>: Gradient <span class="number">15s</span> ease infinite;</span><br><span class="line">  -moz-<span class="attribute">animation</span>: Gradient <span class="number">15s</span> ease infinite;</span><br><span class="line">  <span class="attribute">animation</span>: Gradient <span class="number">15s</span> ease infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> Gradient &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">100%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@-moz-keyframes</span> Gradient &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">100%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> Gradient &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">100%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-Layout-js-1"><a href="#x2F-src-x2F-core-x2F-Layout-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Layout.js"></a>.&#x2F;src&#x2F;core&#x2F;Layout.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Layout.js</span></span><br><span class="line"><span class="comment">/* eslint-disable react/prop-types */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Menu <span class="keyword">from</span> <span class="string">&quot;./Menu&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;../styles.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  title = <span class="string">&quot;Title&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  description = <span class="string">&quot;Destription&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  className,</span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;Layout render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Menu /&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;jumbotron&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;&#123;title&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;lead&quot;</span>&gt;&#123;description&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&#123;className&#125;&gt;&#123;children&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-Home-js-1"><a href="#x2F-src-x2F-core-x2F-Home-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Home.js"></a>.&#x2F;src&#x2F;core&#x2F;Home.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Home.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getProducts &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [productsBySell, setProductsBySell] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [productsByArrival, setProductsByArrival] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadProductsBySell = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getProducts(<span class="string">&quot;sold&quot;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProductsBySell(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadProductsByArrival = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getProducts(<span class="string">&quot;createdAt&quot;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProductsByArrival(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loadProductsBySell();</span><br><span class="line">    loadProductsByArrival();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Home Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Node React E-commerce&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Best Selles&lt;/h2&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &#123;productsBySell.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;Card key=&#123;i&#125; product=&#123;product&#125; /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;New Arrival&lt;/h2&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &#123;productsByArrival.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;Card key=&#123;i&#125; product=&#123;product&#125; /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-admin-x2F-ApiCore-js"><a href="#x2F-src-x2F-admin-x2F-ApiCore-js" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiCore.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiCore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProducts = <span class="function">(<span class="params">sortBy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products?sortBy=<span class="subst">$&#123;sortBy&#125;</span>&amp;order=desc&amp;limit=6`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-Card-js"><a href="#x2F-src-x2F-core-x2F-Card-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Card.js"></a>.&#x2F;src&#x2F;core&#x2F;Card.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Card.js</span></span><br><span class="line"><span class="comment">/* eslint-disable react/prop-types */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ShowImage <span class="keyword">from</span> <span class="string">&quot;./ShowImage&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Card</span>(<span class="params">&#123; product &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;col-4 mb-3&quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;card-header&quot;</span>&gt;&#123;product.name&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;card-body&quot;</span>&gt;</span><br><span class="line">          &lt;ShowImage item=&#123;product&#125; url=<span class="string">&quot;product&quot;</span> /&gt;</span><br><span class="line">          &lt;p&gt;&#123;product.description&#125;&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;$&#123;product.price&#125;&lt;/p&gt;</span><br><span class="line">          &lt;Link to=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">            &lt;button className=<span class="string">&quot;btn btn-outline-primary mt-2 mb-2 mr-2&quot;</span>&gt;</span><br><span class="line">              View Product</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">          &lt;button className=<span class="string">&quot;btn btn-outline-warning mt-2 mb-2&quot;</span>&gt;</span><br><span class="line">            Add to card</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-ShowImage-js"><a href="#x2F-src-x2F-core-x2F-ShowImage-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;ShowImage.js"></a>.&#x2F;src&#x2F;core&#x2F;ShowImage.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/ShowImage.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">ShowImage</span>(<span class="params">&#123; item, url &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;product-img&quot;</span>&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        src=&#123;<span class="string">`<span class="subst">$&#123;API&#125;</span>/<span class="subst">$&#123;url&#125;</span>/photo/<span class="subst">$&#123;item._id&#125;</span>`</span>&#125;</span><br><span class="line">        alt=&#123;item.name&#125;</span><br><span class="line">        <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mb-3&quot;</span></span><br><span class="line">        style=&#123;&#123; <span class="attr">maxHeight</span>: <span class="string">&quot;100%&quot;</span>, <span class="attr">maxWidth</span>: <span class="string">&quot;100%&quot;</span> &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-admin-x2F-ApiAdmin-js"><a href="#x2F-src-x2F-admin-x2F-ApiAdmin-js" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiAdmin.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createCategory = <span class="function">(<span class="params">userId, token, category</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/category/create/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(category),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createProduct = <span class="function">(<span class="params">userId, token, product</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/create/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: product,</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-admin-x2F-addCategory-js"><a href="#x2F-src-x2F-admin-x2F-addCategory-js" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;addCategory.js"></a>.&#x2F;src&#x2F;admin&#x2F;addCategory.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ./src/admin/addCategory.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createCategory &#125; <span class="keyword">from</span> <span class="string">&quot;./ApiAdmin&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AddCategory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    success: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// destructure user and token from localStorage</span></span><br><span class="line">  <span class="keyword">const</span> &#123; user, token &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; name, error, success &#125; = values;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      [e.target.name]: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSubmit</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line"></span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      success: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make request to api to create category</span></span><br><span class="line">    createCategory(user._id, token, &#123; name &#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          success: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> newCategoryForm = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Name&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;name&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;name&#125;</span><br><span class="line">          autoFocus</span><br><span class="line">          required</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button className=<span class="string">&quot;btn btn-outline-primary&quot;</span>&gt;Create Category&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showSuccess = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (success) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&quot;text-success&quot;</span>&gt;</span>&#123;name&#125; is created<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&quot;text-danger&quot;</span>&gt;</span>Category should be unique<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> goBack = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;mt-5&quot;</span>&gt;</span><br><span class="line">      &lt;Link to=<span class="string">&quot;/admin/dashboard&quot;</span> className=<span class="string">&quot;text-warning&quot;</span>&gt;</span><br><span class="line">        Back to DashBoard</span><br><span class="line">      &lt;/Link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Add a new category&quot;</span></span><br><span class="line">      description=&#123;<span class="string">`G&#x27;day <span class="subst">$&#123;user.name&#125;</span>, ready to add a category?`</span>&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-md-8 offset-md-2&quot;</span>&gt;</span><br><span class="line">          &#123;showSuccess()&#125;</span><br><span class="line">          &#123;showError()&#125;</span><br><span class="line">          &#123;newCategoryForm()&#125;</span><br><span class="line">          &#123;goBack()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-admin-x2F-AddProduct-js"><a href="#x2F-src-x2F-admin-x2F-AddProduct-js" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;AddProduct.js"></a>.&#x2F;src&#x2F;admin&#x2F;AddProduct.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ./src/admin/AddProduct.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createProduct, getCategories &#125; <span class="keyword">from</span> <span class="string">&quot;./ApiAdmin&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AddProduct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    description: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    price: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    categories: [],</span><br><span class="line">    shipping: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    quantity: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    photo: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    createdProduct: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    redirectToProfile: <span class="literal">false</span>,</span><br><span class="line">    formData: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// destructure user and token from localStorage</span></span><br><span class="line">  <span class="keyword">const</span> &#123; user, token &#125; = isAuthenticated();</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    name,</span><br><span class="line">    description,</span><br><span class="line">    price,</span><br><span class="line">    categories,</span><br><span class="line">    <span class="comment">// shipping,</span></span><br><span class="line">    quantity,</span><br><span class="line">    <span class="comment">// photo,</span></span><br><span class="line">    loading,</span><br><span class="line">    error,</span><br><span class="line">    createdProduct,</span><br><span class="line">    <span class="comment">// redirectToProfile,</span></span><br><span class="line">    formData,</span><br><span class="line">  &#125; = values;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load categories and set from data.error</span></span><br><span class="line">  <span class="keyword">const</span> init = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getCategories().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(&quot;****data:&quot;, data);</span></span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// FormData 可建立表單資料中的欄位/值建立相對應的的鍵/值對（key/value）集合</span></span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          <span class="comment">// 移除 含 data 欄位</span></span><br><span class="line">          categories: data,</span><br><span class="line">          formData: <span class="keyword">new</span> FormData(),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">// FormData 可建立表單資料中的欄位/值建立相對應的的鍵/值對（key/value）集合</span></span><br><span class="line">    <span class="comment">// setValues(&#123; ...values, formData: new FormData() &#125;);</span></span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> name = e.target.name;</span><br><span class="line">    <span class="keyword">const</span> value = name === <span class="string">&quot;photo&quot;</span> ? e.target.files[<span class="number">0</span>] : e.target.value;</span><br><span class="line">    <span class="comment">// set formData&#x27;s velue</span></span><br><span class="line">    formData.set(name, value);</span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      [e.target.name]: value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSubmit</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line"></span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      loading: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    createProduct(user._id, token, formData).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          description: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          price: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          quantity: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          photo: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          loading: <span class="literal">false</span>,</span><br><span class="line">          createdProduct: data.name,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// // 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> newProductForm = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;handleSubmit&#125; className=<span class="string">&quot;mb-3&quot;</span>&gt;</span><br><span class="line">      &lt;h4&gt;Post Photo&lt;/h4&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;btn btn-secondary&quot;</span>&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            id=<span class="string">&quot;photo_uploades&quot;</span></span><br><span class="line">            onChange=&#123;handleChange&#125;</span><br><span class="line">            name=<span class="string">&quot;photo&quot;</span></span><br><span class="line">            type=<span class="string">&quot;file&quot;</span></span><br><span class="line">            accepr=<span class="string">&quot;image/*&quot;</span></span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Name&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;name&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;name&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Description&lt;/label&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;description&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;description&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Price&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;price&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;price&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Category&lt;/label&gt;</span><br><span class="line">        &lt;select</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;category&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          &#123;<span class="comment">/* &lt;option value=&quot;618cccaac104434a41b7e4e7&quot;&gt;Node&lt;/option&gt;</span></span><br><span class="line"><span class="comment">          &lt;option value=&quot;618d2aeb3cc4d2fb8b0ffa6c&quot;&gt;python&lt;/option&gt; */</span>&#125;</span><br><span class="line">          &lt;option&gt;Please select&lt;/option&gt;</span><br><span class="line">          &#123;categories &amp;&amp;</span><br><span class="line">            categories.map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> (</span><br><span class="line">              &lt;option key=&#123;i&#125; value=&#123;c._id&#125;&gt;</span><br><span class="line">                &#123;c.name&#125;</span><br><span class="line">              &lt;/option&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Shipping&lt;/label&gt;</span><br><span class="line">        &lt;select</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;shipping&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          &lt;option&gt;Please select&lt;/option&gt;</span><br><span class="line">          &lt;option value=<span class="string">&quot;0&quot;</span>&gt;No&lt;/option&gt;</span><br><span class="line">          &lt;option value=<span class="string">&quot;1&quot;</span>&gt;Yes&lt;/option&gt;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Quantity&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;quantity&quot;</span></span><br><span class="line">          type=<span class="string">&quot;number&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;quantity&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button className=<span class="string">&quot;btn btn-outline-primary&quot;</span>&gt;Create Product&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: error ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;error&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showSuccess = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-info&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: createdProduct ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;h2&gt;&#123;<span class="string">`<span class="subst">$&#123;createdProduct&#125;</span>`</span>&#125; is created&lt;/h2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showLoading = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loading &amp;&amp; (</span><br><span class="line">      &lt;div className=<span class="string">&quot;alert alert-success&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;Loading...&lt;/h2&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Add a new product&quot;</span></span><br><span class="line">      description=&#123;<span class="string">`G&#x27;day <span class="subst">$&#123;user.name&#125;</span>, ready to add a product?`</span>&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-md-8 offset-md-2&quot;</span>&gt;</span><br><span class="line">          &#123;showLoading()&#125;</span><br><span class="line">          &#123;showSuccess()&#125;</span><br><span class="line">          &#123;showError()&#125;</span><br><span class="line">          &#123;newProductForm()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="add-Shop-page-Category-Price-filter"><a href="#add-Shop-page-Category-Price-filter" class="headerlink" title="add Shop page + Category, Price filter"></a>add Shop page + Category, Price filter</h3><h4 id="x2F-src-x2F-AppRoutes-js-3"><a href="#x2F-src-x2F-AppRoutes-js-3" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddCategory <span class="keyword">from</span> <span class="string">&quot;./admin/AddCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddProduct <span class="keyword">from</span> <span class="string">&quot;./admin/AddProduct&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Shop <span class="keyword">from</span> <span class="string">&quot;./core/Shop&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/shop&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Shop</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/category&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddCategory /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/product&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="x2F-src-x2F-core-x2F-Menu-js-3"><a href="#x2F-src-x2F-core-x2F-Menu-js-3" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Menu.js"></a>.&#x2F;src&#x2F;core&#x2F;Menu.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Menu.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link, useNavigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="comment">// add history, doesn&#x27;t install</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&quot;history&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signout, isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isActive = <span class="function">(<span class="params">history, path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (history.location.pathname === path) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ff9900&quot;</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Menu = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// add history</span></span><br><span class="line">  <span class="keyword">const</span> history = createBrowserHistory(props);</span><br><span class="line">  <span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSignout = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 指執行 callback function next</span></span><br><span class="line">    signout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      navigate(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// console.log(&quot;Manu render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;nav nav-tabs bg-primary&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> style=&#123;isActive(history, <span class="string">&quot;/&quot;</span>)&#125; to=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">            Home</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link</span><br><span class="line">            className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">            style=&#123;isActive(history, <span class="string">&quot;/shop&quot;</span>)&#125;</span><br><span class="line">            to=<span class="string">&quot;/shop&quot;</span></span><br><span class="line">          &gt;</span><br><span class="line">            Shop</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; isAuthenticated().user.role === <span class="number">0</span> &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &lt;Link</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;isActive(history, <span class="string">&quot;/user/dashboard&quot;</span>)&#125;</span><br><span class="line">              to=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              Dashboard</span><br><span class="line">            &lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line"></span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; isAuthenticated().user.role === <span class="number">1</span> &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &lt;Link</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;isActive(history, <span class="string">&quot;/admin/dashboard&quot;</span>)&#125;</span><br><span class="line">              to=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              Dashboard</span><br><span class="line">            &lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line"></span><br><span class="line">        &#123;!isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;Fragment&gt;</span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signup&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signup&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signup</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signin&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signin&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signin</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/Fragment&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &#123;<span class="comment">/* 因直接執行而不是切到另一頁,使用 span 即可 */</span>&#125;</span><br><span class="line">            &lt;span</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;&#123; <span class="attr">cursor</span>: <span class="string">&quot;pointer&quot;</span>, <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;&#125;</span><br><span class="line">              onClick=&#123;handleSignout&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              Signout</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Menu;</span><br></pre></td></tr></table></figure>


<h4 id="x2F-src-x2F-core-x2F-Shop-js"><a href="#x2F-src-x2F-core-x2F-Shop-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Shop.js"></a>.&#x2F;src&#x2F;core&#x2F;Shop.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Shop.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCategories, getFilteredProducts &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Checkbox <span class="keyword">from</span> <span class="string">&quot;./Checkbox&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Radiobox <span class="keyword">from</span> <span class="string">&quot;./Radiobox&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; prices &#125; <span class="keyword">from</span> <span class="string">&quot;./fixPrices&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Shop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [categories, setCategories] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [myFilters, setMyFilters] = useState(&#123;</span><br><span class="line">    filters: &#123;</span><br><span class="line">      category: [],</span><br><span class="line">      price: [],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">// eslint-disable-next-line no-unused-vars</span></span><br><span class="line">  <span class="keyword">const</span> [limit, setLimit] = useState(<span class="number">6</span>);</span><br><span class="line">  <span class="keyword">const</span> [skip, setSkip] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [filteredResult, setFilteredResult] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> init = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getCategories().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// FormData 可建立表單資料中的欄位/值建立相對應的的鍵/值對（key/value）集合</span></span><br><span class="line">        setCategories(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loaderFilterResults</span>(<span class="params">newFilters</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(newFilters);</span></span><br><span class="line">    getFilteredProducts(skip, limit, newFilters).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(data);</span></span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">        setFilteredResult([]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setFilteredResult(data.data);</span><br><span class="line">        setSize(data.size);</span><br><span class="line">        setSkip(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadMore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> toSkip = skip + limit;</span><br><span class="line">    getFilteredProducts(toSkip, limit, myFilters.filters).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(data);</span></span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">        setFilteredResult([]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setFilteredResult([...filteredResult, ...data.data]);</span><br><span class="line">        setSize(data.size);</span><br><span class="line">        setSkip(toSkip);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadMoreButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      size &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">      size &gt;= limit &amp;&amp; (</span><br><span class="line">        &lt;button onClick=&#123;loadMore&#125; className=<span class="string">&quot;btn btn-warning mb-5&quot;</span>&gt;</span><br><span class="line">          Load more</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    init();</span><br><span class="line">    loaderFilterResults(myFilters.filters);</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleFilters = <span class="function">(<span class="params">filters, filterBy</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(&quot;Shop&quot;, filters, filterBy);</span></span><br><span class="line">    <span class="keyword">const</span> newFilters = &#123; ...myFilters &#125;;</span><br><span class="line">    newFilters.filters[filterBy] = filters;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filterBy === <span class="string">&quot;price&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> priceValue = handlePrice(filters);</span><br><span class="line">      newFilters.filters[filterBy] = priceValue;</span><br><span class="line">    &#125;</span><br><span class="line">    loaderFilterResults(myFilters.filters);</span><br><span class="line">    setMyFilters(newFilters);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handlePrice</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = prices;</span><br><span class="line">    <span class="keyword">let</span> array = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">      <span class="keyword">if</span> (data[key]._id === <span class="built_in">parseInt</span>(value)) &#123;</span><br><span class="line">        array = data[key].array;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&quot;text-danger&quot;</span>&gt;</span>Category should be unique<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(filteredResult);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Shop Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Search and find books of your choice&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-4&quot;</span>&gt;</span><br><span class="line">          &lt;h4&gt;Fillter by categories&lt;/h4&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;Checkbox</span><br><span class="line">              categories=&#123;categories&#125;</span><br><span class="line">              handleFilters=&#123;<span class="function">(<span class="params">filters</span>) =&gt;</span> handleFilters(filters, <span class="string">&quot;category&quot;</span>)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;h4&gt;Fillter by price range&lt;/h4&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;Radiobox</span><br><span class="line">              prices=&#123;prices&#125;</span><br><span class="line">              handleFilters=&#123;<span class="function">(<span class="params">filters</span>) =&gt;</span> handleFilters(filters, <span class="string">&quot;price&quot;</span>)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-8&quot;</span>&gt;</span><br><span class="line">          &#123;showError()&#125;</span><br><span class="line">          &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Products&lt;/h2&gt;</span><br><span class="line">          &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">            &#123;filteredResult.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">              &lt;Card key=&#123;i&#125; product=&#123;product&#125;&gt;&lt;/Card&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;hr /&gt;</span><br><span class="line">          &#123;loadMoreButton()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="x2F-src-x2F-core-x2F-Checkbox-js"><a href="#x2F-src-x2F-core-x2F-Checkbox-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Checkbox.js"></a>.&#x2F;src&#x2F;core&#x2F;Checkbox.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Checkbox.js</span></span><br><span class="line"><span class="comment">/* eslint-disable array-callback-return */</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Checkbox</span>(<span class="params">&#123; categories, handleFilters &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [checked, setChecked] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ***---&gt;&gt;&gt; event include parameter</span></span><br><span class="line">  <span class="keyword">const</span> handleToggle = <span class="function">(<span class="params">c</span>) =&gt;</span> <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// return the first index or -1</span></span><br><span class="line">    <span class="keyword">const</span> currentCategoryId = checked.indexOf(c);</span><br><span class="line">    <span class="keyword">const</span> newCheckedCategoryId = [...checked];</span><br><span class="line">    <span class="comment">// if current checked was not already in checked state &gt; push</span></span><br><span class="line">    <span class="comment">// else pull/take off</span></span><br><span class="line">    <span class="keyword">if</span> (currentCategoryId === -<span class="number">1</span>) &#123;</span><br><span class="line">      newCheckedCategoryId.push(c);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      newCheckedCategoryId.splice(currentCategoryId, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(newCheckedCategoryId);</span></span><br><span class="line">    setChecked(newCheckedCategoryId);</span><br><span class="line">    handleFilters(newCheckedCategoryId);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> categories.map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> (</span><br><span class="line">    &lt;li key=&#123;i&#125; className=<span class="string">&quot;list-unstyled&quot;</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* value=false --&gt;not select  */</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/* ***---&gt;&gt;&gt; event include parameter */</span>&#125;</span><br><span class="line">      &lt;input</span><br><span class="line">        onChange=&#123;handleToggle(c._id)&#125;</span><br><span class="line">        value=&#123;checked.indexOf(c._id) === -<span class="number">1</span>&#125;</span><br><span class="line">        type=<span class="string">&quot;checkbox&quot;</span></span><br><span class="line">        className=<span class="string">&quot;form-check-input&quot;</span></span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;label htmlFor=<span class="string">&quot;form-check-label&quot;</span>&gt;&#123;c.name&#125;&lt;/label&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="x2F-src-x2F-core-x2F-Radiobox-js"><a href="#x2F-src-x2F-core-x2F-Radiobox-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Radiobox.js"></a>.&#x2F;src&#x2F;core&#x2F;Radiobox.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Radiobox.js</span></span><br><span class="line"><span class="comment">/* eslint-disable array-callback-return */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Radiobox</span>(<span class="params">&#123; prices, handleFilters &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// const [value, setValue] = useState([]);</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(e.target.value);</span></span><br><span class="line">    handleFilters(e.target.value);</span><br><span class="line">    <span class="comment">// setValue(e.target.value);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> prices.map(<span class="function">(<span class="params">p, i</span>) =&gt;</span> (</span><br><span class="line">    &lt;div key=&#123;i&#125; className=<span class="string">&quot;list-unstyled&quot;</span>&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        name=<span class="string">&quot;price&quot;</span></span><br><span class="line">        onChange=&#123;handleChange&#125;</span><br><span class="line">        value=&#123;p._id&#125;</span><br><span class="line">        type=<span class="string">&quot;radio&quot;</span></span><br><span class="line">        className=<span class="string">&quot;mr-2 ml-4&quot;</span></span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;label htmlFor=<span class="string">&quot;form-check-label&quot;</span>&gt;&#123;p.name&#125;&lt;/label&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="x2F-src-x2F-core-x2F-fixPrices-js"><a href="#x2F-src-x2F-core-x2F-fixPrices-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;fixPrices.js"></a>.&#x2F;src&#x2F;core&#x2F;fixPrices.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/fixPrices.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> prices = [</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">0</span>,</span><br><span class="line">    name: <span class="string">&quot;Any&quot;</span>,</span><br><span class="line">    array: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">1</span>,</span><br><span class="line">    name: <span class="string">&quot;$0 to $9&quot;</span>,</span><br><span class="line">    array: [<span class="number">0</span>, <span class="number">9</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">&quot;$10 to $19&quot;</span>,</span><br><span class="line">    array: [<span class="number">10</span>, <span class="number">19</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">3</span>,</span><br><span class="line">    name: <span class="string">&quot;$20 to $29&quot;</span>,</span><br><span class="line">    array: [<span class="number">20</span>, <span class="number">29</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">4</span>,</span><br><span class="line">    name: <span class="string">&quot;$30 to $39&quot;</span>,</span><br><span class="line">    array: [<span class="number">30</span>, <span class="number">39</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">5</span>,</span><br><span class="line">    name: <span class="string">&quot;More then $40&quot;</span>,</span><br><span class="line">    array: [<span class="number">40</span>, <span class="number">99</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>


<h4 id="x2F-src-x2F-admin-x2F-ApiCore-js-1"><a href="#x2F-src-x2F-admin-x2F-ApiCore-js-1" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiCore.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiCore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProducts = <span class="function">(<span class="params">sortBy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products?sortBy=<span class="subst">$&#123;sortBy&#125;</span>&amp;order=desc&amp;limit=6`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getFilteredProducts = <span class="function">(<span class="params">skip, limit, filters</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123; limit, skip, filters &#125;;</span><br><span class="line">  <span class="comment">// console.log(data);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/by/search`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h4 id="x2F-src-x2F-core-x2F-Card-js-1"><a href="#x2F-src-x2F-core-x2F-Card-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Card.js"></a>.&#x2F;src&#x2F;core&#x2F;Card.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Card.js</span></span><br><span class="line"><span class="comment">/* eslint-disable react/prop-types */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ShowImage <span class="keyword">from</span> <span class="string">&quot;./ShowImage&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Card</span>(<span class="params">&#123; product &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(product);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;col-4 mb-3&quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;card-header&quot;</span>&gt;&#123;product.name&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;card-body&quot;</span>&gt;</span><br><span class="line">          &lt;ShowImage item=&#123;product&#125; url=<span class="string">&quot;product&quot;</span> /&gt;</span><br><span class="line">          &lt;p&gt;&#123;<span class="string">`&lt;&lt;<span class="subst">$&#123;product.category.name&#125;</span>&gt;&gt;`</span>&#125;&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;&#123;product.description.substring(<span class="number">0</span>, <span class="number">10</span>)&#125;&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;$&#123;product.price&#125;&lt;/p&gt;</span><br><span class="line">          &lt;Link to=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">            &lt;button className=<span class="string">&quot;btn btn-outline-primary mt-2 mb-2 mr-2&quot;</span>&gt;</span><br><span class="line">              View Product</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">          &lt;button className=<span class="string">&quot;btn btn-outline-warning mt-2 mb-2&quot;</span>&gt;</span><br><span class="line">            Add to card</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="add-Products-search"><a href="#add-Products-search" class="headerlink" title="add Products search"></a>add Products search</h3><h4 id="install-2"><a href="#install-2" class="headerlink" title="install"></a>install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i query-string</span><br></pre></td></tr></table></figure>

<h4 id="Front-End"><a href="#Front-End" class="headerlink" title="Front End"></a>Front End</h4><h5 id="x2F-src-x2F-core-x2F-Home-js-2"><a href="#x2F-src-x2F-core-x2F-Home-js-2" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Home.js"></a>.&#x2F;src&#x2F;core&#x2F;Home.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Home.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getProducts &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">&quot;./Search&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [productsBySell, setProductsBySell] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [productsByArrival, setProductsByArrival] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadProductsBySell = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getProducts(<span class="string">&quot;sold&quot;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProductsBySell(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadProductsByArrival = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getProducts(<span class="string">&quot;createdAt&quot;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProductsByArrival(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loadProductsBySell();</span><br><span class="line">    loadProductsByArrival();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&quot;text-danger&quot;</span>&gt;</span>&#123;error&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Home Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Node React E-commerce&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;Search /&gt;</span><br><span class="line">      &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Best Selles&lt;/h2&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &#123;productsBySell.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;Card key=&#123;i&#125; product=&#123;product&#125; /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &#123;showError()&#125;</span><br><span class="line">      &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;New Arrival&lt;/h2&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &#123;productsByArrival.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;Card key=&#123;i&#125; product=&#123;product&#125; /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Search-js"><a href="#x2F-src-x2F-core-x2F-Search-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Search.js"></a>.&#x2F;src&#x2F;core&#x2F;Search.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Search.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCategories, list &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Search</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState(&#123;</span><br><span class="line">    categories: [],</span><br><span class="line">    category: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    search: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    results: [],</span><br><span class="line">    searched: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; categories, category, search, results, searched &#125; = data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getCategories().then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(response.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setData(&#123; ...data, <span class="attr">categories</span>: response &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loadCategories();</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">searchData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(search, category);</span></span><br><span class="line">    <span class="keyword">if</span> (search) &#123;</span><br><span class="line">      list(&#123; <span class="attr">search</span>: search || <span class="literal">undefined</span>, <span class="attr">category</span>: category &#125;).then(</span><br><span class="line">        (response) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (response.error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.error);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setData(&#123; ...data, <span class="attr">results</span>: response, <span class="attr">searched</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSearch</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    searchData();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">name</span>) =&gt;</span> <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// setData(&#123; ...data, [name]: e.target.value, searched: false &#125;);</span></span><br><span class="line">    setData(&#123; ...data, [name]: e.target.value &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">searchMessage</span>(<span class="params">searched, results</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (searched &amp;&amp; results.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`Found <span class="subst">$&#123;results.length&#125;</span> products`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (searched &amp;&amp; results.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`No products found`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">searchProducts</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2 className=<span class="string">&quot;mt-4 mb-4&quot;</span>&gt;&#123;searchMessage(searched, results)&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">          &#123;results.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">            &lt;Card key=&#123;i&#125; product=&#123;product&#125; /&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">searchForm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;handleSearch&#125;&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;input-group-text&quot;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&quot;input-group input-group-lg&quot;</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">&quot;input-group-prepend&quot;</span>&gt;</span><br><span class="line">              &lt;select className=<span class="string">&quot;btn mr-2&quot;</span> onChange=&#123;handleChange(<span class="string">&quot;category&quot;</span>)&#125;&gt;</span><br><span class="line">                &lt;option value=<span class="string">&quot;All&quot;</span>&gt;All&lt;/option&gt;</span><br><span class="line">                &#123;categories.map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> (</span><br><span class="line">                  &lt;option key=&#123;i&#125; value=&#123;c._id&#125;&gt;</span><br><span class="line">                    &#123;c.name&#125;</span><br><span class="line">                  &lt;/option&gt;</span><br><span class="line">                ))&#125;</span><br><span class="line">              &lt;/select&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              type=<span class="string">&quot;search&quot;</span></span><br><span class="line">              className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">              onChange=&#123;handleChange(<span class="string">&quot;search&quot;</span>)&#125;</span><br><span class="line">              placeholder=<span class="string">&quot;Search by name&quot;</span></span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div className=<span class="string">&quot;btn inpu-group-append&quot;</span> style=&#123;&#123; <span class="attr">border</span>: <span class="string">&quot;none&quot;</span> &#125;&#125;&gt;</span><br><span class="line">            &lt;button className=<span class="string">&quot;input-group-text&quot;</span>&gt;Search&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;container mb-3&quot;</span>&gt;&#123;searchForm()&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;container-fluid mb-3&quot;</span>&gt;&#123;searchProducts(results)&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-ApiCore-js-2"><a href="#x2F-src-x2F-admin-x2F-ApiCore-js-2" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiCore.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiCore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> queryString <span class="keyword">from</span> <span class="string">&quot;query-string&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProducts = <span class="function">(<span class="params">sortBy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products?sortBy=<span class="subst">$&#123;sortBy&#125;</span>&amp;order=desc&amp;limit=6`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getFilteredProducts = <span class="function">(<span class="params">skip, limit, filters</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123; limit, skip, filters &#125;;</span><br><span class="line">  <span class="comment">// console.log(data);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/by/search`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> list = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = queryString.stringify(params);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/search?<span class="subst">$&#123;query&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Bakc-End"><a href="#Bakc-End" class="headerlink" title="Bakc End"></a>Bakc End</h4><h5 id="x2F-routes-x2F-product-js"><a href="#x2F-routes-x2F-product-js" class="headerlink" title=".&#x2F;routes&#x2F;product.js"></a>.&#x2F;routes&#x2F;product.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./routes/product.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="comment">// add controller</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  create,</span><br><span class="line">  productById,</span><br><span class="line">  read,</span><br><span class="line">  remove,</span><br><span class="line">  update,</span><br><span class="line">  list,</span><br><span class="line">  listSearch,</span><br><span class="line">  listRelated,</span><br><span class="line">  listCategories,</span><br><span class="line">  listBySearch,</span><br><span class="line">  photo,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/product&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; requireSignin, isAuth, isAdmin &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/auth&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; userById &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/user&quot;</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&quot;/product/:productId&quot;</span>, read);</span><br><span class="line">router.post(<span class="string">&quot;/product/create/:userId&quot;</span>, requireSignin, isAuth, isAdmin, create);</span><br><span class="line">router.delete(</span><br><span class="line">  <span class="string">&quot;/product/:productId/:userId&quot;</span>,</span><br><span class="line">  requireSignin,</span><br><span class="line">  isAuth,</span><br><span class="line">  isAdmin,</span><br><span class="line">  remove</span><br><span class="line">);</span><br><span class="line">router.put(</span><br><span class="line">  <span class="string">&quot;/product/:productId/:userId&quot;</span>,</span><br><span class="line">  requireSignin,</span><br><span class="line">  isAuth,</span><br><span class="line">  isAdmin,</span><br><span class="line">  update</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&quot;/products&quot;</span>, list);</span><br><span class="line">router.get(<span class="string">&quot;/products/search&quot;</span>, listSearch);</span><br><span class="line">router.get(<span class="string">&quot;/products/related/:productId&quot;</span>, listRelated);</span><br><span class="line">router.get(<span class="string">&quot;/products/categories&quot;</span>, listCategories);</span><br><span class="line">router.post(<span class="string">&quot;/products/by/search&quot;</span>, listBySearch);</span><br><span class="line">router.get(<span class="string">&quot;/product/photo/:productId&quot;</span>, photo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// product/create</span></span><br><span class="line"><span class="comment">// userId 參數驗證</span></span><br><span class="line">router.param(<span class="string">&quot;userId&quot;</span>, userById);</span><br><span class="line">router.param(<span class="string">&quot;productId&quot;</span>, productById);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-controller-x2F-product-js"><a href="#x2F-controller-x2F-product-js" class="headerlink" title=".&#x2F;controller&#x2F;product.js"></a>.&#x2F;controller&#x2F;product.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controller/product.js</span></span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">&quot;formidable&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Product = <span class="built_in">require</span>(<span class="string">&quot;../models/product&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; errorHandler &#125; = <span class="built_in">require</span>(<span class="string">&quot;../helpers/dbErrorHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.productById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  Product.findById(id).exec(<span class="function">(<span class="params">err, product</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err || !product) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Product does not exist&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    req.product = product;</span><br><span class="line">    next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.read = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.product.photo = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> res.json(req.product);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.create = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check for all fieldd</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, description, price, category, quantity, shipping &#125; = fields;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !name ||</span><br><span class="line">      !description ||</span><br><span class="line">      !price ||</span><br><span class="line">      !category ||</span><br><span class="line">      !quantity ||</span><br><span class="line">      !shipping</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;All field are required&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = <span class="keyword">new</span> Product(fields);</span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="comment">// console.log(&quot;product:&quot;, result);</span></span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.remove = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> product = req.product;</span><br><span class="line">  product.remove(<span class="function">(<span class="params">err, deletedProduct</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: errorHandler(err),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      message: <span class="string">&quot;Product deleted successly&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.update = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check for all fieldd</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, description, price, category, quantity, shipping &#125; = fields;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !name ||</span><br><span class="line">      !description ||</span><br><span class="line">      !price ||</span><br><span class="line">      !category ||</span><br><span class="line">      !quantity ||</span><br><span class="line">      !shipping</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;All field are required&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = req.product;</span><br><span class="line">    <span class="comment">// fields 蓋過 product</span></span><br><span class="line">    product = _.extend(product, fields);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sel/arrival</span></span><br><span class="line"><span class="comment"> * bye sell = /products?sortBy=sold&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * bye arrival = /products?sortBy=createdAt&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * if no parameter are sent, then all products are returned</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">exports</span>.list = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.query.order ? req.query.order : <span class="string">&quot;asc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.query.sortBy ? req.query.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  Product.find()</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>) <span class="comment">// mapt to Category</span></span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// console.log(&quot;product-list:&quot;, products);</span></span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * it will find the products based on the req product category</span></span><br><span class="line"><span class="comment"> * other products that has the same category, will be return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listRelated = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// $ne: not include</span></span><br><span class="line">  Product.find(&#123; <span class="attr">_id</span>: &#123; <span class="attr">$ne</span>: req.product &#125;, <span class="attr">category</span>: req.product.category &#125;)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;_id name&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listCategories = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// distinct : 取出不同的 category</span></span><br><span class="line">  <span class="comment">// &#123;&#125; : 2nd parameter doesn&#x27;t need do no send value</span></span><br><span class="line">  Product.distinct(<span class="string">&quot;category&quot;</span>, &#123;&#125;, <span class="function">(<span class="params">err, categories</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Categories not found&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(categories);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * list products by search</span></span><br><span class="line"><span class="comment"> * we will implement product search in react frontend</span></span><br><span class="line"><span class="comment"> * we will show categories in checkbox and price range in radio buttons</span></span><br><span class="line"><span class="comment"> * as the user clicks on those checkbox and radio buttons</span></span><br><span class="line"><span class="comment"> * we will make api request and show the products to users based on what he wants</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//  &quot;skip&quot; : &quot;1&quot;,</span></span><br><span class="line"><span class="comment">//  &quot;limit&quot; : &quot;2&quot;,</span></span><br><span class="line"><span class="comment">// 	&quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">// 		&quot;name&quot;: &quot;Note&quot;</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// &gt;=2 and &lt;=19</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">// &quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">//   &quot;price&quot;: [&quot;2&quot;, &quot;19&quot;]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">exports</span>.listBySearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.body.order ? req.body.order : <span class="string">&quot;desc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.body.sortBy ? req.body.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.body.limit ? <span class="built_in">parseInt</span>(req.body.limit) : <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> skip = req.body.skip ? <span class="built_in">parseInt</span>(req.body.skip) : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> findArgs = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(order, sortBy, limit, skip, req.body.filters);</span></span><br><span class="line">  <span class="comment">// console.log(req.body);</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> req.body.filters) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.filters[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;price&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// gte - great than price</span></span><br><span class="line">        <span class="comment">// lte - less than</span></span><br><span class="line">        findArgs[key] = &#123;</span><br><span class="line">          $gte: req.body.filters[key][<span class="number">0</span>],</span><br><span class="line">          $lte: req.body.filters[key][<span class="number">1</span>],</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// findArgs[key] = new RegExp(req.body.filters[key]);</span></span><br><span class="line">        findArgs[key] = req.body.filters[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// console.log(&quot;findArgs&quot;, findArgs);</span></span><br><span class="line"></span><br><span class="line">  Product.find(findArgs)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .skip(skip)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        size: data.length,</span><br><span class="line">        data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.photo = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.product.photo.data) &#123;</span><br><span class="line">    res.set(<span class="string">&quot;Content-Type&quot;</span>, req.product.photo.contentType);</span><br><span class="line">    <span class="keyword">return</span> res.send(req.product.photo.data);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listSearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// create query object to hole search value and category value</span></span><br><span class="line">  <span class="keyword">const</span> query = &#123;&#125;;</span><br><span class="line">  <span class="comment">// assign search value to query name</span></span><br><span class="line">  <span class="keyword">if</span> (req.query.search) &#123;</span><br><span class="line">    <span class="comment">// mongodb regular expression</span></span><br><span class="line">    query.name = &#123; <span class="attr">$regex</span>: req.query.search, <span class="attr">$options</span>: <span class="string">&quot;i&quot;</span> &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(query.name);</span><br><span class="line">    <span class="comment">// assign category value to query.category</span></span><br><span class="line">    <span class="keyword">if</span> (req.query.category &amp;&amp; req.query.category != <span class="string">&quot;All&quot;</span>) &#123;</span><br><span class="line">      query.category = req.query.category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// find the product base on query object with 2 properties</span></span><br><span class="line">    <span class="comment">// search and category</span></span><br><span class="line">    Product.find(query, <span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;).select(<span class="string">&quot;-photo&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="add-Product-Page-with-Related-Products"><a href="#add-Product-Page-with-Related-Products" class="headerlink" title="add Product Page with Related Products"></a>add Product Page with Related Products</h3><h4 id="install-3"><a href="#install-3" class="headerlink" title="install"></a>install</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i moment</span><br></pre></td></tr></table></figure>

<h4 id="Front-End-1"><a href="#Front-End-1" class="headerlink" title="Front End"></a>Front End</h4><h5 id="x2F-src-x2F-AppRoutes-js-4"><a href="#x2F-src-x2F-AppRoutes-js-4" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddCategory <span class="keyword">from</span> <span class="string">&quot;./admin/AddCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddProduct <span class="keyword">from</span> <span class="string">&quot;./admin/AddProduct&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Shop <span class="keyword">from</span> <span class="string">&quot;./core/Shop&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Product <span class="keyword">from</span> <span class="string">&quot;./core/Product&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/shop&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Shop</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/category&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddCategory /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/product&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/product/:productId&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Product</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Product-js"><a href="#x2F-src-x2F-core-x2F-Product-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Product.js"></a>.&#x2F;src&#x2F;core&#x2F;Product.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Product.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useParams &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; read, listRelated &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Product</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [product, setProduct] = useState(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [relatedProduct, setRelatedProduct] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [error, SetError] = useState();</span><br><span class="line">  <span class="keyword">const</span> params = useParams();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(props);</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">locaSingleProduct</span>(<span class="params">productId</span>) </span>&#123;</span><br><span class="line">    read(productId).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        SetError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProduct(data);</span><br><span class="line">        <span class="comment">// fetch related products</span></span><br><span class="line">        listRelated(data._id).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">            SetError(data.error);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setRelatedProduct(data);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// react-router-dom v6 get parameter</span></span><br><span class="line">    <span class="keyword">const</span> productId = params.productId;</span><br><span class="line">    locaSingleProduct(productId);</span><br><span class="line">  &#125;, [params]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=&#123;product &amp;&amp; product.name&#125;</span><br><span class="line">      description=&#123;</span><br><span class="line">        product &amp;&amp; product.description &amp;&amp; product.description.substring(<span class="number">0.1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-8&quot;</span>&gt;</span><br><span class="line">          &#123;product &amp;&amp; product.description &amp;&amp; (</span><br><span class="line">            &lt;Card product=&#123;product&#125; showViewProductButton=&#123;<span class="literal">false</span>&#125; /&gt;</span><br><span class="line">          )&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-4&quot;</span>&gt;</span><br><span class="line">          &lt;h4&gt;Rekated Products&lt;/h4&gt;</span><br><span class="line">          &#123;relatedProduct.map(<span class="function">(<span class="params">p, i</span>) =&gt;</span> (</span><br><span class="line">            &lt;div className=<span class="string">&quot;mb-3&quot;</span>&gt;</span><br><span class="line">              &lt;Card key=&#123;i&#125; product=&#123;p&#125; /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Card-js-2"><a href="#x2F-src-x2F-core-x2F-Card-js-2" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Card.js"></a>.&#x2F;src&#x2F;core&#x2F;Card.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Card.js</span></span><br><span class="line"><span class="comment">/* eslint-disable react/prop-types */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&quot;moment&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ShowImage <span class="keyword">from</span> <span class="string">&quot;./ShowImage&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Card</span>(<span class="params">&#123; product, showViewProductButton = <span class="literal">true</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(product);</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showViewButton</span>(<span class="params">showViewProductButton</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      showViewProductButton &amp;&amp; (</span><br><span class="line">        &lt;Link to=&#123;<span class="string">`/product/<span class="subst">$&#123;product._id&#125;</span>`</span>&#125; className=<span class="string">&quot;mr-2&quot;</span>&gt;</span><br><span class="line">          &lt;button className=<span class="string">&quot;btn btn-outline-primary mt-2 mb-2 mr-2&quot;</span>&gt;</span><br><span class="line">            View Product</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/Link&gt;</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showAddToCardButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button className=<span class="string">&quot;btn btn-outline-warning mt-2 mb-2&quot;</span>&gt;Add to card&lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showStock</span>(<span class="params">quantity</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> quantity &gt; <span class="number">0</span> ? (</span><br><span class="line">      &lt;span className=<span class="string">&quot;badge badge-primary badge-pill&quot;</span>&gt;In Stock&lt;/span&gt;</span><br><span class="line">    ) : (</span><br><span class="line">      &lt;span&gt;Out <span class="keyword">of</span> Stock&lt;/span&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;card-header name&quot;</span>&gt;&#123;product.name&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;card-body&quot;</span>&gt;</span><br><span class="line">        &lt;ShowImage item=&#123;product&#125; url=<span class="string">&quot;product&quot;</span> /&gt;</span><br><span class="line">        &#123;<span class="comment">/* &lt;p&gt;&#123;`&lt;&lt;$&#123;product.category.name&#125;&gt;&gt;`&#125;&lt;/p&gt; */</span>&#125;</span><br><span class="line">        &lt;p className=<span class="string">&quot;lead mt-2&quot;</span>&gt;&#123;product.description.substring(<span class="number">0</span>, <span class="number">100</span>)&#125;&lt;/p&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;black-10&quot;</span>&gt;$&#123;product.price&#125;&lt;/p&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;black-9&quot;</span>&gt;</span><br><span class="line">          Category: &#123;product.category &amp;&amp; product.category.name&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;black-8&quot;</span>&gt;</span><br><span class="line">          Added on &#123;moment(product.createdAt).fromNow()&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &#123;showStock(product.quantity)&#125;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &#123;showViewButton(showViewProductButton)&#125;</span><br><span class="line">        &#123;showAddToCardButton()&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-ApiCore-js-3"><a href="#x2F-src-x2F-admin-x2F-ApiCore-js-3" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiCore.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiCore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> queryString <span class="keyword">from</span> <span class="string">&quot;query-string&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProducts = <span class="function">(<span class="params">sortBy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products?sortBy=<span class="subst">$&#123;sortBy&#125;</span>&amp;order=desc&amp;limit=6`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getFilteredProducts = <span class="function">(<span class="params">skip, limit, filters</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123; limit, skip, filters &#125;;</span><br><span class="line">  <span class="comment">// console.log(data);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/by/search`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">				<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> list = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = queryString.stringify(params);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/search?<span class="subst">$&#123;query&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> read = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;productid=&quot;</span>, productId);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/<span class="subst">$&#123;productId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> listRelated = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/related/<span class="subst">$&#123;productId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-styles-css-1"><a href="#x2F-src-x2F-styles-css-1" class="headerlink" title=".&#x2F;src&#x2F;styles.css"></a>.&#x2F;src&#x2F;styles.css</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ./src/styles.css */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* board radis </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">.btn,</span><br><span class="line">.jumbotron,</span><br><span class="line">.nav :hover &#123;</span><br><span class="line">  border-radius: 0px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* single product page - product name</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">.name &#123;</span><br><span class="line">  background: indigo;</span><br><span class="line">  color: #fff;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* black shade from 10-1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">.black-<span class="number">10</span> &#123;</span><br><span class="line">  background: #f2f2f2;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">9</span> &#123;</span><br><span class="line">  background: #e6e6e6;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">8</span> &#123;</span><br><span class="line">  background: #d9d9d9;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">7</span> &#123;</span><br><span class="line">  background: #cccccc;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">6</span> &#123;</span><br><span class="line">  background: #bfbfbf;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">5</span> &#123;</span><br><span class="line">  background: #b3b3b3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* product image on card </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">.product-img &#123;</span><br><span class="line">  min-height: 100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* jumbotron animation</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">.jumbotron &#123;</span><br><span class="line">  width: 30wh;</span><br><span class="line">  height: 30vh;</span><br><span class="line">  color: #fff;</span><br><span class="line">  background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);</span><br><span class="line">  background-size: <span class="number">400</span>% <span class="number">400</span>%;</span><br><span class="line">  -webkit-animation: Gradient 15s ease infinite;</span><br><span class="line">  -moz-animation: Gradient 15s ease infinite;</span><br><span class="line">  animation: Gradient 15s ease infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-webkit-keyframes Gradient &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50</span>% &#123;</span><br><span class="line">    background-position: <span class="number">100</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-moz-keyframes Gradient &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50</span>% &#123;</span><br><span class="line">    background-position: <span class="number">100</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes Gradient &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50</span>% &#123;</span><br><span class="line">    background-position: <span class="number">100</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Home-js-3"><a href="#x2F-src-x2F-core-x2F-Home-js-3" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Home.js"></a>.&#x2F;src&#x2F;core&#x2F;Home.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Home.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getProducts &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">&quot;./Search&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [productsBySell, setProductsBySell] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [productsByArrival, setProductsByArrival] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadProductsBySell = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getProducts(<span class="string">&quot;sold&quot;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProductsBySell(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> loadProductsByArrival = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getProducts(<span class="string">&quot;createdAt&quot;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProductsByArrival(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loadProductsBySell();</span><br><span class="line">    loadProductsByArrival();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&quot;text-danger&quot;</span>&gt;</span>&#123;error&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Home Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Node React E-commerce&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;Search /&gt;</span><br><span class="line">      &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Best Selles&lt;/h2&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &#123;productsBySell.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;div key=&#123;i&#125; className=<span class="string">&quot;col-4 mb-3&quot;</span>&gt;</span><br><span class="line">            &lt;Card product=&#123;product&#125; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &#123;showError()&#125;</span><br><span class="line">      &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;New Arrival&lt;/h2&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &#123;productsByArrival.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;div key=&#123;i&#125; className=<span class="string">&quot;col-4 mb-3&quot;</span>&gt;</span><br><span class="line">            &lt;Card product=&#123;product&#125; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Shop-js-1"><a href="#x2F-src-x2F-core-x2F-Shop-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Shop.js"></a>.&#x2F;src&#x2F;core&#x2F;Shop.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Shop.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCategories, getFilteredProducts &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Checkbox <span class="keyword">from</span> <span class="string">&quot;./Checkbox&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Radiobox <span class="keyword">from</span> <span class="string">&quot;./Radiobox&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; prices &#125; <span class="keyword">from</span> <span class="string">&quot;./fixPrices&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Shop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [categories, setCategories] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [myFilters, setMyFilters] = useState(&#123;</span><br><span class="line">    filters: &#123;</span><br><span class="line">      category: [],</span><br><span class="line">      price: [],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">// eslint-disable-next-line no-unused-vars</span></span><br><span class="line">  <span class="keyword">const</span> [limit, setLimit] = useState(<span class="number">6</span>);</span><br><span class="line">  <span class="keyword">const</span> [skip, setSkip] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [filteredResult, setFilteredResult] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> init = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getCategories().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// FormData 可建立表單資料中的欄位/值建立相對應的的鍵/值對（key/value）集合</span></span><br><span class="line">        setCategories(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loaderFilterResults</span>(<span class="params">newFilters</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(newFilters);</span></span><br><span class="line">    getFilteredProducts(skip, limit, newFilters).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(data);</span></span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">        setFilteredResult([]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setFilteredResult(data.data);</span><br><span class="line">        setSize(data.size);</span><br><span class="line">        setSkip(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadMore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> toSkip = skip + limit;</span><br><span class="line">    getFilteredProducts(toSkip, limit, myFilters.filters).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(data);</span></span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setError(data.error);</span><br><span class="line">        setFilteredResult([]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setFilteredResult([...filteredResult, ...data.data]);</span><br><span class="line">        setSize(data.size);</span><br><span class="line">        setSkip(toSkip);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadMoreButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      size &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">      size &gt;= limit &amp;&amp; (</span><br><span class="line">        &lt;button onClick=&#123;loadMore&#125; className=<span class="string">&quot;btn btn-warning mb-5&quot;</span>&gt;</span><br><span class="line">          Load more</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    init();</span><br><span class="line">    loaderFilterResults(myFilters.filters);</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleFilters = <span class="function">(<span class="params">filters, filterBy</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(&quot;Shop&quot;, filters, filterBy);</span></span><br><span class="line">    <span class="keyword">const</span> newFilters = &#123; ...myFilters &#125;;</span><br><span class="line">    newFilters.filters[filterBy] = filters;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filterBy === <span class="string">&quot;price&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> priceValue = handlePrice(filters);</span><br><span class="line">      newFilters.filters[filterBy] = priceValue;</span><br><span class="line">    &#125;</span><br><span class="line">    loaderFilterResults(myFilters.filters);</span><br><span class="line">    setMyFilters(newFilters);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handlePrice</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = prices;</span><br><span class="line">    <span class="keyword">let</span> array = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">      <span class="keyword">if</span> (data[key]._id === <span class="built_in">parseInt</span>(value)) &#123;</span><br><span class="line">        array = data[key].array;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&quot;text-danger&quot;</span>&gt;</span>Category should be unique<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(filteredResult);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Shop Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Search and find books of your choice&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-4&quot;</span>&gt;</span><br><span class="line">          &lt;h4&gt;Fillter by categories&lt;/h4&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;Checkbox</span><br><span class="line">              categories=&#123;categories&#125;</span><br><span class="line">              handleFilters=&#123;<span class="function">(<span class="params">filters</span>) =&gt;</span> handleFilters(filters, <span class="string">&quot;category&quot;</span>)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;h4&gt;Fillter by price range&lt;/h4&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;Radiobox</span><br><span class="line">              prices=&#123;prices&#125;</span><br><span class="line">              handleFilters=&#123;<span class="function">(<span class="params">filters</span>) =&gt;</span> handleFilters(filters, <span class="string">&quot;price&quot;</span>)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-8&quot;</span>&gt;</span><br><span class="line">          &#123;showError()&#125;</span><br><span class="line">          &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Products&lt;/h2&gt;</span><br><span class="line">          &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">            &#123;filteredResult.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">              &lt;div key=&#123;i&#125; className=<span class="string">&quot;col-4 mb-3&quot;</span>&gt;</span><br><span class="line">                &lt;Card product=&#123;product&#125; /&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              <span class="comment">// &lt;Card key=&#123;i&#125; product=&#123;product&#125;&gt;&lt;/Card&gt;</span></span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;hr /&gt;</span><br><span class="line">          &#123;loadMoreButton()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Back-End"><a href="#Back-End" class="headerlink" title="Back End"></a>Back End</h4><h5 id="x2F-controller-x2F-product-js-1"><a href="#x2F-controller-x2F-product-js-1" class="headerlink" title=".&#x2F;controller&#x2F;product.js"></a>.&#x2F;controller&#x2F;product.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controller/product.js</span></span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">&quot;formidable&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Product = <span class="built_in">require</span>(<span class="string">&quot;../models/product&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; errorHandler &#125; = <span class="built_in">require</span>(<span class="string">&quot;../helpers/dbErrorHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.productById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  Product.findById(id)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, product</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err || !product) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Product does not exist&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      req.product = product;</span><br><span class="line">      next();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.read = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.product.photo = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> res.json(req.product);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.create = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check for all fieldd</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, description, price, category, quantity, shipping &#125; = fields;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !name ||</span><br><span class="line">      !description ||</span><br><span class="line">      !price ||</span><br><span class="line">      !category ||</span><br><span class="line">      !quantity ||</span><br><span class="line">      !shipping</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;All field are required&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = <span class="keyword">new</span> Product(fields);</span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="comment">// console.log(&quot;product:&quot;, result);</span></span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.remove = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> product = req.product;</span><br><span class="line">  product.remove(<span class="function">(<span class="params">err, deletedProduct</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: errorHandler(err),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      message: <span class="string">&quot;Product deleted successly&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.update = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check for all fieldd</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, description, price, category, quantity, shipping &#125; = fields;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !name ||</span><br><span class="line">      !description ||</span><br><span class="line">      !price ||</span><br><span class="line">      !category ||</span><br><span class="line">      !quantity ||</span><br><span class="line">      !shipping</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;All field are required&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = req.product;</span><br><span class="line">    <span class="comment">// fields 蓋過 product</span></span><br><span class="line">    product = _.extend(product, fields);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sel/arrival</span></span><br><span class="line"><span class="comment"> * bye sell = /products?sortBy=sold&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * bye arrival = /products?sortBy=createdAt&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * if no parameter are sent, then all products are returned</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">exports</span>.list = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.query.order ? req.query.order : <span class="string">&quot;asc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.query.sortBy ? req.query.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  Product.find()</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>) <span class="comment">// mapt to Category</span></span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// console.log(&quot;product-list:&quot;, products);</span></span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * it will find the products based on the req product category</span></span><br><span class="line"><span class="comment"> * other products that has the same category, will be return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listRelated = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// $ne: not include</span></span><br><span class="line">  Product.find(&#123; <span class="attr">_id</span>: &#123; <span class="attr">$ne</span>: req.product &#125;, <span class="attr">category</span>: req.product.category &#125;)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;_id name&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listCategories = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// distinct : 取出不同的 category</span></span><br><span class="line">  <span class="comment">// &#123;&#125; : 2nd parameter doesn&#x27;t need do no send value</span></span><br><span class="line">  Product.distinct(<span class="string">&quot;category&quot;</span>, &#123;&#125;, <span class="function">(<span class="params">err, categories</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Categories not found&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(categories);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * list products by search</span></span><br><span class="line"><span class="comment"> * we will implement product search in react frontend</span></span><br><span class="line"><span class="comment"> * we will show categories in checkbox and price range in radio buttons</span></span><br><span class="line"><span class="comment"> * as the user clicks on those checkbox and radio buttons</span></span><br><span class="line"><span class="comment"> * we will make api request and show the products to users based on what he wants</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//  &quot;skip&quot; : &quot;1&quot;,</span></span><br><span class="line"><span class="comment">//  &quot;limit&quot; : &quot;2&quot;,</span></span><br><span class="line"><span class="comment">// 	&quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">// 		&quot;name&quot;: &quot;Note&quot;</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// &gt;=2 and &lt;=19</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">// &quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">//   &quot;price&quot;: [&quot;2&quot;, &quot;19&quot;]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">exports</span>.listBySearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.body.order ? req.body.order : <span class="string">&quot;desc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.body.sortBy ? req.body.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.body.limit ? <span class="built_in">parseInt</span>(req.body.limit) : <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> skip = req.body.skip ? <span class="built_in">parseInt</span>(req.body.skip) : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> findArgs = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(order, sortBy, limit, skip, req.body.filters);</span></span><br><span class="line">  <span class="comment">// console.log(req.body);</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> req.body.filters) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.filters[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;price&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// gte - great than price</span></span><br><span class="line">        <span class="comment">// lte - less than</span></span><br><span class="line">        findArgs[key] = &#123;</span><br><span class="line">          $gte: req.body.filters[key][<span class="number">0</span>],</span><br><span class="line">          $lte: req.body.filters[key][<span class="number">1</span>],</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// findArgs[key] = new RegExp(req.body.filters[key]);</span></span><br><span class="line">        findArgs[key] = req.body.filters[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// console.log(&quot;findArgs&quot;, findArgs);</span></span><br><span class="line"></span><br><span class="line">  Product.find(findArgs)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .skip(skip)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        size: data.length,</span><br><span class="line">        data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.photo = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.product.photo.data) &#123;</span><br><span class="line">    res.set(<span class="string">&quot;Content-Type&quot;</span>, req.product.photo.contentType);</span><br><span class="line">    <span class="keyword">return</span> res.send(req.product.photo.data);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listSearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// create query object to hole search value and category value</span></span><br><span class="line">  <span class="keyword">const</span> query = &#123;&#125;;</span><br><span class="line">  <span class="comment">// assign search value to query name</span></span><br><span class="line">  <span class="keyword">if</span> (req.query.search) &#123;</span><br><span class="line">    <span class="comment">// mongodb regular expression</span></span><br><span class="line">    query.name = &#123; <span class="attr">$regex</span>: req.query.search, <span class="attr">$options</span>: <span class="string">&quot;i&quot;</span> &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(query.name);</span><br><span class="line">    <span class="comment">// assign category value to query.category</span></span><br><span class="line">    <span class="keyword">if</span> (req.query.category &amp;&amp; req.query.category != <span class="string">&quot;All&quot;</span>) &#123;</span><br><span class="line">      query.category = req.query.category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// find the product base on query object with 2 properties</span></span><br><span class="line">    <span class="comment">// search and category</span></span><br><span class="line">    Product.find(query, <span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;).select(<span class="string">&quot;-photo&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="add-Cart"><a href="#add-Cart" class="headerlink" title="add Cart"></a>add Cart</h3><h4 id="x2F-src-x2F-core-x2F-Cart-js"><a href="#x2F-src-x2F-core-x2F-Cart-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Cart.js"></a>.&#x2F;src&#x2F;core&#x2F;Cart.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Cart.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCart &#125; <span class="keyword">from</span> <span class="string">&quot;./cartHelpers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Checkout <span class="keyword">from</span> <span class="string">&quot;./Checkout&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Cart</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [items, setItems] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [updateScreen, setUpdateScreen] = useState(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setItems(getCart());</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, [updateScreen]);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleUpdateScreen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setUpdateScreen(!updateScreen);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showItems</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;Your cart has &#123;items.length&#125; items&lt;/h2&gt;</span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line">        &#123;items.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;Card</span><br><span class="line">            key=&#123;i&#125;</span><br><span class="line">            product=&#123;product&#125;</span><br><span class="line">            showAddCartButton=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">            cartUpdate=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">            showRemoveProductButton=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">            handelUpdate=&#123;handleUpdateScreen&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">noItemsMessage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;h2&gt;</span><br><span class="line">        Your cart is empty.</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;Link to=<span class="string">&quot;/shop&quot;</span>&gt; Continue shopping&lt;/Link&gt;</span><br><span class="line">      &lt;/h2&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Shopping Cart&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Manage your cart items. Add remove checkout or continue shopping&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-6&quot;</span>&gt;</span><br><span class="line">          &#123;items.length &gt; <span class="number">0</span> ? showItems(items) : noItemsMessage()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-6&quot;</span>&gt;</span><br><span class="line">          &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Your cart summy&lt;/h2&gt;</span><br><span class="line">          &lt;hr /&gt;</span><br><span class="line">          &lt;Checkout products=&#123;items&#125;&gt;&lt;/Checkout&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-AppRoutes-js-5"><a href="#x2F-src-x2F-AppRoutes-js-5" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddCategory <span class="keyword">from</span> <span class="string">&quot;./admin/AddCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddProduct <span class="keyword">from</span> <span class="string">&quot;./admin/AddProduct&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Shop <span class="keyword">from</span> <span class="string">&quot;./core/Shop&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Product <span class="keyword">from</span> <span class="string">&quot;./core/Product&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cart <span class="keyword">from</span> <span class="string">&quot;./core/Cart&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/shop&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Shop</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/category&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddCategory /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/product&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/product/:productId&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Product</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/cart&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Cart</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-Card-js-3"><a href="#x2F-src-x2F-core-x2F-Card-js-3" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Card.js"></a>.&#x2F;src&#x2F;core&#x2F;Card.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Card.js</span></span><br><span class="line"><span class="comment">/* eslint-disable react/prop-types */</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link, Navigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&quot;moment&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ShowImage <span class="keyword">from</span> <span class="string">&quot;./ShowImage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addItem, updateItem, removeItem &#125; <span class="keyword">from</span> <span class="string">&quot;./cartHelpers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Card</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  product,</span></span></span><br><span class="line"><span class="function"><span class="params">  showViewProductButton = <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  showAddCartButton = <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  cartUpdate = <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  showRemoveProductButton = <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  handelUpdate,</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [redirect, setRedirect] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(product.count);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showViewButton</span>(<span class="params">showViewProductButton</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      showViewProductButton &amp;&amp; (</span><br><span class="line">        &lt;Link to=&#123;<span class="string">`/product/<span class="subst">$&#123;product._id&#125;</span>`</span>&#125; className=<span class="string">&quot;mr-2&quot;</span>&gt;</span><br><span class="line">          &lt;button className=<span class="string">&quot;btn btn-outline-primary mt-2 mb-2 mr-2&quot;</span>&gt;</span><br><span class="line">            View Product</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/Link&gt;</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addToCart</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    addItem(product, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setRedirect(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">shouldRedirect</span>(<span class="params">redirect</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (redirect) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">replace</span> <span class="attr">to</span>=<span class="string">&quot;/cart&quot;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showAddToCard</span>(<span class="params">showAddCartButton</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      showAddCartButton &amp;&amp; (</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=&#123;addToCart&#125;</span><br><span class="line">          className=<span class="string">&quot;btn btn-outline-warning mt-2 mb-2&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          Add to card</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showRemoveButton</span>(<span class="params">showRemoveProductButton</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      showRemoveProductButton &amp;&amp; (</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            handelUpdate();</span><br><span class="line">            removeItem(product._id);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">          className=<span class="string">&quot;btn btn-outline-danger mt-2 mb-2&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          Remove Product</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showStock</span>(<span class="params">quantity</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> quantity &gt; <span class="number">0</span> ? (</span><br><span class="line">      &lt;span className=<span class="string">&quot;badge badge-primary badge-pill&quot;</span>&gt;In Stock&lt;/span&gt;</span><br><span class="line">    ) : (</span><br><span class="line">      &lt;span&gt;Out <span class="keyword">of</span> Stock&lt;/span&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">productId</span>) =&gt;</span> <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(productId, e.target.value);</span></span><br><span class="line">    handelUpdate();</span><br><span class="line">    setCount(e.target.value &lt; <span class="number">1</span> ? <span class="number">1</span> : e.target.value);</span><br><span class="line">    <span class="keyword">if</span> (e.target.value &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      updateItem(productId, e.target.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showCartUpdateotions</span>(<span class="params">CartUpdate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      cartUpdate &amp;&amp; (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;div className=<span class="string">&quot;input-group mb-3&quot;</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">&quot;input-group-prepend&quot;</span>&gt;</span><br><span class="line">              &lt;span className=<span class="string">&quot;input-group-text&quot;</span>&gt;Adjust Quantity&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              type=<span class="string">&quot;number&quot;</span></span><br><span class="line">              className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">              value=&#123;count&#125;</span><br><span class="line">              onChange=&#123;handleChange(product._id)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;card-header name&quot;</span>&gt;&#123;product.name&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;card-body&quot;</span>&gt;</span><br><span class="line">        &#123;shouldRedirect(redirect)&#125;</span><br><span class="line">        &lt;ShowImage item=&#123;product&#125; url=<span class="string">&quot;product&quot;</span> /&gt;</span><br><span class="line">        &#123;<span class="comment">/* &lt;p&gt;&#123;`&lt;&lt;$&#123;product.category.name&#125;&gt;&gt;`&#125;&lt;/p&gt; */</span>&#125;</span><br><span class="line">        &lt;p className=<span class="string">&quot;lead mt-2&quot;</span>&gt;&#123;product.description.substring(<span class="number">0</span>, <span class="number">100</span>)&#125;&lt;/p&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;black-10&quot;</span>&gt;$&#123;product.price&#125;&lt;/p&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;black-9&quot;</span>&gt;</span><br><span class="line">          Category: &#123;product.category &amp;&amp; product.category.name&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p className=<span class="string">&quot;black-8&quot;</span>&gt;</span><br><span class="line">          Added on &#123;moment(product.createdAt).fromNow()&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &#123;showStock(product.quantity)&#125;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &#123;showViewButton(showViewProductButton)&#125;</span><br><span class="line">        &#123;showAddToCard(showAddCartButton)&#125;</span><br><span class="line">        &#123;showRemoveButton(showRemoveProductButton)&#125;</span><br><span class="line">        &#123;showCartUpdateotions(cartUpdate)&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-cartHelpers-js"><a href="#x2F-src-x2F-core-x2F-cartHelpers-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;cartHelpers.js"></a>.&#x2F;src&#x2F;core&#x2F;cartHelpers.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/cartHelpers.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">item, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cart = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      cart = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  cart.push(&#123;</span><br><span class="line">    ...item,</span><br><span class="line">    count: <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br><span class="line">  cart = <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>(cart.map(<span class="function">(<span class="params">p</span>) =&gt;</span> p._id))).map(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cart.find(<span class="function">(<span class="params">p</span>) =&gt;</span> p._id === id);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;cart&quot;</span>, <span class="built_in">JSON</span>.stringify(cart));</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">itemTotal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)).length;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getCart</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateItem</span>(<span class="params">productId, count</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cart = [];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      cart = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line array-callback-return</span></span><br><span class="line">    cart.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (product._id === productId) &#123;</span><br><span class="line">        cart[i].count = count;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;cart&quot;</span>, <span class="built_in">JSON</span>.stringify(cart));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeItem</span>(<span class="params">productId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cart = [];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      cart = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line array-callback-return</span></span><br><span class="line">    cart.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (product._id === productId) &#123;</span><br><span class="line">        cart.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;cart&quot;</span>, <span class="built_in">JSON</span>.stringify(cart));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cart;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-Menu-js-4"><a href="#x2F-src-x2F-core-x2F-Menu-js-4" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Menu.js"></a>.&#x2F;src&#x2F;core&#x2F;Menu.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Menu.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link, useNavigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="comment">// add history, doesn&#x27;t install</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&quot;history&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; signout, isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; itemTotal &#125; <span class="keyword">from</span> <span class="string">&quot;./cartHelpers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isActive = <span class="function">(<span class="params">history, path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (history.location.pathname === path) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ff9900&quot;</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Menu = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// add history</span></span><br><span class="line">  <span class="keyword">const</span> history = createBrowserHistory(props);</span><br><span class="line">  <span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSignout = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 指執行 callback function next</span></span><br><span class="line">    signout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      navigate(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// console.log(&quot;Manu render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;nav nav-tabs bg-primary&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> style=&#123;isActive(history, <span class="string">&quot;/&quot;</span>)&#125; to=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">            Home</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link</span><br><span class="line">            className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">            style=&#123;isActive(history, <span class="string">&quot;/shop&quot;</span>)&#125;</span><br><span class="line">            to=<span class="string">&quot;/shop&quot;</span></span><br><span class="line">          &gt;</span><br><span class="line">            Shop</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link</span><br><span class="line">            className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">            style=&#123;isActive(history, <span class="string">&quot;/cart&quot;</span>)&#125;</span><br><span class="line">            to=<span class="string">&quot;/cart&quot;</span></span><br><span class="line">          &gt;</span><br><span class="line">            Cart&#123;<span class="string">&quot; &quot;</span>&#125;</span><br><span class="line">            &lt;sup&gt;</span><br><span class="line">              &lt;small className=<span class="string">&quot;cart-badge&quot;</span>&gt;&#123;itemTotal()&#125;&lt;/small&gt;</span><br><span class="line">            &lt;/sup&gt;</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; isAuthenticated().user.role === <span class="number">0</span> &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &lt;Link</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;isActive(history, <span class="string">&quot;/user/dashboard&quot;</span>)&#125;</span><br><span class="line">              to=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              Dashboard</span><br><span class="line">            &lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line"></span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; isAuthenticated().user.role === <span class="number">1</span> &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &lt;Link</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;isActive(history, <span class="string">&quot;/admin/dashboard&quot;</span>)&#125;</span><br><span class="line">              to=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              Dashboard</span><br><span class="line">            &lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line"></span><br><span class="line">        &#123;!isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;Fragment&gt;</span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signup&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signup&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signup</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line"></span><br><span class="line">            &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">              &lt;Link</span><br><span class="line">                className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">                style=&#123;isActive(history, <span class="string">&quot;/signin&quot;</span>)&#125;</span><br><span class="line">                to=<span class="string">&quot;/signin&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Signin</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/Fragment&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">        &#123;isAuthenticated() &amp;&amp; (</span><br><span class="line">          &lt;li className=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">            &#123;<span class="comment">/* 因直接執行而不是切到另一頁,使用 span 即可 */</span>&#125;</span><br><span class="line">            &lt;span</span><br><span class="line">              className=<span class="string">&quot;nav-link&quot;</span></span><br><span class="line">              style=&#123;&#123; <span class="attr">cursor</span>: <span class="string">&quot;pointer&quot;</span>, <span class="attr">color</span>: <span class="string">&quot;#ffffff&quot;</span> &#125;&#125;</span><br><span class="line">              onClick=&#123;handleSignout&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              Signout</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Menu;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-core-x2F-Checkbox-js-1"><a href="#x2F-src-x2F-core-x2F-Checkbox-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Checkbox.js"></a>.&#x2F;src&#x2F;core&#x2F;Checkbox.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Checkbox.js</span></span><br><span class="line"><span class="comment">/* eslint-disable array-callback-return */</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Checkbox</span>(<span class="params">&#123; categories, handleFilters &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [checked, setChecked] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ***---&gt;&gt;&gt; event include parameter</span></span><br><span class="line">  <span class="keyword">const</span> handleToggle = <span class="function">(<span class="params">c</span>) =&gt;</span> <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// return the first index or -1</span></span><br><span class="line">    <span class="keyword">const</span> currentCategoryId = checked.indexOf(c);</span><br><span class="line">    <span class="keyword">const</span> newCheckedCategoryId = [...checked];</span><br><span class="line">    <span class="comment">// if current checked was not already in checked state &gt; push</span></span><br><span class="line">    <span class="comment">// else pull/take off</span></span><br><span class="line">    <span class="keyword">if</span> (currentCategoryId === -<span class="number">1</span>) &#123;</span><br><span class="line">      newCheckedCategoryId.push(c);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      newCheckedCategoryId.splice(currentCategoryId, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(newCheckedCategoryId);</span></span><br><span class="line">    setChecked(newCheckedCategoryId);</span><br><span class="line">    handleFilters(newCheckedCategoryId);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> categories.map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> (</span><br><span class="line">    &lt;li key=&#123;i&#125; className=<span class="string">&quot;list-unstyled&quot;</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* value=false --&gt;not select  */</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/* ***---&gt;&gt;&gt; event include parameter */</span>&#125;</span><br><span class="line">      &lt;input</span><br><span class="line">        onChange=&#123;handleToggle(c._id)&#125;</span><br><span class="line">        value=&#123;checked.indexOf(c._id) === -<span class="number">1</span>&#125;</span><br><span class="line">        type=<span class="string">&quot;checkbox&quot;</span></span><br><span class="line">        className=<span class="string">&quot;form-check-input&quot;</span></span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;label htmlFor=<span class="string">&quot;form-check-label&quot;</span>&gt;&#123;c.name&#125;&lt;/label&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-src-x2F-styles-css-2"><a href="#x2F-src-x2F-styles-css-2" class="headerlink" title=".&#x2F;src&#x2F;styles.css"></a>.&#x2F;src&#x2F;styles.css</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ./src/styles.css */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* board radis </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">.btn,</span><br><span class="line">.jumbotron,</span><br><span class="line">.nav :hover &#123;</span><br><span class="line">  border-radius: 0px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* cart badge */</span></span><br><span class="line">.cart-badge,</span><br><span class="line">.cart-badge:hover &#123;</span><br><span class="line">  border-radius: <span class="number">50</span>%;</span><br><span class="line">  padding: 2px;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  font-style: italic;</span><br><span class="line">  background: #000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* single product page - product name</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">.name &#123;</span><br><span class="line">  background: indigo;</span><br><span class="line">  color: #fff;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* black shade from 10-1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">.black-<span class="number">10</span> &#123;</span><br><span class="line">  background: #f2f2f2;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">9</span> &#123;</span><br><span class="line">  background: #e6e6e6;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">8</span> &#123;</span><br><span class="line">  background: #d9d9d9;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">7</span> &#123;</span><br><span class="line">  background: #cccccc;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">6</span> &#123;</span><br><span class="line">  background: #bfbfbf;</span><br><span class="line">&#125;</span><br><span class="line">.black-<span class="number">5</span> &#123;</span><br><span class="line">  background: #b3b3b3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* product image on card </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">.product-img &#123;</span><br><span class="line">  min-height: 100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* jumbotron animation</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">.jumbotron &#123;</span><br><span class="line">  width: 30wh;</span><br><span class="line">  height: 30vh;</span><br><span class="line">  color: #fff;</span><br><span class="line">  background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);</span><br><span class="line">  background-size: <span class="number">400</span>% <span class="number">400</span>%;</span><br><span class="line">  -webkit-animation: Gradient 15s ease infinite;</span><br><span class="line">  -moz-animation: Gradient 15s ease infinite;</span><br><span class="line">  animation: Gradient 15s ease infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-webkit-keyframes Gradient &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50</span>% &#123;</span><br><span class="line">    background-position: <span class="number">100</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-moz-keyframes Gradient &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50</span>% &#123;</span><br><span class="line">    background-position: <span class="number">100</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes Gradient &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50</span>% &#123;</span><br><span class="line">    background-position: <span class="number">100</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    background-position: <span class="number">0</span>% <span class="number">50</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Payment-Gateway"><a href="#Payment-Gateway" class="headerlink" title="Payment Gateway"></a>Payment Gateway</h3><h4 id="Back-End-1"><a href="#Back-End-1" class="headerlink" title="Back End"></a>Back End</h4><h5 id="install-4"><a href="#install-4" class="headerlink" title="install"></a>install</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install briantree</span></span><br><span class="line">npm i braintree</span><br></pre></td></tr></table></figure>

<h5 id="x2F-app-js"><a href="#x2F-app-js" class="headerlink" title=".&#x2F;app.js"></a>.&#x2F;app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./app.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// connect mangoDB altas</span></span><br><span class="line"><span class="comment">// using 2.2.12 or later&#x27;s uri</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="comment">// import routes</span></span><br><span class="line"><span class="keyword">const</span> authRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/auth&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> userRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/user&quot;</span>);</span><br><span class="line"><span class="comment">// add Category and Product</span></span><br><span class="line"><span class="keyword">const</span> categoryRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/category&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> productRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/product&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> braintreeRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/braintree&quot;</span>);</span><br><span class="line"><span class="comment">// import morgan</span></span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">&quot;morgan&quot;</span>);</span><br><span class="line"><span class="comment">// cookie-parser</span></span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="comment">// express-validator</span></span><br><span class="line"><span class="keyword">const</span> expressValidator = <span class="built_in">require</span>(<span class="string">&quot;express-validator&quot;</span>);</span><br><span class="line"><span class="comment">// cors</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&quot;cors&quot;</span>);</span><br><span class="line"><span class="comment">// env</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>).config();</span><br><span class="line"></span><br><span class="line"><span class="comment">// app</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// connect mangoDB altas</span></span><br><span class="line"><span class="comment">// using 2.2.12 or later&#x27;s uri</span></span><br><span class="line">mongoose</span><br><span class="line">  .connect(process.env.DATABASE, &#123;</span><br><span class="line">    useNewUrlParser: <span class="literal">true</span>,</span><br><span class="line">    useUnifiedTopology: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;MongoDB Connected…&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// middlewares</span></span><br><span class="line">app.use(morgan(<span class="string">&quot;dev&quot;</span>)); <span class="comment">// morgan - http request log</span></span><br><span class="line">app.use(express.json()); <span class="comment">// body parser</span></span><br><span class="line">app.use(cookieParser()); <span class="comment">// cookie-parser</span></span><br><span class="line">app.use(expressValidator()); <span class="comment">// express-validator</span></span><br><span class="line">app.use(cors()); <span class="comment">// cors</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// routes middleware</span></span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, authRoutes);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, userRoutes);</span><br><span class="line"><span class="comment">// add Category and Product</span></span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, categoryRoutes);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, productRoutes);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, braintreeRoutes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h5 id="x2F-routes-x2F-braintree-js"><a href="#x2F-routes-x2F-braintree-js" class="headerlink" title=".&#x2F;routes&#x2F;braintree.js"></a>.&#x2F;routes&#x2F;braintree.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./routes/braintree.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="comment">// add controller</span></span><br><span class="line"><span class="keyword">const</span> &#123; requireSignin, isAuth &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/auth&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; userById &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; generateToken, processPayment &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/braintree&quot;</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&quot;/braintree/getToken/:userId&quot;</span>, requireSignin, isAuth, generateToken);</span><br><span class="line">router.post(</span><br><span class="line">  <span class="string">&quot;/braintree/payment/:userId&quot;</span>,</span><br><span class="line">  requireSignin,</span><br><span class="line">  isAuth,</span><br><span class="line">  processPayment</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">router.param(<span class="string">&quot;userId&quot;</span>, userById);</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-controllers-x2F-braintree-js"><a href="#x2F-controllers-x2F-braintree-js" class="headerlink" title=".&#x2F;controllers&#x2F;braintree.js"></a>.&#x2F;controllers&#x2F;braintree.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controllers/braintree.js</span></span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">&quot;../models/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> braintree = <span class="built_in">require</span>(<span class="string">&quot;braintree&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>).config();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gateway = <span class="keyword">new</span> braintree.BraintreeGateway(&#123;</span><br><span class="line">  environment: braintree.Environment.Sandbox,</span><br><span class="line">  merchantId: process.env.BRAINTREE_MERCHANT_ID,</span><br><span class="line">  publicKey: process.env.BRAINTREE_PUBLIC_KEY,</span><br><span class="line">  privateKey: process.env.BRAINTREE_PRIVATE_KEY,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.generateToken = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// transaction 設定 merchantAccountId 就好,clientToken 可以不用設</span></span><br><span class="line">  <span class="comment">// 但若要顯示 payment 的方式,就要設定</span></span><br><span class="line">  <span class="comment">// gateway.clientToken.generate(&#123;&#125;, function (err, response) &#123;</span></span><br><span class="line">  gateway.clientToken.generate(</span><br><span class="line">    &#123; <span class="attr">merchantAccountId</span>: process.env.BRAINTREE_MERCHANT_ACCOUNT_ID &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">err, response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        res.status(<span class="number">500</span>).send(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(response);</span></span><br><span class="line">        res.send(response);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.processPayment = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> nonceFromTheClient = req.body.paymentMethodNonce;</span><br><span class="line">  <span class="keyword">let</span> amountFromTheClient = req.body.amount;</span><br><span class="line">  <span class="comment">// charge</span></span><br><span class="line">  <span class="keyword">let</span> newTransaction = gateway.transaction.sale(</span><br><span class="line">    &#123;</span><br><span class="line">      amount: amountFromTheClient,</span><br><span class="line">      paymentMethodNonce: nonceFromTheClient,</span><br><span class="line">      <span class="comment">// 可設定不同的 merchantAccountId( for 不同的貨幣)</span></span><br><span class="line">      merchantAccountId: process.env.BRAINTREE_MERCHANT_ACCOUNT_ID,</span><br><span class="line">      options: &#123;</span><br><span class="line">        submitForSettlement: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    (error, result) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        res.status(<span class="number">500</span>).json(error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(result);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PORT=<span class="number">8000</span></span><br><span class="line">DATABASE=mongodb:...</span><br><span class="line">JWT_SECRET=...</span><br><span class="line">BRAINTREE_MERCHANT_ID=...</span><br><span class="line">BRAINTREE_PUBLIC_KEY=...</span><br><span class="line">BRAINTREE_PRIVATE_KEY=...</span><br><span class="line">BRAINTREE_MERCHANT_ACCOUNT_ID=...</span><br></pre></td></tr></table></figure>

<h4 id="Front-End-2"><a href="#Front-End-2" class="headerlink" title="Front End"></a>Front End</h4><h5 id="install-5"><a href="#install-5" class="headerlink" title="install"></a>install</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># insatll braintree-web-drop-in-react</span></span><br><span class="line">npm i braintree-web-drop-in-react</span><br></pre></td></tr></table></figure>


<h5 id="x2F-src-x2F-core-x2F-Checkout-js"><a href="#x2F-src-x2F-core-x2F-Checkout-js" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Checkout.js"></a>.&#x2F;src&#x2F;core&#x2F;Checkout.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Checkout.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> DropIn <span class="keyword">from</span> <span class="string">&quot;braintree-web-drop-in-react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getBraintreeClientToken, processPayment &#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; emptyCart &#125; <span class="keyword">from</span> <span class="string">&quot;./cartHelpers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Checkout</span>(<span class="params">&#123; products, handelUpdate &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState(&#123;</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    success: <span class="literal">false</span>,</span><br><span class="line">    clientToken: <span class="literal">null</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    instance: &#123;&#125;,</span><br><span class="line">    address: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userId = isAuthenticated() &amp;&amp; isAuthenticated().user._id;</span><br><span class="line">  <span class="keyword">const</span> token = isAuthenticated() &amp;&amp; isAuthenticated().token;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getToken(userId, token);</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getTotal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> products.reduce(<span class="function">(<span class="params">currentValue, nextValue</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> currentValue + nextValue.count * nextValue.price;</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params">userId, token</span>) </span>&#123;</span><br><span class="line">    getBraintreeClientToken(userId, token).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.error) &#123;</span><br><span class="line">        setData(&#123; ...data, <span class="attr">error</span>: response.error &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// setData(&#123; ...data, clientToken: response.clientToken &#125;);</span></span><br><span class="line">        setData(&#123; <span class="attr">clientToken</span>: response.clientToken &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showCheckout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isAuthenticated() ? (</span><br><span class="line">      &lt;div&gt;&#123;showDropIn()&#125;&lt;/div&gt;</span><br><span class="line">    ) : (</span><br><span class="line">      &lt;Link to=<span class="string">&quot;/signin&quot;</span>&gt;</span><br><span class="line">        &lt;button className=<span class="string">&quot;btn btn-primary&quot;</span>&gt;Sign <span class="keyword">in</span> to checkout&lt;/button&gt;</span><br><span class="line">      &lt;/Link&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleBuy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setData(&#123; ...data, <span class="attr">loading</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    <span class="comment">// send the nonce to your server</span></span><br><span class="line">    <span class="comment">// nunce = data.instance.requestPaymentMethod()</span></span><br><span class="line">    <span class="keyword">let</span> nonce;</span><br><span class="line">    <span class="comment">// console.log(&quot;data&quot;, data);</span></span><br><span class="line">    <span class="keyword">if</span> (products.length) &#123;</span><br><span class="line">      <span class="comment">// let getNonce = data.instance</span></span><br><span class="line">      data.instance</span><br><span class="line">        .requestPaymentMethod()</span><br><span class="line">        .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// console.log(data);</span></span><br><span class="line">          nonce = data.nonce;</span><br><span class="line">          <span class="comment">// once you have nonce (Card type, card number) send nonce as paymentMethodNonce</span></span><br><span class="line">          <span class="comment">// and also total to be charged</span></span><br><span class="line">          <span class="comment">// console.log(</span></span><br><span class="line">          <span class="comment">//   &quot;send nonce and total to process : &quot;,</span></span><br><span class="line">          <span class="comment">//   nonce,</span></span><br><span class="line">          <span class="comment">//   getTotal(products)</span></span><br><span class="line">          <span class="comment">// );</span></span><br><span class="line">          <span class="keyword">const</span> paymentData = &#123;</span><br><span class="line">            paymentMethodNonce: nonce,</span><br><span class="line">            amount: getTotal(products),</span><br><span class="line">            <span class="comment">// merchant_account_id: &quot;dhewgthty&quot;,</span></span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line">          processPayment(userId, token, paymentData)</span><br><span class="line">            .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// console.log(response);</span></span><br><span class="line">              setData(&#123; ...data, <span class="attr">success</span>: response.success &#125;);</span><br><span class="line">              <span class="comment">// empty cart</span></span><br><span class="line">              emptyCart(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(&quot;payment success and empty cart&quot;);</span></span><br><span class="line">                setData(&#123; ...data, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">              &#125;);</span><br><span class="line">              handelUpdate();</span><br><span class="line">              <span class="comment">// create order</span></span><br><span class="line">              <span class="comment">// console.log(&quot;paymentData:&quot;, paymentData);</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(error);</span><br><span class="line">              setData(&#123; ...data, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&quot;dropin error: &quot;</span>, error);</span><br><span class="line">          setData(&#123; ...data, <span class="attr">error</span>: error.message &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">shwoSucess</span>(<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div</span><br><span class="line">        className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">        style=&#123;&#123; <span class="attr">display</span>: success ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        Thanks! Your Payment was successful!</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">shwoLoading</span>(<span class="params">loading</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> loading &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">shwoError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div</span><br><span class="line">        className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">        style=&#123;&#123; <span class="attr">display</span>: error ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;error&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showDropIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div onBlur=&#123;<span class="function">() =&gt;</span> setData(&#123; ...data, <span class="attr">error</span>: <span class="string">&quot;&quot;</span> &#125;)&#125;&gt;</span><br><span class="line">        &#123;data.clientToken != <span class="literal">null</span> &amp;&amp; products.length &gt; <span class="number">0</span> ? (</span><br><span class="line">          &lt;DropIn</span><br><span class="line">            options=&#123;&#123;</span><br><span class="line">              authorization: data.clientToken,</span><br><span class="line">              <span class="comment">// ad paypal option</span></span><br><span class="line">              paypal: &#123;</span><br><span class="line">                flow: <span class="string">&quot;vault&quot;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            onInstance=&#123;<span class="function">(<span class="params">instance</span>) =&gt;</span> (data.instance = instance)&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ) : <span class="literal">null</span>&#125;</span><br><span class="line">        &lt;button onClick=&#123;handleBuy&#125; className=<span class="string">&quot;btn btn-success btn-block&quot;</span>&gt;</span><br><span class="line">          Pay</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h2&gt;Total: $&#123;getTotal()&#125;&lt;/h2&gt;</span><br><span class="line">      &#123;shwoLoading(data.loading)&#125;</span><br><span class="line">      &#123;shwoSucess(data.success)&#125;</span><br><span class="line">      &#123;shwoError(data.error)&#125;</span><br><span class="line">      &#123;showCheckout()&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-ApiCore-js-4"><a href="#x2F-src-x2F-admin-x2F-ApiCore-js-4" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiCore.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiCore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> queryString <span class="keyword">from</span> <span class="string">&quot;query-string&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProducts = <span class="function">(<span class="params">sortBy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products?sortBy=<span class="subst">$&#123;sortBy&#125;</span>&amp;order=desc&amp;limit=6`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getFilteredProducts = <span class="function">(<span class="params">skip, limit, filters</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123; limit, skip, filters &#125;;</span><br><span class="line">  <span class="comment">// console.log(data);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/by/search`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> list = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = queryString.stringify(params);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/search?<span class="subst">$&#123;query&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> read = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;productid=&quot;</span>, productId);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/<span class="subst">$&#123;productId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> listRelated = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/related/<span class="subst">$&#123;productId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBraintreeClientToken = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/braintree/getToken/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> processPayment = <span class="function">(<span class="params">userId, token, paymentData</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(userId, token, paymentData);</span></span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/braintree/payment/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(paymentData),</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h5 id="x2F-src-x2F-core-x2F-Cart-js-1"><a href="#x2F-src-x2F-core-x2F-Cart-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Cart.js"></a>.&#x2F;src&#x2F;core&#x2F;Cart.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Cart.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;./Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCart &#125; <span class="keyword">from</span> <span class="string">&quot;./cartHelpers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Card <span class="keyword">from</span> <span class="string">&quot;./Card&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Checkout <span class="keyword">from</span> <span class="string">&quot;./Checkout&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Cart</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [items, setItems] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [updateScreen, setUpdateScreen] = useState(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setItems(getCart());</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, [updateScreen]);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleUpdateScreen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setUpdateScreen(!updateScreen);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showItems</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;Your cart has &#123;items.length&#125; items&lt;/h2&gt;</span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line">        &#123;items.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;Card</span><br><span class="line">            key=&#123;i&#125;</span><br><span class="line">            product=&#123;product&#125;</span><br><span class="line">            showAddCartButton=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">            cartUpdate=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">            showRemoveProductButton=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">            handelUpdate=&#123;handleUpdateScreen&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">noItemsMessage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;h2&gt;</span><br><span class="line">        Your cart is empty.</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;Link to=<span class="string">&quot;/shop&quot;</span>&gt; Continue shopping&lt;/Link&gt;</span><br><span class="line">      &lt;/h2&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Shopping Cart&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Manage your cart items. Add remove checkout or continue shopping&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-6&quot;</span>&gt;</span><br><span class="line">          &#123;items.length &gt; <span class="number">0</span> ? showItems(items) : noItemsMessage()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-6&quot;</span>&gt;</span><br><span class="line">          &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Your cart summy&lt;/h2&gt;</span><br><span class="line">          &lt;hr /&gt;</span><br><span class="line">          &lt;Checkout</span><br><span class="line">            products=&#123;items&#125;</span><br><span class="line">            handelUpdate=&#123;handleUpdateScreen&#125;</span><br><span class="line">          &gt;&lt;/Checkout&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-cartHelpers-js-1"><a href="#x2F-src-x2F-core-x2F-cartHelpers-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;cartHelpers.js"></a>.&#x2F;src&#x2F;core&#x2F;cartHelpers.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/cartHelpers.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">item, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cart = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      cart = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  cart.push(&#123;</span><br><span class="line">    ...item,</span><br><span class="line">    count: <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  cart = <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>(cart.map(<span class="function">(<span class="params">p</span>) =&gt;</span> p._id))).map(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cart.find(<span class="function">(<span class="params">p</span>) =&gt;</span> p._id === id);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// console.log(cart);</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;cart&quot;</span>, <span class="built_in">JSON</span>.stringify(cart));</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">itemTotal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)).length;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getCart</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateItem</span>(<span class="params">productId, count</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cart = [];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      cart = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line array-callback-return</span></span><br><span class="line">    cart.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (product._id === productId) &#123;</span><br><span class="line">        cart[i].count = count;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;cart&quot;</span>, <span class="built_in">JSON</span>.stringify(cart));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeItem</span>(<span class="params">productId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cart = [];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>)) &#123;</span><br><span class="line">      cart = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;cart&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line array-callback-return</span></span><br><span class="line">    cart.map(<span class="function">(<span class="params">product, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (product._id === productId) &#123;</span><br><span class="line">        cart.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;cart&quot;</span>, <span class="built_in">JSON</span>.stringify(cart));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cart;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">emptyCart</span>(<span class="params">next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.removeItem(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="add-Order"><a href="#add-Order" class="headerlink" title="add Order"></a>add Order</h3><h4 id="Back-End-2"><a href="#Back-End-2" class="headerlink" title="Back End"></a>Back End</h4><h5 id="x2F-app-js-1"><a href="#x2F-app-js-1" class="headerlink" title=".&#x2F;app.js"></a>.&#x2F;app.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./app.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// connect mangoDB altas</span></span><br><span class="line"><span class="comment">// using 2.2.12 or later&#x27;s uri</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="comment">// import routes</span></span><br><span class="line"><span class="keyword">const</span> authRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/auth&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> userRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/user&quot;</span>);</span><br><span class="line"><span class="comment">// add Category and Product</span></span><br><span class="line"><span class="keyword">const</span> categoryRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/category&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> productRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/product&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> braintreeRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/braintree&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> orderRoutes = <span class="built_in">require</span>(<span class="string">&quot;./routes/order&quot;</span>);</span><br><span class="line"><span class="comment">// import morgan</span></span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">&quot;morgan&quot;</span>);</span><br><span class="line"><span class="comment">// cookie-parser</span></span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="comment">// express-validator</span></span><br><span class="line"><span class="keyword">const</span> expressValidator = <span class="built_in">require</span>(<span class="string">&quot;express-validator&quot;</span>);</span><br><span class="line"><span class="comment">// cors</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&quot;cors&quot;</span>);</span><br><span class="line"><span class="comment">// env</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>).config();</span><br><span class="line"></span><br><span class="line"><span class="comment">// app</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// connect mangoDB altas</span></span><br><span class="line"><span class="comment">// using 2.2.12 or later&#x27;s uri</span></span><br><span class="line">mongoose</span><br><span class="line">  .connect(process.env.DATABASE, &#123;</span><br><span class="line">    useNewUrlParser: <span class="literal">true</span>,</span><br><span class="line">    useUnifiedTopology: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;MongoDB Connected…&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// middlewares</span></span><br><span class="line">app.use(morgan(<span class="string">&quot;dev&quot;</span>)); <span class="comment">// morgan - http request log</span></span><br><span class="line">app.use(express.json()); <span class="comment">// body parser</span></span><br><span class="line">app.use(cookieParser()); <span class="comment">// cookie-parser</span></span><br><span class="line">app.use(expressValidator()); <span class="comment">// express-validator</span></span><br><span class="line">app.use(cors()); <span class="comment">// cors</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// routes middleware</span></span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, authRoutes);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, userRoutes);</span><br><span class="line"><span class="comment">// add Category and Product</span></span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, categoryRoutes);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, productRoutes);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, braintreeRoutes);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, orderRoutes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="x2F-routes-x2F-order-js"><a href="#x2F-routes-x2F-order-js" class="headerlink" title=".&#x2F;routes&#x2F;order.js"></a>.&#x2F;routes&#x2F;order.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./routes/order.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="comment">// add controller</span></span><br><span class="line"><span class="keyword">const</span> &#123; requireSignin, isAuth, isAdmin &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/auth&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; userById, addOrderToUserHistory &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  create,</span><br><span class="line">  listOrders,</span><br><span class="line">  getStatusValues,</span><br><span class="line">  orderById,</span><br><span class="line">  updateOrderStatus,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/order&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; descreaseQuantity &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/product&quot;</span>);</span><br><span class="line"></span><br><span class="line">router.post(</span><br><span class="line">  <span class="string">&quot;/order/create/:userId&quot;</span>,</span><br><span class="line">  requireSignin,</span><br><span class="line">  isAuth,</span><br><span class="line">  addOrderToUserHistory,</span><br><span class="line">  descreaseQuantity,</span><br><span class="line">  create</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&quot;/order/list/:userId&quot;</span>, requireSignin, isAuth, isAdmin, listOrders);</span><br><span class="line">router.get(</span><br><span class="line">  <span class="string">&quot;/order/status-values/:userId&quot;</span>,</span><br><span class="line">  requireSignin,</span><br><span class="line">  isAuth,</span><br><span class="line">  isAdmin,</span><br><span class="line">  getStatusValues</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">router.put(</span><br><span class="line">  <span class="string">&quot;/order/:orderId/status/:userId&quot;</span>,</span><br><span class="line">  requireSignin,</span><br><span class="line">  isAuth,</span><br><span class="line">  isAdmin,</span><br><span class="line">  updateOrderStatus</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">router.param(<span class="string">&quot;userId&quot;</span>, userById);</span><br><span class="line">router.param(<span class="string">&quot;orderId&quot;</span>, orderById);</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-models-x2F-orders-js"><a href="#x2F-models-x2F-orders-js" class="headerlink" title=".&#x2F;models&#x2F;orders.js"></a>.&#x2F;models&#x2F;orders.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./models/orders.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="keyword">const</span> &#123; ObjectId &#125; = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CartItemSchema = <span class="keyword">new</span> mongoose.Schema(</span><br><span class="line">  &#123;</span><br><span class="line">    product: &#123; <span class="attr">type</span>: ObjectId, <span class="attr">ref</span>: <span class="string">&quot;Product&quot;</span> &#125;,</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    price: <span class="built_in">Number</span>,</span><br><span class="line">    count: <span class="built_in">Number</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">timestamps</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CartItem = mongoose.model(<span class="string">&quot;CartItem&quot;</span>, CartItemSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OrderSchema = <span class="keyword">new</span> mongoose.Schema(</span><br><span class="line">  &#123;</span><br><span class="line">    products: [CartItemSchema],</span><br><span class="line">    transaction_id: &#123;&#125;,</span><br><span class="line">    amount: &#123; <span class="attr">type</span>: <span class="built_in">Number</span> &#125;,</span><br><span class="line">    address: <span class="built_in">String</span>,</span><br><span class="line">    status: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">&quot;Not processed&quot;</span>,</span><br><span class="line">      enum: [<span class="string">&quot;Not processed&quot;</span>, <span class="string">&quot;Processing&quot;</span>, <span class="string">&quot;Shipped&quot;</span>, <span class="string">&quot;Delivered&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    updated: <span class="built_in">Date</span>,</span><br><span class="line">    user: &#123; <span class="attr">type</span>: ObjectId, <span class="attr">ref</span>: <span class="string">&quot;User&quot;</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">timestamps</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Order = mongoose.model(<span class="string">&quot;Order&quot;</span>, OrderSchema);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; Order, CartItem &#125;;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-controllers-x2F-order-js"><a href="#x2F-controllers-x2F-order-js" class="headerlink" title=".&#x2F;controllers&#x2F;order.js"></a>.&#x2F;controllers&#x2F;order.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controllers/order.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; Order, CartItem &#125; = <span class="built_in">require</span>(<span class="string">&quot;../models/order&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; errorHandler &#125; = <span class="built_in">require</span>(<span class="string">&quot;../helpers/dbErrorHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.orderById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  Order.findById(id)</span><br><span class="line">    .populate(<span class="string">&quot;products.product&quot;</span>, <span class="string">&quot;name price&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">error, order</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(error),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      req.order = order;</span><br><span class="line">      next();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.create = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.body.order.user = req.profile;</span><br><span class="line">  <span class="keyword">const</span> order = <span class="keyword">new</span> Order(req.body.order);</span><br><span class="line">  order.save(<span class="function">(<span class="params">error, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: errorHandler(error),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listOrders = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  Order.find()</span><br><span class="line">    .populate(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;_id name address&quot;</span>)</span><br><span class="line">    .sort(<span class="string">&quot;-created&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">error, orders</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(error),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(orders);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.getStatusValues = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(Order.schema.path(<span class="string">&quot;status&quot;</span>).enumValues);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.updateOrderStatus = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req);</span><br><span class="line">  Order.update(</span><br><span class="line">    &#123; <span class="attr">_id</span>: req.body.orderId &#125;,</span><br><span class="line">    &#123; <span class="attr">$set</span>: &#123; <span class="attr">status</span>: req.body.status &#125; &#125;,</span><br><span class="line">    (error, order) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;????&quot;</span>, error);</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(error),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(order);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-controllers-x2F-user-js"><a href="#x2F-controllers-x2F-user-js" class="headerlink" title=".&#x2F;controllers&#x2F;user.js"></a>.&#x2F;controllers&#x2F;user.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controllers/user.js</span></span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">&quot;../models/user&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.userById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  User.findById(id).exec(<span class="function">(<span class="params">err, user</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err || !user) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;User not found&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    req.profile = user;</span><br><span class="line">    next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.read = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.profile.hashed_password = <span class="literal">undefined</span>;</span><br><span class="line">  req.profile.salt = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> res.json(req.profile);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.update = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  User.findOneAndUpdate(</span><br><span class="line">    &#123; <span class="attr">_id</span>: req.profile._id &#125;,</span><br><span class="line">    &#123; <span class="attr">$set</span>: req.body &#125;,</span><br><span class="line">    &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    (err, user) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;You are not authorized to perform this action&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      req.profile.hashed_password = <span class="literal">undefined</span>;</span><br><span class="line">      req.profile.salt = <span class="literal">undefined</span>;</span><br><span class="line">      res.json(user);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.addOrderToUserHistory = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> history = [];</span><br><span class="line"></span><br><span class="line">  req.body.order.products.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    history.push(&#123;</span><br><span class="line">      _id: item._id,</span><br><span class="line">      name: item.name,</span><br><span class="line">      description: item.description,</span><br><span class="line">      category: item.category,</span><br><span class="line">      quantity: item.count,</span><br><span class="line">      transcation_id: req.body.order.transaction_id,</span><br><span class="line">      amount: req.body.order.amount,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  User.findOneAndUpdate(</span><br><span class="line">    &#123; <span class="attr">_id</span>: req.profile._id &#125;,</span><br><span class="line">    &#123; <span class="attr">$push</span>: &#123; <span class="attr">history</span>: history &#125; &#125;,</span><br><span class="line">    &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    (error, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Could not update user purchase history&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      next();</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-controller-x2F-product-js-2"><a href="#x2F-controller-x2F-product-js-2" class="headerlink" title=".&#x2F;controller&#x2F;product.js"></a>.&#x2F;controller&#x2F;product.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controller/product.js</span></span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">&quot;formidable&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Product = <span class="built_in">require</span>(<span class="string">&quot;../models/product&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; errorHandler &#125; = <span class="built_in">require</span>(<span class="string">&quot;../helpers/dbErrorHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.productById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  Product.findById(id)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, product</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err || !product) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Product does not exist&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      req.product = product;</span><br><span class="line">      next();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.read = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.product.photo = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> res.json(req.product);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.create = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check for all fieldd</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, description, price, category, quantity, shipping &#125; = fields;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !name ||</span><br><span class="line">      !description ||</span><br><span class="line">      !price ||</span><br><span class="line">      !category ||</span><br><span class="line">      !quantity ||</span><br><span class="line">      !shipping</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;All field are required&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = <span class="keyword">new</span> Product(fields);</span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="comment">// console.log(&quot;product:&quot;, result);</span></span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.remove = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> product = req.product;</span><br><span class="line">  product.remove(<span class="function">(<span class="params">err, deletedProduct</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: errorHandler(err),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      message: <span class="string">&quot;Product deleted successly&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.update = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check for all fieldd</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, description, price, category, quantity, shipping &#125; = fields;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !name ||</span><br><span class="line">      !description ||</span><br><span class="line">      !price ||</span><br><span class="line">      !category ||</span><br><span class="line">      !quantity ||</span><br><span class="line">      !shipping</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;All field are required&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = req.product;</span><br><span class="line">    <span class="comment">// fields 蓋過 product</span></span><br><span class="line">    product = _.extend(product, fields);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sel/arrival</span></span><br><span class="line"><span class="comment"> * bye sell = /products?sortBy=sold&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * bye arrival = /products?sortBy=createdAt&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * if no parameter are sent, then all products are returned</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">exports</span>.list = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.query.order ? req.query.order : <span class="string">&quot;asc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.query.sortBy ? req.query.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  Product.find()</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>) <span class="comment">// mapt to Category</span></span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// console.log(&quot;product-list:&quot;, products);</span></span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * it will find the products based on the req product category</span></span><br><span class="line"><span class="comment"> * other products that has the same category, will be return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listRelated = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// $ne: not include</span></span><br><span class="line">  Product.find(&#123; <span class="attr">_id</span>: &#123; <span class="attr">$ne</span>: req.product &#125;, <span class="attr">category</span>: req.product.category &#125;)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;_id name&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listCategories = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// distinct : 取出不同的 category</span></span><br><span class="line">  <span class="comment">// &#123;&#125; : 2nd parameter doesn&#x27;t need do no send value</span></span><br><span class="line">  Product.distinct(<span class="string">&quot;category&quot;</span>, &#123;&#125;, <span class="function">(<span class="params">err, categories</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Categories not found&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(categories);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * list products by search</span></span><br><span class="line"><span class="comment"> * we will implement product search in react frontend</span></span><br><span class="line"><span class="comment"> * we will show categories in checkbox and price range in radio buttons</span></span><br><span class="line"><span class="comment"> * as the user clicks on those checkbox and radio buttons</span></span><br><span class="line"><span class="comment"> * we will make api request and show the products to users based on what he wants</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//  &quot;skip&quot; : &quot;1&quot;,</span></span><br><span class="line"><span class="comment">//  &quot;limit&quot; : &quot;2&quot;,</span></span><br><span class="line"><span class="comment">// 	&quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">// 		&quot;name&quot;: &quot;Note&quot;</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// &gt;=2 and &lt;=19</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">// &quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">//   &quot;price&quot;: [&quot;2&quot;, &quot;19&quot;]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">exports</span>.listBySearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.body.order ? req.body.order : <span class="string">&quot;desc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.body.sortBy ? req.body.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.body.limit ? <span class="built_in">parseInt</span>(req.body.limit) : <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> skip = req.body.skip ? <span class="built_in">parseInt</span>(req.body.skip) : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> findArgs = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(order, sortBy, limit, skip, req.body.filters);</span></span><br><span class="line">  <span class="comment">// console.log(req.body);</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> req.body.filters) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.filters[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;price&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// gte - great than price</span></span><br><span class="line">        <span class="comment">// lte - less than</span></span><br><span class="line">        findArgs[key] = &#123;</span><br><span class="line">          $gte: req.body.filters[key][<span class="number">0</span>],</span><br><span class="line">          $lte: req.body.filters[key][<span class="number">1</span>],</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// findArgs[key] = new RegExp(req.body.filters[key]);</span></span><br><span class="line">        findArgs[key] = req.body.filters[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// console.log(&quot;findArgs&quot;, findArgs);</span></span><br><span class="line"></span><br><span class="line">  Product.find(findArgs)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .skip(skip)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        size: data.length,</span><br><span class="line">        data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.photo = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.product.photo.data) &#123;</span><br><span class="line">    res.set(<span class="string">&quot;Content-Type&quot;</span>, req.product.photo.contentType);</span><br><span class="line">    <span class="keyword">return</span> res.send(req.product.photo.data);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listSearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// create query object to hole search value and category value</span></span><br><span class="line">  <span class="keyword">const</span> query = &#123;&#125;;</span><br><span class="line">  <span class="comment">// assign search value to query name</span></span><br><span class="line">  <span class="keyword">if</span> (req.query.search) &#123;</span><br><span class="line">    <span class="comment">// mongodb regular expression</span></span><br><span class="line">    query.name = &#123; <span class="attr">$regex</span>: req.query.search, <span class="attr">$options</span>: <span class="string">&quot;i&quot;</span> &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(query.name);</span><br><span class="line">    <span class="comment">// assign category value to query.category</span></span><br><span class="line">    <span class="keyword">if</span> (req.query.category &amp;&amp; req.query.category != <span class="string">&quot;All&quot;</span>) &#123;</span><br><span class="line">      query.category = req.query.category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// find the product base on query object with 2 properties</span></span><br><span class="line">    <span class="comment">// search and category</span></span><br><span class="line">    Product.find(query, <span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;).select(<span class="string">&quot;-photo&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.descreaseQuantity = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> bulkOps = req.body.order.products.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      updateOne: &#123;</span><br><span class="line">        filter: &#123; <span class="attr">_id</span>: item._id &#125;,</span><br><span class="line">        update: &#123; <span class="attr">$inc</span>: &#123; <span class="attr">quantity</span>: -item.count, <span class="attr">sold</span>: +item.count &#125; &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  Product.bulkWrite(bulkOps, &#123;&#125;, <span class="function">(<span class="params">error, products</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Could not update product&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Front-End-3"><a href="#Front-End-3" class="headerlink" title="Front End"></a>Front End</h4><h5 id="x2F-src-x2F-AppRoutes-js-6"><a href="#x2F-src-x2F-AppRoutes-js-6" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddCategory <span class="keyword">from</span> <span class="string">&quot;./admin/AddCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddProduct <span class="keyword">from</span> <span class="string">&quot;./admin/AddProduct&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Shop <span class="keyword">from</span> <span class="string">&quot;./core/Shop&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Product <span class="keyword">from</span> <span class="string">&quot;./core/Product&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cart <span class="keyword">from</span> <span class="string">&quot;./core/Cart&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Orders <span class="keyword">from</span> <span class="string">&quot;./admin/Orders&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/shop&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Shop</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/category&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddCategory /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/product&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/product/:productId&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Product</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/cart&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Cart</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/orders&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;Orders /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-Orders-js"><a href="#x2F-src-x2F-admin-x2F-Orders-js" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;Orders.js"></a>.&#x2F;src&#x2F;admin&#x2F;Orders.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ./src/admin/Orders.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; listOrders, getStatusValues, updateOrderStatus &#125; <span class="keyword">from</span> <span class="string">&quot;./ApiAdmin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&quot;moment&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Orders</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [orders, setOrders] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> [statusValues, setStatusValues] = useState([]);</span><br><span class="line">  <span class="keyword">const</span> &#123; user, token &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadOrders</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    listOrders(user._id, token).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setOrders(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadStatusValue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    getStatusValues(user._id, token).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setStatusValues(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loadOrders();</span><br><span class="line">    loadStatusValue();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showOrdersLength</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (orders.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;h1 className=<span class="string">&quot;text-danger display-2&quot;</span>&gt;Total orders: &#123;orders.length&#125;&lt;/h1&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      &lt;h1 className=<span class="string">&quot;text-danger&quot;</span>&gt;No orders&lt;/h1&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleStatusChange</span>(<span class="params">e, orderId</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;update order status&quot;</span>);</span><br><span class="line">    updateOrderStatus(user._id, token, orderId, e.target.value).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;status update field&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        loadOrders();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showStatus</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(statusValues);</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&quot;from-group&quot;</span>&gt;</span><br><span class="line">        &lt;h3 className=<span class="string">&quot;mark mb-4&quot;</span>&gt;Status: &#123;o.status&#125;&lt;/h3&gt;</span><br><span class="line">        &lt;select</span><br><span class="line">          className=<span class="string">&quot;from-control&quot;</span></span><br><span class="line">          onChange=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> handleStatusChange(e, o._id)&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;option&gt;Update Status&lt;/option&gt;</span><br><span class="line">          &#123;statusValues.map(<span class="function">(<span class="params">status, index</span>) =&gt;</span> (</span><br><span class="line">            &lt;option key=&#123;index&#125; value=&#123;status&#125;&gt;</span><br><span class="line">              &#123;status&#125;</span><br><span class="line">            &lt;/option&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Orsers&quot;</span></span><br><span class="line">      description=&#123;<span class="string">`G&#x27;day <span class="subst">$&#123;user.name&#125;</span>, you can manage all the orders here`</span>&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-md-8 offset-md-2&quot;</span>&gt;</span><br><span class="line">          &#123;showOrdersLength()&#125;</span><br><span class="line">          &#123;orders.map(<span class="function">(<span class="params">o, oIndex</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">              &lt;div</span><br><span class="line">                className=<span class="string">&quot;mt-5&quot;</span></span><br><span class="line">                key=&#123;oIndex&#125;</span><br><span class="line">                style=&#123;&#123; <span class="attr">borderBottom</span>: <span class="string">&quot;5px solid indigo&quot;</span> &#125;&#125;</span><br><span class="line">              &gt;</span><br><span class="line">                &lt;h2 className=<span class="string">&quot;mb-5&quot;</span>&gt;</span><br><span class="line">                  &lt;span className=<span class="string">&quot;bg-primary&quot;</span>&gt;Order:&#123;o._id&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/h2&gt;</span><br><span class="line">                &lt;ul className=<span class="string">&quot;list-group mb-2&quot;</span>&gt;</span><br><span class="line">                  &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">                    &#123;o.status&#125;</span><br><span class="line">                    &#123;showStatus(o)&#125;</span><br><span class="line">                  &lt;/li&gt;</span><br><span class="line">                  &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">                    Transaction ID: &#123;o.transaction_id&#125;</span><br><span class="line">                  &lt;/li&gt;</span><br><span class="line">                  &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;Amount: &#123;o.amount&#125;&lt;/li&gt;</span><br><span class="line">                  &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;Order By: &#123;o.user.name&#125;&lt;/li&gt;</span><br><span class="line">                  &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">                    Ordered on: &#123;moment(o.createdAt).fromNow()&#125;</span><br><span class="line">                  &lt;/li&gt;</span><br><span class="line">                  &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">                    Delivery address: &#123;o.address&#125;</span><br><span class="line">                  &lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">                &lt;h3 className=<span class="string">&quot;mt-4 mb-4 font-italic&quot;</span>&gt;</span><br><span class="line">                  Total products <span class="keyword">in</span> the orders: &#123;o.products.length&#125;</span><br><span class="line">                &lt;/h3&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            );</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-UserDashboard-js-1"><a href="#x2F-src-x2F-core-x2F-UserDashboard-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;UserDashboard.js"></a>.&#x2F;src&#x2F;core&#x2F;UserDashboard.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/UserDashboard.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UserDashboard</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    user: &#123; name, email, role &#125;,</span><br><span class="line">  &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userLinks = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;User Links&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/cart&quot;</span>&gt;</span><br><span class="line">            My Cart</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/profile/update&quot;</span>&gt;</span><br><span class="line">            Update Profile</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;&#123;<span class="string">`G&#x27;Day <span class="subst">$&#123;name&#125;</span>!`</span>&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;name&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;email&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &#123;role === <span class="number">1</span> ? <span class="string">&quot;Admin&quot;</span> : <span class="string">&quot;Registrred User&quot;</span>&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> purchaseHistory = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;histtory&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Dashboard Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;User Dashboard&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-3&quot;</span>&gt;&#123;userLinks()&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-9&quot;</span>&gt;</span><br><span class="line">          &#123;userInfo()&#125;</span><br><span class="line">          &#123;purchaseHistory()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-Checkout-js-1"><a href="#x2F-src-x2F-core-x2F-Checkout-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;Checkout.js"></a>.&#x2F;src&#x2F;core&#x2F;Checkout.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/Checkout.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> DropIn <span class="keyword">from</span> <span class="string">&quot;braintree-web-drop-in-react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getBraintreeClientToken,</span><br><span class="line">  processPayment,</span><br><span class="line">  createOrder,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./apiCore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; emptyCart &#125; <span class="keyword">from</span> <span class="string">&quot;./cartHelpers&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Checkout</span>(<span class="params">&#123; products, handelUpdate &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState(&#123;</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    success: <span class="literal">false</span>,</span><br><span class="line">    clientToken: <span class="literal">null</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    instance: &#123;&#125;,</span><br><span class="line">    address: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userId = isAuthenticated() &amp;&amp; isAuthenticated().user._id;</span><br><span class="line">  <span class="keyword">const</span> token = isAuthenticated() &amp;&amp; isAuthenticated().token;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getToken(userId, token);</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getTotal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> products.reduce(<span class="function">(<span class="params">currentValue, nextValue</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> currentValue + nextValue.count * nextValue.price;</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params">userId, token</span>) </span>&#123;</span><br><span class="line">    getBraintreeClientToken(userId, token).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.error) &#123;</span><br><span class="line">        setData(&#123; ...data, <span class="attr">error</span>: response.error &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// setData(&#123; ...data, clientToken: response.clientToken &#125;);</span></span><br><span class="line">        setData(&#123; <span class="attr">clientToken</span>: response.clientToken &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showCheckout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isAuthenticated() ? (</span><br><span class="line">      &lt;div&gt;&#123;showDropIn()&#125;&lt;/div&gt;</span><br><span class="line">    ) : (</span><br><span class="line">      &lt;Link to=<span class="string">&quot;/signin&quot;</span>&gt;</span><br><span class="line">        &lt;button className=<span class="string">&quot;btn btn-primary&quot;</span>&gt;Sign <span class="keyword">in</span> to checkout&lt;/button&gt;</span><br><span class="line">      &lt;/Link&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> deliveryAddress = data.address;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleBuy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setData(&#123; ...data, <span class="attr">loading</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    <span class="comment">// send the nonce to your server</span></span><br><span class="line">    <span class="comment">// nunce = data.instance.requestPaymentMethod()</span></span><br><span class="line">    <span class="keyword">let</span> nonce;</span><br><span class="line">    <span class="comment">// console.log(&quot;data&quot;, data);</span></span><br><span class="line">    <span class="keyword">if</span> (products.length) &#123;</span><br><span class="line">      <span class="comment">// let getNonce = data.instance</span></span><br><span class="line">      data.instance</span><br><span class="line">        .requestPaymentMethod()</span><br><span class="line">        .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// console.log(data);</span></span><br><span class="line">          nonce = data.nonce;</span><br><span class="line">          <span class="comment">// once you have nonce (Card type, card number) send nonce as paymentMethodNonce</span></span><br><span class="line">          <span class="comment">// and also total to be charged</span></span><br><span class="line">          <span class="comment">// console.log(</span></span><br><span class="line">          <span class="comment">//   &quot;send nonce and total to process : &quot;,</span></span><br><span class="line">          <span class="comment">//   nonce,</span></span><br><span class="line">          <span class="comment">//   getTotal(products)</span></span><br><span class="line">          <span class="comment">// );</span></span><br><span class="line">          <span class="keyword">const</span> paymentData = &#123;</span><br><span class="line">            paymentMethodNonce: nonce,</span><br><span class="line">            amount: getTotal(products),</span><br><span class="line">            <span class="comment">// merchant_account_id: &quot;dhewgthty&quot;,</span></span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line">          processPayment(userId, token, paymentData)</span><br><span class="line">            .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// create order</span></span><br><span class="line">              <span class="keyword">const</span> createOrderData = &#123;</span><br><span class="line">                products: products,</span><br><span class="line">                transaction_id: response.transaction.id,</span><br><span class="line">                amount: response.transaction.amount,</span><br><span class="line">                address: deliveryAddress,</span><br><span class="line">              &#125;;</span><br><span class="line">              createOrder(userId, token, createOrderData).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">                emptyCart(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  handelUpdate();</span><br><span class="line">                  <span class="comment">// console.log(&quot;payment success and empty cart&quot;);</span></span><br><span class="line">                  setData(&#123; ...data, <span class="attr">loading</span>: <span class="literal">false</span>, <span class="attr">success</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(error);</span><br><span class="line">              setData(&#123; ...data, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&quot;dropin error: &quot;</span>, error);</span><br><span class="line">          setData(&#123; ...data, <span class="attr">error</span>: error.message &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">shwoSucess</span>(<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div</span><br><span class="line">        className=<span class="string">&quot;alert alert-info&quot;</span></span><br><span class="line">        style=&#123;&#123; <span class="attr">display</span>: success ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        Thanks! Your Payment was successful!</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">shwoLoading</span>(<span class="params">loading</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> loading &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">shwoError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div</span><br><span class="line">        className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">        style=&#123;&#123; <span class="attr">display</span>: error ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;error&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleAddress</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    setData(&#123; ...data, <span class="attr">address</span>: e.target.value &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showDropIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div onBlur=&#123;<span class="function">() =&gt;</span> setData(&#123; ...data, <span class="attr">error</span>: <span class="string">&quot;&quot;</span> &#125;)&#125;&gt;</span><br><span class="line">        &#123;data.clientToken != <span class="literal">null</span> &amp;&amp; products.length &gt; <span class="number">0</span> ? (</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;div className=<span class="string">&quot;gorm-grop mb-3&quot;</span>&gt;</span><br><span class="line">              &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Delivery address:&lt;/label&gt;</span><br><span class="line">              &lt;textarea</span><br><span class="line">                onChange=&#123;handleAddress&#125;</span><br><span class="line">                className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">                value=&#123;data.address&#125;</span><br><span class="line">                placeholder=<span class="string">&quot;Type your deliver address here ...&quot;</span></span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;DropIn</span><br><span class="line">              options=&#123;&#123;</span><br><span class="line">                authorization: data.clientToken,</span><br><span class="line">                <span class="comment">// ad paypal option</span></span><br><span class="line">                paypal: &#123;</span><br><span class="line">                  flow: <span class="string">&quot;vault&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;&#125;</span><br><span class="line">              onInstance=&#123;<span class="function">(<span class="params">instance</span>) =&gt;</span> (data.instance = instance)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;button onClick=&#123;handleBuy&#125; className=<span class="string">&quot;btn btn-success btn-block&quot;</span>&gt;</span><br><span class="line">              Pay</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        ) : <span class="literal">null</span>&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h2&gt;Total: $&#123;getTotal()&#125;&lt;/h2&gt;</span><br><span class="line">      &#123;shwoLoading(data.loading)&#125;</span><br><span class="line">      &#123;shwoSucess(data.success)&#125;</span><br><span class="line">      &#123;shwoError(data.error)&#125;</span><br><span class="line">      &#123;showCheckout()&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-ApiCore-js-5"><a href="#x2F-src-x2F-admin-x2F-ApiCore-js-5" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiCore.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiCore.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiCore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> queryString <span class="keyword">from</span> <span class="string">&quot;query-string&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProducts = <span class="function">(<span class="params">sortBy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products?sortBy=<span class="subst">$&#123;sortBy&#125;</span>&amp;order=desc&amp;limit=6`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getFilteredProducts = <span class="function">(<span class="params">skip, limit, filters</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123; limit, skip, filters &#125;;</span><br><span class="line">  <span class="comment">// console.log(data);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/by/search`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> list = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = queryString.stringify(params);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/search?<span class="subst">$&#123;query&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> read = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;productid=&quot;</span>, productId);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/<span class="subst">$&#123;productId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> listRelated = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products/related/<span class="subst">$&#123;productId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBraintreeClientToken = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/braintree/getToken/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> processPayment = <span class="function">(<span class="params">userId, token, paymentData</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(userId, token, paymentData);</span></span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/braintree/payment/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(paymentData),</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createOrder = <span class="function">(<span class="params">userId, token, createOrderData</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/order/create/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(&#123; <span class="attr">order</span>: createOrderData &#125;),</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-ApiAdmin-js-1"><a href="#x2F-src-x2F-admin-x2F-ApiAdmin-js-1" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiAdmin.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createCategory = <span class="function">(<span class="params">userId, token, category</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ***---&gt;&gt;&gt; call API function 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/category/create/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(category),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createProduct = <span class="function">(<span class="params">userId, token, product</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ***---&gt;&gt;&gt; call API function 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/create/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: product,</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> listOrders = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/order/list/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStatusValues = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/order/status-values/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateOrderStatus = <span class="function">(<span class="params">userId, token, orderId, status</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/order/<span class="subst">$&#123;orderId&#125;</span>/status/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(&#123; status, orderId &#125;),</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="add-user-profile-user-purchase-history"><a href="#add-user-profile-user-purchase-history" class="headerlink" title="add user profile + user purchase history"></a>add user profile + user purchase history</h3><h4 id="Back-End-3"><a href="#Back-End-3" class="headerlink" title="Back End"></a>Back End</h4><h5 id="x2F-routes-x2F-user-js"><a href="#x2F-routes-x2F-user-js" class="headerlink" title=".&#x2F;routes&#x2F;user.js"></a>.&#x2F;routes&#x2F;user.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="comment">// add controller</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  userById,</span><br><span class="line">  read,</span><br><span class="line">  update,</span><br><span class="line">  purchaseHistory,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/user&quot;</span>);</span><br><span class="line"><span class="comment">// add controller</span></span><br><span class="line"><span class="keyword">const</span> &#123; requireSignin, isAuth, isAdmin &#125; = <span class="built_in">require</span>(<span class="string">&quot;../controllers/auth&quot;</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&quot;/secret/:userId&quot;</span>, requireSignin, isAuth, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    user: req.profile,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&quot;/user/:userId&quot;</span>, requireSignin, isAuth, read);</span><br><span class="line">router.put(<span class="string">&quot;/user/:userId&quot;</span>, requireSignin, isAuth, update);</span><br><span class="line">router.get(<span class="string">&quot;/orders/by/user/:userId&quot;</span>, requireSignin, isAuth, purchaseHistory);</span><br><span class="line"></span><br><span class="line"><span class="comment">// userId 參數驗證</span></span><br><span class="line">router.param(<span class="string">&quot;userId&quot;</span>, userById);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-controllers-x2F-order-js-1"><a href="#x2F-controllers-x2F-order-js-1" class="headerlink" title=".&#x2F;controllers&#x2F;order.js"></a>.&#x2F;controllers&#x2F;order.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controllers/order.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; Order &#125; = <span class="built_in">require</span>(<span class="string">&quot;../models/order&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; errorHandler &#125; = <span class="built_in">require</span>(<span class="string">&quot;../helpers/dbErrorHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.orderById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  Order.findById(id)</span><br><span class="line">    .populate(<span class="string">&quot;products.product&quot;</span>, <span class="string">&quot;name price&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">error, order</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(error),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      req.order = order;</span><br><span class="line">      next();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.create = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.body.order.user = req.profile;</span><br><span class="line">  <span class="keyword">const</span> order = <span class="keyword">new</span> Order(req.body.order);</span><br><span class="line">  order.save(<span class="function">(<span class="params">error, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: errorHandler(error),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listOrders = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  Order.find()</span><br><span class="line">    .populate(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;_id name address&quot;</span>)</span><br><span class="line">    .sort(<span class="string">&quot;-created&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">error, orders</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(error),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(orders);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.getStatusValues = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(Order.schema.path(<span class="string">&quot;status&quot;</span>).enumValues);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.updateOrderStatus = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  Order.updateOne(</span><br><span class="line">    &#123; <span class="attr">_id</span>: req.body.orderId &#125;,</span><br><span class="line">    &#123; <span class="attr">$set</span>: &#123; <span class="attr">status</span>: req.body.status &#125; &#125;,</span><br><span class="line">    (error, order) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(error),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(order);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-controllers-x2F-user-js-1"><a href="#x2F-controllers-x2F-user-js-1" class="headerlink" title=".&#x2F;controllers&#x2F;user.js"></a>.&#x2F;controllers&#x2F;user.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controllers/user.js</span></span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">&quot;../models/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; Order &#125; = <span class="built_in">require</span>(<span class="string">&quot;../models/order&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; errorHandler &#125; = <span class="built_in">require</span>(<span class="string">&quot;../helpers/dbErrorHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.userById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  User.findById(id).exec(<span class="function">(<span class="params">err, user</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err || !user) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;User not found&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    req.profile = user;</span><br><span class="line">    next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.read = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.profile.hashed_password = <span class="literal">undefined</span>;</span><br><span class="line">  req.profile.salt = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> res.json(req.profile);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.update = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  User.findOneAndUpdate(</span><br><span class="line">    &#123; <span class="attr">_id</span>: req.profile._id &#125;,</span><br><span class="line">    &#123; <span class="attr">$set</span>: req.body &#125;,</span><br><span class="line">    &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    (err, user) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;You are not authorized to perform this action&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      req.profile.hashed_password = <span class="literal">undefined</span>;</span><br><span class="line">      req.profile.salt = <span class="literal">undefined</span>;</span><br><span class="line">      res.json(user);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.addOrderToUserHistory = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> history = [];</span><br><span class="line"></span><br><span class="line">  req.body.order.products.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    history.push(&#123;</span><br><span class="line">      _id: item._id,</span><br><span class="line">      name: item.name,</span><br><span class="line">      description: item.description,</span><br><span class="line">      category: item.category,</span><br><span class="line">      quantity: item.count,</span><br><span class="line">      transcation_id: req.body.order.transaction_id,</span><br><span class="line">      amount: req.body.order.amount,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  User.findOneAndUpdate(</span><br><span class="line">    &#123; <span class="attr">_id</span>: req.profile._id &#125;,</span><br><span class="line">    &#123; <span class="attr">$push</span>: &#123; <span class="attr">history</span>: history &#125; &#125;,</span><br><span class="line">    &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    (error, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Could not update user purchase history&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      next();</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.purchaseHistory = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  Order.find(&#123; <span class="attr">user</span>: req.profile._id &#125;)</span><br><span class="line">    .populate(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;_id name&quot;</span>)</span><br><span class="line">    .sort(<span class="string">&quot;-created&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, orders</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(orders);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Front-End-4"><a href="#Front-End-4" class="headerlink" title="Front End"></a>Front End</h4><h5 id="x2F-src-x2F-AppRoutes-js-7"><a href="#x2F-src-x2F-AppRoutes-js-7" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddCategory <span class="keyword">from</span> <span class="string">&quot;./admin/AddCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddProduct <span class="keyword">from</span> <span class="string">&quot;./admin/AddProduct&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Shop <span class="keyword">from</span> <span class="string">&quot;./core/Shop&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Product <span class="keyword">from</span> <span class="string">&quot;./core/Product&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cart <span class="keyword">from</span> <span class="string">&quot;./core/Cart&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Orders <span class="keyword">from</span> <span class="string">&quot;./admin/Orders&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Profile <span class="keyword">from</span> <span class="string">&quot;./user/Profile&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/shop&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Shop</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/category&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddCategory /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/product&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/product/:productId&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Product</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/cart&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Cart</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/orders&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;Orders /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/profile/:userId&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;Profile /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-UserDashboard-js-2"><a href="#x2F-src-x2F-core-x2F-UserDashboard-js-2" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;UserDashboard.js"></a>.&#x2F;src&#x2F;core&#x2F;UserDashboard.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/UserDashboard.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPurchaseHistory &#125; <span class="keyword">from</span> <span class="string">&quot;./apiUser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&quot;moment&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UserDashboard</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [history, setHistory] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    user: &#123; _id, name, email, role &#125;,</span><br><span class="line">  &#125; = isAuthenticated();</span><br><span class="line">  <span class="keyword">const</span> token = isAuthenticated().token;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">userId, token</span>) </span>&#123;</span><br><span class="line">    getPurchaseHistory(userId, token).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setHistory(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    init(_id, token);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userLinks = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;User Links&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/cart&quot;</span>&gt;</span><br><span class="line">            My Cart</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=&#123;<span class="string">`/profile/<span class="subst">$&#123;_id&#125;</span>`</span>&#125;&gt;</span><br><span class="line">            Update Profile</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;&#123;<span class="string">`G&#x27;Day <span class="subst">$&#123;name&#125;</span>!`</span>&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;name&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;email&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &#123;role === <span class="number">1</span> ? <span class="string">&quot;Admin&quot;</span> : <span class="string">&quot;Registrred User&quot;</span>&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> purchaseHistory = <span class="function">(<span class="params">history</span>) =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card mb-5&quot;</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;card-header&quot;</span>&gt;Purchase history&lt;/div&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &#123;history.map(<span class="function">(<span class="params">h, i</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;hr /&gt;</span><br><span class="line">                &#123;h.products.map(<span class="function">(<span class="params">p, i</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> (</span><br><span class="line">                    &lt;div key=&#123;i&#125;&gt;</span><br><span class="line">                      &lt;h6&gt;Product name: &#123;p.name&#125;&lt;/h6&gt;</span><br><span class="line">                      &lt;h6&gt;Product price: $&#123;p.price&#125;&lt;/h6&gt;</span><br><span class="line">                      &lt;h6&gt;Purchased date: &#123;moment(h.updatedAt).fromNow()&#125;&lt;/h6&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  );</span><br><span class="line">                &#125;)&#125;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            );</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Dashboard Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;User Dashboard&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-3&quot;</span>&gt;&#123;userLinks()&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-9&quot;</span>&gt;</span><br><span class="line">          &#123;userInfo()&#125;</span><br><span class="line">          &#123;purchaseHistory(history)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-user-x2F-Profile-js"><a href="#x2F-src-x2F-user-x2F-Profile-js" class="headerlink" title=".&#x2F;src&#x2F;user&#x2F;Profile.js"></a>.&#x2F;src&#x2F;user&#x2F;Profile.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/user/Profile.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useParams, Navigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; read, update, updateUser &#125; <span class="keyword">from</span> <span class="string">&quot;./apiUser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Profile</span>(<span class="params">&#123; match &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    email: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    password: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    error: <span class="literal">false</span>,</span><br><span class="line">    success: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; token &#125; = isAuthenticated();</span><br><span class="line">  <span class="keyword">const</span> &#123; name, email, password, error, success &#125; = values;</span><br><span class="line">  <span class="keyword">const</span> &#123; userId &#125; = useParams(); <span class="comment">// v6 react-router-dom</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">userId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(userId);</span></span><br><span class="line">    read(userId, token).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123; ...values, <span class="attr">error</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setValues(&#123; ...values, <span class="attr">name</span>: data.name, <span class="attr">email</span>: data.email &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// init(match.params.userId); // v5 react-router-dom</span></span><br><span class="line">    init(userId); <span class="comment">// v6 react-router-dom</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">name</span>) =&gt;</span> <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    setValues(&#123; ...values, <span class="attr">error</span>: <span class="literal">false</span>, [name]: e.target.value &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">redirectUser</span>(<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (success) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/cart&quot;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handSubmit</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    update(userId, token, &#123; name, email, password &#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        updateUser(data, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          setValues(&#123;</span><br><span class="line">            ...values,</span><br><span class="line">            name: data.name,</span><br><span class="line">            email: data.email,</span><br><span class="line">            success: <span class="literal">true</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">profileUpdate</span>(<span class="params">name, email, password</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">          &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Name&lt;/label&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            type=<span class="string">&quot;text&quot;</span></span><br><span class="line">            onChange=&#123;handleChange(<span class="string">&quot;name&quot;</span>)&#125;</span><br><span class="line">            className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">            value=&#123;name&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">          &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Email&lt;/label&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            type=<span class="string">&quot;email&quot;</span></span><br><span class="line">            onChange=&#123;handleChange(<span class="string">&quot;email&quot;</span>)&#125;</span><br><span class="line">            className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">            value=&#123;email&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">          &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Password&lt;/label&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            type=<span class="string">&quot;password&quot;</span></span><br><span class="line">            onChange=&#123;handleChange(<span class="string">&quot;password&quot;</span>)&#125;</span><br><span class="line">            className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">            value=&#123;password&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;button onClick=&#123;handSubmit&#125; className=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><br><span class="line">          Submit</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Profile&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Update your profile&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;h2 className=<span class="string">&quot;mb-4&quot;</span>&gt;Profile Update&lt;/h2&gt;</span><br><span class="line">      &#123;profileUpdate(name, email, password)&#125;</span><br><span class="line">      &#123;redirectUser(success)&#125;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-user-x2F-apiUser-js"><a href="#x2F-src-x2F-user-x2F-apiUser-js" class="headerlink" title=".&#x2F;src&#x2F;user&#x2F;apiUser.js"></a>.&#x2F;src&#x2F;user&#x2F;apiUser.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/user/apiUser.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> read = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/user/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> update = <span class="function">(<span class="params">userId, token, user</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/user/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(user),</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateUser = <span class="function">(<span class="params">user, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;jwt&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">let</span> auth = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;jwt&quot;</span>));</span><br><span class="line">      auth.user = user;</span><br><span class="line">      <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;jwt&quot;</span>, <span class="built_in">JSON</span>.stringify(auth));</span><br><span class="line">      next();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getPurchaseHistory = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/orders/by/user/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="add-Manage-Orders-and-Products"><a href="#add-Manage-Orders-and-Products" class="headerlink" title="add Manage Orders and Products"></a>add Manage Orders and Products</h3><h4 id="Back-End-4"><a href="#Back-End-4" class="headerlink" title="Back End"></a>Back End</h4><h5 id="x2F-controller-x2F-product-js-3"><a href="#x2F-controller-x2F-product-js-3" class="headerlink" title=".&#x2F;controller&#x2F;product.js"></a>.&#x2F;controller&#x2F;product.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./controller/product.js</span></span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">&quot;formidable&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Product = <span class="built_in">require</span>(<span class="string">&quot;../models/product&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; errorHandler &#125; = <span class="built_in">require</span>(<span class="string">&quot;../helpers/dbErrorHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.productById = <span class="function">(<span class="params">req, res, next, id</span>) =&gt;</span> &#123;</span><br><span class="line">  Product.findById(id)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, product</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err || !product) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Product does not exist&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      req.product = product;</span><br><span class="line">      next();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.read = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.product.photo = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> res.json(req.product);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.create = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check for all fieldd</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, description, price, category, quantity, shipping &#125; = fields;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !name ||</span><br><span class="line">      !description ||</span><br><span class="line">      !price ||</span><br><span class="line">      !category ||</span><br><span class="line">      !quantity ||</span><br><span class="line">      !shipping</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;All field are required&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = <span class="keyword">new</span> Product(fields);</span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="comment">// console.log(&quot;product:&quot;, result);</span></span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.remove = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> product = req.product;</span><br><span class="line">  product.remove(<span class="function">(<span class="params">err, deletedProduct</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: errorHandler(err),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      message: <span class="string">&quot;Product deleted successly&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.update = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">  form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Image could not be uploaded&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> product = req.product;</span><br><span class="line">    <span class="comment">// fields 蓋過 product</span></span><br><span class="line">    product = _.extend(product, fields);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (files.photo) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files.photo.size &gt; <span class="number">200000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Image should be less 200k in size&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// change files.photo.file to files.photo.filepath</span></span><br><span class="line">      product.photo.data = fs.readFileSync(files.photo.filepath);</span><br><span class="line">      product.photo.contentType = files.photo.mimetype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    product.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result.photo = <span class="literal">undefined</span>;</span><br><span class="line">      res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sel/arrival</span></span><br><span class="line"><span class="comment"> * bye sell = /products?sortBy=sold&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * bye arrival = /products?sortBy=createdAt&amp;order=desc&amp;limit=4</span></span><br><span class="line"><span class="comment"> * if no parameter are sent, then all products are returned</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">exports</span>.list = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.query.order ? req.query.order : <span class="string">&quot;asc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.query.sortBy ? req.query.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(limit)) limit = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  Product.find()</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>) <span class="comment">// mapt to Category</span></span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * it will find the products based on the req product category</span></span><br><span class="line"><span class="comment"> * other products that has the same category, will be return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listRelated = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> limit = req.query.limit ? <span class="built_in">parseInt</span>(req.query.limit) : <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// $ne: not include</span></span><br><span class="line">  Product.find(&#123; <span class="attr">_id</span>: &#123; <span class="attr">$ne</span>: req.product &#125;, <span class="attr">category</span>: req.product.category &#125;)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;_id name&quot;</span>)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;Products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listCategories = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// distinct : 取出不同的 category</span></span><br><span class="line">  <span class="comment">// &#123;&#125; : 2nd parameter doesn&#x27;t need do no send value</span></span><br><span class="line">  Product.distinct(<span class="string">&quot;category&quot;</span>, &#123;&#125;, <span class="function">(<span class="params">err, categories</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Categories not found&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(categories);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * list products by search</span></span><br><span class="line"><span class="comment"> * we will implement product search in react frontend</span></span><br><span class="line"><span class="comment"> * we will show categories in checkbox and price range in radio buttons</span></span><br><span class="line"><span class="comment"> * as the user clicks on those checkbox and radio buttons</span></span><br><span class="line"><span class="comment"> * we will make api request and show the products to users based on what he wants</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//  &quot;skip&quot; : &quot;1&quot;,</span></span><br><span class="line"><span class="comment">//  &quot;limit&quot; : &quot;2&quot;,</span></span><br><span class="line"><span class="comment">// 	&quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">// 		&quot;name&quot;: &quot;Note&quot;</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// &gt;=2 and &lt;=19</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">// &quot;filters&quot;: &#123;</span></span><br><span class="line"><span class="comment">//   &quot;price&quot;: [&quot;2&quot;, &quot;19&quot;]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">exports</span>.listBySearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> order = req.body.order ? req.body.order : <span class="string">&quot;desc&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> sortBy = req.body.sortBy ? req.body.sortBy : <span class="string">&quot;_id&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> limit = req.body.limit ? <span class="built_in">parseInt</span>(req.body.limit) : <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> skip = req.body.skip ? <span class="built_in">parseInt</span>(req.body.skip) : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> findArgs = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(order, sortBy, limit, skip, req.body.filters);</span></span><br><span class="line">  <span class="comment">// console.log(req.body);</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> req.body.filters) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.filters[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;price&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// gte - great than price</span></span><br><span class="line">        <span class="comment">// lte - less than</span></span><br><span class="line">        findArgs[key] = &#123;</span><br><span class="line">          $gte: req.body.filters[key][<span class="number">0</span>],</span><br><span class="line">          $lte: req.body.filters[key][<span class="number">1</span>],</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// findArgs[key] = new RegExp(req.body.filters[key]);</span></span><br><span class="line">        findArgs[key] = req.body.filters[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// console.log(&quot;findArgs&quot;, findArgs);</span></span><br><span class="line"></span><br><span class="line">  Product.find(findArgs)</span><br><span class="line">    .select(<span class="string">&quot;-photo&quot;</span>)</span><br><span class="line">    .populate(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">    .sort([[sortBy, order]])</span><br><span class="line">    .skip(skip)</span><br><span class="line">    .limit(limit)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: <span class="string">&quot;products not found&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        size: data.length,</span><br><span class="line">        data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.photo = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.product.photo.data) &#123;</span><br><span class="line">    res.set(<span class="string">&quot;Content-Type&quot;</span>, req.product.photo.contentType);</span><br><span class="line">    <span class="keyword">return</span> res.send(req.product.photo.data);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.listSearch = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// create query object to hole search value and category value</span></span><br><span class="line">  <span class="keyword">const</span> query = &#123;&#125;;</span><br><span class="line">  <span class="comment">// assign search value to query name</span></span><br><span class="line">  <span class="keyword">if</span> (req.query.search) &#123;</span><br><span class="line">    <span class="comment">// mongodb regular expression</span></span><br><span class="line">    query.name = &#123; <span class="attr">$regex</span>: req.query.search, <span class="attr">$options</span>: <span class="string">&quot;i&quot;</span> &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(query.name);</span><br><span class="line">    <span class="comment">// assign category value to query.category</span></span><br><span class="line">    <span class="keyword">if</span> (req.query.category &amp;&amp; req.query.category != <span class="string">&quot;All&quot;</span>) &#123;</span><br><span class="line">      query.category = req.query.category;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// find the product base on query object with 2 properties</span></span><br><span class="line">    <span class="comment">// search and category</span></span><br><span class="line">    Product.find(query, <span class="function">(<span class="params">err, products</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">          error: errorHandler(err),</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      res.json(products);</span><br><span class="line">    &#125;).select(<span class="string">&quot;-photo&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.descreaseQuantity = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> bulkOps = req.body.order.products.map(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      updateOne: &#123;</span><br><span class="line">        filter: &#123; <span class="attr">_id</span>: item._id &#125;,</span><br><span class="line">        update: &#123; <span class="attr">$inc</span>: &#123; <span class="attr">quantity</span>: -item.count, <span class="attr">sold</span>: +item.count &#125; &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  Product.bulkWrite(bulkOps, &#123;&#125;, <span class="function">(<span class="params">error, products</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">        error: <span class="string">&quot;Could not update product&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Front-End-5"><a href="#Front-End-5" class="headerlink" title="Front End"></a>Front End</h4><h5 id="x2F-src-x2F-AppRoutes-js-8"><a href="#x2F-src-x2F-AppRoutes-js-8" class="headerlink" title=".&#x2F;src&#x2F;AppRoutes.js"></a>.&#x2F;src&#x2F;AppRoutes.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/AppRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Routes, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./core/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signup <span class="keyword">from</span> <span class="string">&quot;./user/Signup&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Signin <span class="keyword">from</span> <span class="string">&quot;./user/Singin&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserDashboard <span class="keyword">from</span> <span class="string">&quot;./user/UserDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminDashboard <span class="keyword">from</span> <span class="string">&quot;./user/AdminDashboard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/UserAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AdminRequireAuth <span class="keyword">from</span> <span class="string">&quot;./auth/AdminAuth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddCategory <span class="keyword">from</span> <span class="string">&quot;./admin/AddCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> AddProduct <span class="keyword">from</span> <span class="string">&quot;./admin/AddProduct&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Shop <span class="keyword">from</span> <span class="string">&quot;./core/Shop&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Product <span class="keyword">from</span> <span class="string">&quot;./core/Product&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cart <span class="keyword">from</span> <span class="string">&quot;./core/Cart&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Orders <span class="keyword">from</span> <span class="string">&quot;./admin/Orders&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Profile <span class="keyword">from</span> <span class="string">&quot;./user/Profile&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ManageProducts <span class="keyword">from</span> <span class="string">&quot;./admin/ManageProducts&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UpdateProduct <span class="keyword">from</span> <span class="string">&quot;./admin/UpdateProduct&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AppRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;APP render...&quot;);</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;BrowserRouter&gt;</span><br><span class="line">        &#123;<span class="comment">/* react-router-dom v6</span></span><br><span class="line"><span class="comment">				   1. &quot;Switch&quot; is replaced by routes &quot;Routes&quot;</span></span><br><span class="line"><span class="comment">					 2. component put to element */</span>&#125;</span><br><span class="line">        &lt;Routes&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/shop&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Shop</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signup&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signup</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/signin&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Signin</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/user/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;UserDashboard /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/dashboard&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AdminDashboard /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/category&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddCategory /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/create/product&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;AddProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/product/:productId&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Product</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/cart&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Cart</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/orders&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;Orders /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/profile/:userId&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;Profile /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/products&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;UserRequireAuth&gt;</span><br><span class="line">                &lt;ManageProducts /&gt;</span><br><span class="line">              &lt;/UserRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=<span class="string">&quot;/admin/product/update/:productId&quot;</span></span><br><span class="line">            element=&#123;</span><br><span class="line">              &lt;AdminRequireAuth&gt;</span><br><span class="line">                &lt;UpdateProduct /&gt;</span><br><span class="line">              &lt;/AdminRequireAuth&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Routes&gt;</span><br><span class="line">      &lt;/BrowserRouter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-core-x2F-AdminDashboard-js-1"><a href="#x2F-src-x2F-core-x2F-AdminDashboard-js-1" class="headerlink" title=".&#x2F;src&#x2F;core&#x2F;AdminDashboard.js"></a>.&#x2F;src&#x2F;core&#x2F;AdminDashboard.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/core/AdminDashboard.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AdmintDashboard</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    user: &#123; name, email, role &#125;,</span><br><span class="line">  &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> adminLinks = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;Admin Links&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/create/category&quot;</span>&gt;</span><br><span class="line">            Create Category</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/create/product&quot;</span>&gt;</span><br><span class="line">            Create Product</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/admin/orders&quot;</span>&gt;</span><br><span class="line">            View Orders</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;Link className=<span class="string">&quot;nav-link&quot;</span> to=<span class="string">&quot;/admin/products&quot;</span>&gt;</span><br><span class="line">            Manage Products</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ***---&gt;&gt;&gt; 使用 arrow 函數,可省略 return</span></span><br><span class="line">  <span class="keyword">const</span> adminInfo = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div className=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">      &lt;h3 className=<span class="string">&quot;card-header&quot;</span>&gt;&#123;<span class="string">`G&#x27;Day <span class="subst">$&#123;name&#125;</span>!`</span>&#125;&lt;/h3&gt;</span><br><span class="line">      &lt;ul className=<span class="string">&quot;list-group&quot;</span>&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;name&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;&#123;email&#125;&lt;/li&gt;</span><br><span class="line">        &lt;li className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &#123;role === <span class="number">1</span> ? <span class="string">&quot;Admin&quot;</span> : <span class="string">&quot;Registrred User&quot;</span>&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Dashboard Page&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Admin Dashboard&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &#123;<span class="comment">/* ***---&gt;&gt;&gt; 使用 arrow 函數,可省略 return */</span>&#125;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-3&quot;</span>&gt;&#123;adminLinks()&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-9&quot;</span>&gt;&#123;adminInfo()&#125;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-ApiAdmin-js-2"><a href="#x2F-src-x2F-admin-x2F-ApiAdmin-js-2" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js"></a>.&#x2F;src&#x2F;admin&#x2F;ApiAdmin.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/admin/ApiAdmin.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; API &#125; <span class="keyword">from</span> <span class="string">&quot;../config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createCategory = <span class="function">(<span class="params">userId, token, category</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ***---&gt;&gt;&gt; call API function 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/category/create/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(category),</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data);</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;signup err:&quot;</span>, err);</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createProduct = <span class="function">(<span class="params">userId, token, product</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ***---&gt;&gt;&gt; call API function 要加 return 才能 then 處理</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/create/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">      method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      body: product,</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">// json format body 傳回要加 .json()</span></span><br><span class="line">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/categories`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> listOrders = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/order/list/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStatusValues = <span class="function">(<span class="params">userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/order/status-values/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateOrderStatus = <span class="function">(<span class="params">userId, token, orderId, status</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/order/<span class="subst">$&#123;orderId&#125;</span>/status/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(&#123; status, orderId &#125;),</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProducts = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/products?limit=undefined`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteProduct = <span class="function">(<span class="params">productId, userId, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/<span class="subst">$&#123;productId&#125;</span>/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;DELETE&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProduct = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/<span class="subst">$&#123;productId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateProduct = <span class="function">(<span class="params">productId, userId, token, product</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(productId, userId, token, product);</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">`<span class="subst">$&#123;API&#125;</span>/product/<span class="subst">$&#123;productId&#125;</span>/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Accept: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: product,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: <span class="string">&quot;Server not response&quot;</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-ManageProducts-js"><a href="#x2F-src-x2F-admin-x2F-ManageProducts-js" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;ManageProducts.js"></a>.&#x2F;src&#x2F;admin&#x2F;ManageProducts.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ./src/admin/ManageProducts.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getProducts, deleteProduct &#125; <span class="keyword">from</span> <span class="string">&quot;./ApiAdmin&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">ManageProducts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [products, setProducts] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; user, token &#125; = isAuthenticated();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadProducts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    getProducts().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.log);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setProducts(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">productId</span>) </span>&#123;</span><br><span class="line">    deleteProduct(productId, user._id, token).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        loadProducts();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loadProducts();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Manage Products&quot;</span></span><br><span class="line">      description=<span class="string">&quot;Perform CRUD on products&quot;</span></span><br><span class="line">      className=<span class="string">&quot;container-fluid&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;h2 className=<span class="string">&quot;text-center&quot;</span>&gt;Total &#123;products.length&#125; products&lt;/h2&gt;</span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;products.map(<span class="function">(<span class="params">p, i</span>) =&gt;</span> (</span><br><span class="line">        &lt;li key=&#123;i&#125; className=<span class="string">&quot;list-group-item&quot;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">&quot;col-6&quot;</span>&gt;</span><br><span class="line">              &lt;strong&gt;&#123;p.name&#125;&lt;/strong&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div className=<span class="string">&quot;col-3&quot;</span>&gt;</span><br><span class="line">              &lt;Link to=&#123;<span class="string">`/admin/product/update/<span class="subst">$&#123;p._id&#125;</span>`</span>&#125;&gt;</span><br><span class="line">                &lt;span className=<span class="string">&quot;badge badge-warning badge-pill&quot;</span>&gt;Update&lt;/span&gt;</span><br><span class="line">              &lt;/Link&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div className=<span class="string">&quot;col-3&quot;</span>&gt;</span><br><span class="line">              &lt;span</span><br><span class="line">                onClick=&#123;<span class="function">() =&gt;</span> destroy(p._id)&#125;</span><br><span class="line">                className=<span class="string">&quot;badge badge-danger badge-pill&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                Delete</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="x2F-src-x2F-admin-x2F-UpdateProduct-js"><a href="#x2F-src-x2F-admin-x2F-UpdateProduct-js" class="headerlink" title=".&#x2F;src&#x2F;admin&#x2F;UpdateProduct.js"></a>.&#x2F;src&#x2F;admin&#x2F;UpdateProduct.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ./src/admin/UpdateProduct.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useParams, Navigate &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&quot;../core/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAuthenticated &#125; <span class="keyword">from</span> <span class="string">&quot;../auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getProduct, getCategories, updateProduct &#125; <span class="keyword">from</span> <span class="string">&quot;./ApiAdmin&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UpdateProduct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [values, setValues] = useState(&#123;</span><br><span class="line">    name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    description: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    price: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    shipping: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    quantity: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    photo: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    loading: <span class="literal">false</span>,</span><br><span class="line">    error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    createdProduct: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    redirectToProfile: <span class="literal">false</span>,</span><br><span class="line">    formData: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [categories, setCategories] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// destructure user and token from localStorage</span></span><br><span class="line">  <span class="keyword">const</span> &#123; user, token &#125; = isAuthenticated();</span><br><span class="line">  <span class="keyword">const</span> &#123; productId &#125; = useParams();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    name,</span><br><span class="line">    description,</span><br><span class="line">    price,</span><br><span class="line">    quantity,</span><br><span class="line">    loading,</span><br><span class="line">    error,</span><br><span class="line">    createdProduct,</span><br><span class="line">    redirectToProfile,</span><br><span class="line">    formData,</span><br><span class="line">  &#125; = values;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> init = <span class="function">(<span class="params">productId</span>) =&gt;</span> &#123;</span><br><span class="line">    getProduct(productId).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123; ...values, <span class="attr">error</span>: data.error &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// populate the state</span></span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          name: data.name,</span><br><span class="line">          description: data.description,</span><br><span class="line">          price: data.price,</span><br><span class="line">          category: data.category._id,</span><br><span class="line">          shipping: data.shipping,</span><br><span class="line">          quantity: data.quantity,</span><br><span class="line">          formData: <span class="keyword">new</span> FormData(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// load categories</span></span><br><span class="line">        initCategories();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load categories and set from data.error</span></span><br><span class="line">  <span class="keyword">const</span> initCategories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getCategories().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setCategories(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    init(productId);</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> name = e.target.name;</span><br><span class="line">    <span class="keyword">const</span> value = name === <span class="string">&quot;photo&quot;</span> ? e.target.files[<span class="number">0</span>] : e.target.value;</span><br><span class="line">    <span class="comment">// set formData&#x27;s velue</span></span><br><span class="line">    formData.set(name, value);</span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      [e.target.name]: value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleSubmit</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line"></span><br><span class="line">    setValues(&#123;</span><br><span class="line">      ...values,</span><br><span class="line">      error: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      loading: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ***---&gt;&gt;&gt; call API function 要加 return 才能 then 處理</span></span><br><span class="line">    updateProduct(productId, user._id, token, formData).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.error) &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          error: data.error,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setValues(&#123;</span><br><span class="line">          ...values,</span><br><span class="line">          name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          description: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          price: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          quantity: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          photo: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          loading: <span class="literal">false</span>,</span><br><span class="line">          redirectToProfile: <span class="literal">true</span>,</span><br><span class="line">          createdProduct: data.name,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// // 使用此種寫法不用加 &#123;&#125; and retuen</span></span><br><span class="line">  <span class="keyword">const</span> newProductForm = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;handleSubmit&#125; className=<span class="string">&quot;mb-3&quot;</span>&gt;</span><br><span class="line">      &lt;h4&gt;Post Photo&lt;/h4&gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;btn btn-secondary&quot;</span>&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            id=<span class="string">&quot;photo_uploades&quot;</span></span><br><span class="line">            onChange=&#123;handleChange&#125;</span><br><span class="line">            name=<span class="string">&quot;photo&quot;</span></span><br><span class="line">            type=<span class="string">&quot;file&quot;</span></span><br><span class="line">            accepr=<span class="string">&quot;image/*&quot;</span></span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Name&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;name&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;name&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Description&lt;/label&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;description&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;description&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Price&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;price&quot;</span></span><br><span class="line">          type=<span class="string">&quot;text&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;price&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Category&lt;/label&gt;</span><br><span class="line">        &lt;select</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;category&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          &lt;option&gt;Please select&lt;/option&gt;</span><br><span class="line">          &#123;categories &amp;&amp;</span><br><span class="line">            categories.map(<span class="function">(<span class="params">c, i</span>) =&gt;</span> (</span><br><span class="line">              &lt;option key=&#123;i&#125; value=&#123;c._id&#125;&gt;</span><br><span class="line">                &#123;c.name&#125;</span><br><span class="line">              &lt;/option&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Shipping&lt;/label&gt;</span><br><span class="line">        &lt;select</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;shipping&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          &lt;option&gt;Please select&lt;/option&gt;</span><br><span class="line">          &lt;option value=<span class="string">&quot;0&quot;</span>&gt;No&lt;/option&gt;</span><br><span class="line">          &lt;option value=<span class="string">&quot;1&quot;</span>&gt;Yes&lt;/option&gt;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">        &lt;label className=<span class="string">&quot;text-muted&quot;</span>&gt;Quantity&lt;/label&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          onChange=&#123;handleChange&#125;</span><br><span class="line">          name=<span class="string">&quot;quantity&quot;</span></span><br><span class="line">          type=<span class="string">&quot;number&quot;</span></span><br><span class="line">          className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">          value=&#123;quantity&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button className=<span class="string">&quot;btn btn-outline-primary&quot;</span>&gt;Update Product&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showError = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-danger&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: error ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;error&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showSuccess = <span class="function">() =&gt;</span> (</span><br><span class="line">    &lt;div</span><br><span class="line">      className=<span class="string">&quot;alert alert-info&quot;</span></span><br><span class="line">      style=&#123;&#123; <span class="attr">display</span>: createdProduct ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;h2&gt;&#123;<span class="string">`<span class="subst">$&#123;createdProduct&#125;</span>`</span>&#125; is updated!&lt;/h2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showLoading = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    loading &amp;&amp; (</span><br><span class="line">      &lt;div className=<span class="string">&quot;alert alert-success&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;Loading...&lt;/h2&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> redirectUser = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (redirectToProfile) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout</span><br><span class="line">      title=<span class="string">&quot;Update the product&quot;</span></span><br><span class="line">      description=&#123;<span class="string">`G&#x27;day <span class="subst">$&#123;user.name&#125;</span>, ready update the product?`</span>&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div className=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;col-md-8 offset-md-2&quot;</span>&gt;</span><br><span class="line">          &#123;showLoading()&#125;</span><br><span class="line">          &#123;showSuccess()&#125;</span><br><span class="line">          &#123;showError()&#125;</span><br><span class="line">          &#123;newProductForm()&#125;</span><br><span class="line">          &#123;redirectUser()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><ul>
<li><a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#autofilling-form-controls%3A-the-autocomplete-attribute">Autofilling form controls: the autocomplete attribute</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/react/" rel="tag"># react</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/11/06/db-3/" rel="prev" title="mongoDB">
                  <i class="fa fa-chevron-left"></i> mongoDB
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/11/18/pcie-1/" rel="next" title="PCIe">
                  PCIe <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Robert Kao</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="總字數">2.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="所需總閱讀時間">40:58</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 強力驅動
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  




  


<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://hot5656-blog.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://hot5656.github.io/2021/11/16/practice-1-2/";
    this.page.identifier = "2021/11/16/practice-1-2/";
    this.page.title = "Practice React Ecommerce - Front End";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://hot5656-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
