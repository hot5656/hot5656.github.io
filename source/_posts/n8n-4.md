---
title: n8n - AI Agents, AI Automations & AI Voice Agents (3)<br> RAG & Research AI Agents
abbrlink: f399
date: 2025-11-17 15:18:34
categories: AI
tags:
	- n8n
	- udemy
---

### workflow

<!--more-->

#### 12_122 Build RAG Agent with n8n & Pinecorn(save RAG)
<div style="max-width:700px">
	{% asset_img pic_12_122.png pic_12_122 %}
</div>

``` bash
# Drive --> On changes involving a specific folder
Folder(By ID): ...(for First RAG Agent)
Watch For: File Created

# Drive --> Download file
File(By ID) : {{ $json.id }}
 
# pinecorn  Vector Store --> add docuemnts to vector store
Pinecone Index(From list): n8nragagent
Options:
  Pinecone Namespace: ragagent or ragagent2(更改空間)
Embedding Document: Embedding Google Gemini
Data loader:　Default Data loader
  Type of Data: Binary
  Mode: Load All Input Data
  Data Format: PDF
  Text Splitting: Custom (外接 Text Splitter)
  ext Splitter　--> add "Recursive Character Text Splitter"(以下設定有較好的效率)
            Chunk Size: 900
            Chunk Overlap: 50
  Options
    Metadata: (可使用於搜尋時加過濾條件)
      Name: Apple
      Value: {{ $json.name }}
```

#### 12_122 Build RAG Agent with n8n & Pinecorn(ask for RAG)
``` bash
# chat trigger
what about Image Playground
what about Writing Tools
"I am robert, I like dog
What's my name and what animal do I like?
what I aks previous ?"

# AI Agent
System Message: 
  "
  # Role  
  You are an AI assistant designed to answer questions about iOS 18, based on the official feature documents stored in the TOOL's "iOS RAG" vector database.  

  # Objective  
  Your goal is to help users understand the new features, settings, and changes introduced in iOS 18. All answers should come directly from the information found in the vector database.  

  If a user asks about something not covered in the stored content, let them know that the information isn’t currently available.  

  # Rules  
  - if cannot link to "iOS RAG" just response unknow
  - Use bullet points or short paragraphs for lists or multiple features.  
  - Do not guess or assume anything. Use only the verified data from the vector database.  

  Your main goal: Provide helpful, accurate, and easy-to-understand answers using only the stored documents — no speculation or outside sources.  
  "
Chat Mode: Google gemini Chat model
meomey : simple memory : context window length:10
Tool: Answer questions with a vector store (iOS RAG)
  Description of Data: for ask IOS
  Model: gemin chat model
  Vector store:Pinecone Vector Store 
    Operation Mode: Retrieve Documents (As Vector Store for Chain/Tool)
    Pinecone Index(From list): n8nragagent
    Options: 
      Pinecone Namespace: ragagent or or ragagent2(更改空間)
    Embedding: embedding google gemini
```

#### 12_123 DeepSeek R1 Planner(Gemini)
<div style="max-width:700px">
	{% asset_img pic_12_123.png pic_12_123 %}
</div>

``` bash
# On chat message
"
Schedule a meeting for me with Jack. Her email is kyp001@gmail.com at 1 pm on November 21th, 2025, for 1 hour. Also, please send an email to her.
"

# AI Agent(Planner AI Agent)
System Message:
  ** Mission **
  You are an AI tasked with drafting clear, practical prompts that help a personal assistant complete any job at hand.

  ** Operating Scope **
  - No external tools or references.
  - Keep every instruction brief, ordered, and unmistakable.
  - Jobs can be simple or complex, but your wording must remain straightforward.

  ** Workflow **
  - Receive the user’s request.
  - Decompose the request into a short series of logical actions.
  - Write each action so it can be executed immediately—no guesswork.
  - Note prerequisites or context the assistant needs to know.
  - Proof-read the prompt for clarity and fullness before sending it.

  ** Illustrative Scenarios **

  Example 1:
  --------User Request
  “Book a doctor’s appointment for next week.”

  --------Prompt You Produce
  1. Find open slots with the doctor next week. 2. Pick a time that doesn’t clash with existing events.
  3. Book the slot by phone or online. 4. Add the appointment to the calendar.

  Example 2:
  --------User Request
  “Get ready for John’s birthday party.”

  --------Prompt You Produce
  1. Select a date and time for the party. 2. Draft a guest list. 3. Buy and set up decorations beforehand.
  4. Arrange food and drinks. 5. Send invitations.

  ** Operating Checklist (SOP) **
  - Hear the goal.
  - Break it into clear, ordered, actionable steps.
  - Supply any needed background details.
  - Double-check that the plan is complete and plain.
  - Deliver the polished prompt to the assistant.

  ** Closing Reminders **
  - Favor simplicity over flourish.
  - Omit anything irrelevant or overly wordy.
  - Hand over a ready-to-execute plan that needs no further clarification.
  - Current date/time: {{ $now }}
Caht Model: Google Gemini chat Model
Memory: Simple Memory
  Context Window Length: 10

# AI Agent(Execute AI AGent)
Source for Prompt (User Message): Define below
Prompt (User Message): {{ $json.output }}
System Message:
  # Tool
  - Send a message in Gmail: support send email
  - Create an event in Google Calendar: support set calendar event

  # Note
  - Don't need to wait for an email response, directly set a calendar event and give a proper title
  - my name is Robert
  - The email use HTMl format
  - Directly do what toy can do, show what you do in output message
Caht Model: Google Gemini chat Model
Tool: 
  Gmail Tool
    To: {{$fromAI('emailAddress')}}
    Subject: {{$fromAI('subject')}}
    Email Type: HTML
    Message: {{$fromAI('message')}}
    Options: Append n8n Attribution: Disable
  Google Calendar Tool
    Calendar: my_google_email
    Start: {{ $fromAI('startDate')}}
    End: {{ $fromAI('endDate')}}
    Additional Fields
      Summary: {{ $fromAI('title')}}
```

#### 12_124 Build AI Agent that Remembers Everything(Supabase VB + PostgreSQL) - save communication & get RAG
<div style="max-width:700px">
	{% asset_img pic_12_124.png pic_12_124 %}
</div>

``` bash
# On chat Message
hello --> Supabase table n8n_chat_histories can see send and response recorded message
please tell me about "Role"
please tell me about "Next Steps"
what is the prompt about?

# AI Agent - RAG Agent
Chat mode: Google Gemini Chat Model
Memory: Postgres Chat Memoey
Tool: Supabase Vector Store
  Description: Use this to get information about the AI voice Agent prompt
  Table Name: documents
  Embedding: Embeddings Google Gemini
```

#### 12_124 Build AI Agent that Remembers Everything(Supabase VB + PostgreSQL) - load document
``` bash
# Drive --> download file
File: AIVOIC_1.PDF

# Superbase Vector Store --> add Documents to vector store
Table Name: documents (select when table "documents" create already)
embedding : Embeddings Google Gemini
ocuemnt loader : Default Data loader 
  Type of Data: Binary

# run load file 
```

#### 12_125 Build DeepSeek R1 WhatApp AI Agent to Plan and Research(llama + Telegram)
<div style="max-width:700px">
	{% asset_img pic_12_125.png pic_12_125 %}
</div>

``` bash
# Telegram --> on message
Plan a budget-friendly one-month stay in Thailand as a digital nomad. I need a cheap place to stay, good Wifi, coworking spaces, and some great traction to visit.
規劃一個預算友好的台灣一個月數位遊牧生活，我需要便宜的住宿、良好的WiFi、共享辦公空間，以及一些很棒的旅遊景點。 

# AI Agent(Planner Agent)
Source for Prompt (User Message): Define below
Prompt (User Message):
  {{ $json.message.text }}
System Message:
  Role: You are an AI Planner Agent
Chat model : Groq Chat Model
  Model : llama-3.3-70b-versatile
Memory : Simple Memory
  Session ID: Define below
  Key: {{ $('Telegram Trigger').item.json.message.text }}

# AI Agent(Research Agent)
Source for Prompt (User Message): Define below
Prompt (User Message):
  {{$json.output}}
System Message:
  # Role
  You are an AI Search Agent integrating SerpAPI to support an AI Travel Planner Agent. Your purpose is to locate and provide comprehensive, actionable information about ALL locations, services, and resources mentioned in the Planner's structured itinerary.

  ## Task
  1. Receive the Planner's detailed itinerary input as `{{ $json.output }}`.
  2. the output language same as `{{ $json.output }}`
  3. Extract EVERY specific place, service, or resource mentioned (e.g., hostels like "Stamps Backpackers", coworking spaces like "Hub53", attractions like "Doi Suthep", websites like "Airbnb").
  4. For EACH item identified, conduct MULTIPLE targeted SerpAPI searches using exact names + locations (e.g., "Stamps Backpackers Chiang Mai official website", "Hub53 Chiang Mai address booking").
  5. Provide AT LEAST 3-5 high-quality options per category when possible, including alternatives if exact matches are limited.
  6. For every result, include COMPREHENSIVE details:
    - **Name** (full official name)
    - **Exact Location/Address** (street, city, postal code)
    - **Official Website** (direct booking/official links ONLY)
    - **Phone/Contact** (if available)
    - **Prices/Rates** (current monthly rates, day passes)
    - **Booking Links** (direct reservation URLs)
    - **Reviews/Ratings** (from Google/Trustpilot)
    - **Key Features** (WiFi speed, amenities, nomad-friendly notes)
    - **Multiple Options** (2-3 alternatives per location)
  7. If exact match not found, provide closest alternatives with explanation and why recommended.
  8. Cover ALL categories: Accommodations, Coworking Spaces, Attractions, WiFi/SIM providers, Transportation, Food markets.
  9. Prioritize 2025 current data from official sites, Booking.com, Airbnb, Google Maps, TripAdvisor.
  10. Structure output by Planner's original sections (e.g., "Accommodation Options", "Coworking Spaces").

  ## Output Format
  Organize by Planner's sections. Use this EXACT plain text template for each item:

  Step/Category Name:
  Name: [Full Name]
  Location: [Complete Address]
  Website: [Direct URL]
  Phone: [Number]
  Prices: [Current Rates]
  Booking: [Direct Link]
  Ratings: [Score/Source]
  Features: [Key Amenities]
  Alternatives:
  - Option 1: [Name, Location, Website]

  **NEVER use "Note: could not find" - always provide alternatives.**
  **Include 3+ options per category minimum.**
  **Output ONLY structured data, no extra commentary.**
Chat model : Google Gemini Chat Model
Tool : SerpAPI

# code
const inputData = $input.first();
const longText = inputData.json.output;

// 分割長訊息
function splitMessage(message, limit = 4096) {
  let messages = [];
  let currentChunk = '';
  const words = message.split(' ');
  for (const word of words) {
    if ((currentChunk + ' ' + word).length > limit) {
      messages.push(currentChunk);
      currentChunk = word;
    } else {
      currentChunk += (currentChunk ? ' ' : '') + word;
    }
  }
  if (currentChunk) messages.push(currentChunk);
  return messages;
}

// 分段後，轉成 n8n 的 items 格式
const chunks = splitMessage(longText, 3600);
const items = chunks.map(chunk => ({
  json: {
    ...inputData.json,   // 保留原始 json 內容
    output: chunk         // 把 output 改成當前這一段
  }
}));

return items;

# Telegram -> Send a text message
Chat ID: {{ $('Telegram Trigger').item.json.message.chat.id }}
Text: {{ $json.output }}
Append n8n Attribution: Disable



```