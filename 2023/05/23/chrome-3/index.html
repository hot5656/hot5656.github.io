<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hot5656.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"},"path":"/search.json","localsearch":{"enable":"enable","trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="說明chrome extension component background scripts : event control content scripts : change website page  options page UI elements.crx+manifest file(manifest.json)">
<meta property="og:type" content="article">
<meta property="og:title" content="Chrome Extension">
<meta property="og:url" content="https://hot5656.github.io/2023/05/23/chrome-3/index.html">
<meta property="og:site_name" content="Robert 雜記">
<meta property="og:description" content="說明chrome extension component background scripts : event control content scripts : change website page  options page UI elements.crx+manifest file(manifest.json)">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic31.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic32.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic61.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic62.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic63.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic64.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic33.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic34.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic35.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic55.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic51.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic52.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic53.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic54.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic56.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic57.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic1.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic2.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic3.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic4.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic5.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic6.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic7.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic8.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic5.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic9.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic10.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic11.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic12.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic13.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic14.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic21.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic22.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic23.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic24.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic25.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic41.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic42.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic43.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic44.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic45.png">
<meta property="og:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic46.png">
<meta property="article:published_time" content="2023-05-23T08:52:05.000Z">
<meta property="article:modified_time" content="2023-10-27T04:29:12.715Z">
<meta property="article:author" content="Robert Kao">
<meta property="article:tag" content="chrome">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hot5656.github.io/2023/05/23/chrome-3/pic31.png">


<link rel="canonical" href="https://hot5656.github.io/2023/05/23/chrome-3/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>
<title>Chrome Extension | Robert 雜記</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Robert 雜記</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔列表</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AA%AA%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">說明</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#chrome-extension-component"><span class="nav-number">1.1.</span> <span class="nav-text">chrome extension component</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#search-source-file"><span class="nav-number">1.2.</span> <span class="nav-text">search source file</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#modify-manifest-json-name-amp-description"><span class="nav-number">1.2.1.</span> <span class="nav-text">modify manifest.json name&amp;description</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#prepare-for-publish-move-source-to-src-compress-to-zip"><span class="nav-number">1.3.</span> <span class="nav-text">prepare for publish(move source to src,compress to .zip)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Extension-other-function"><span class="nav-number">1.4.</span> <span class="nav-text">Extension other function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Extension-using-react-warning"><span class="nav-number">1.5.</span> <span class="nav-text">Extension using react warning</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#exceed-the-recommended-size-limit"><span class="nav-number">1.5.1.</span> <span class="nav-text">exceed the recommended size limit</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#webpack-config-js-change-size"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">webpack.config.js change size</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#webpack-config-js-disable-size-check"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">webpack.config.js disable size check</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tool"><span class="nav-number">1.6.</span> <span class="nav-text">tool</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#vscode-setup"><span class="nav-number">1.6.1.</span> <span class="nav-text">vscode setup</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#basic-for-JavaScript"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">basic for JavaScript</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#some-for-Rectc-amp-TypeScript"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">some for Rectc &amp;  TypeScript</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Function"><span class="nav-number">2.</span> <span class="nav-text">Function</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#version-2"><span class="nav-number">2.1.</span> <span class="nav-text">version 2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json"><span class="nav-number">2.1.1.</span> <span class="nav-text">manifest.json</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#chrome-storage-%E5%8A%A0%E5%85%A5-storage-%E5%BE%8C-%E6%9C%89%E6%99%82%E8%A6%81%E7%A7%BB%E9%99%A4%E5%86%8D%E8%BC%89%E5%85%A5%E6%89%8D%E6%9C%83%E6%AD%A3%E5%B8%B8"><span class="nav-number">2.2.</span> <span class="nav-text">chrome storage(加入 storage 後,有時要移除再載入才會正常)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#content-js"><span class="nav-number">2.2.2.</span> <span class="nav-text">content.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script-comminication-x2F-message-passing"><span class="nav-number">2.3.</span> <span class="nav-text">script comminication&#x2F;message passing</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-2"><span class="nav-number">2.3.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#background-js"><span class="nav-number">2.3.2.</span> <span class="nav-text">background.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#backgroundMessaging-js"><span class="nav-number">2.3.3.</span> <span class="nav-text">backgroundMessaging.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#contentMessaging-js"><span class="nav-number">2.3.4.</span> <span class="nav-text">contentMessaging.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#result"><span class="nav-number">2.3.5.</span> <span class="nav-text">result</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cross-origin-http-request-XHR"><span class="nav-number">2.4.</span> <span class="nav-text">cross-origin http request(XHR)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-3"><span class="nav-number">2.4.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#contentRequests-js"><span class="nav-number">2.4.2.</span> <span class="nav-text">contentRequests.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#result-1"><span class="nav-number">2.4.3.</span> <span class="nav-text">result</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#internationalization-localization"><span class="nav-number">2.5.</span> <span class="nav-text">internationalization(localization)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-4"><span class="nav-number">2.5.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-message-for-English-and-Traditional-Chinese"><span class="nav-number">2.5.2.</span> <span class="nav-text">add message for English and Traditional Chinese</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#locales-x2F-en-x2F-messages-json"><span class="nav-number">2.5.3.</span> <span class="nav-text">_locales&#x2F;en&#x2F;messages.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#locales-x2F-zh-TW-x2F-messages-json"><span class="nav-number">2.5.4.</span> <span class="nav-text">_locales&#x2F;zh_TW&#x2F;messages.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#reload-extension-default-Traditional-Chinese"><span class="nav-number">2.5.5.</span> <span class="nav-text">reload extension(default Traditional Chinese)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#change-language-to-english-then-reload-extension"><span class="nav-number">2.5.6.</span> <span class="nav-text">change language to english then reload extension</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#change-button-text-content-js"><span class="nav-number">2.5.7.</span> <span class="nav-text">change button text(content.js)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fix-show-2-%E2%80%9CDO-IT-DARK%E2%80%9D-button"><span class="nav-number">2.6.</span> <span class="nav-text">fix show 2 “DO IT DARK” button</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#contentMessaging-js-1"><span class="nav-number">2.6.1.</span> <span class="nav-text">contentMessaging.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TypeScript-build"><span class="nav-number">2.7.</span> <span class="nav-text">TypeScript build</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#install-TypeScript-module"><span class="nav-number">2.7.1.</span> <span class="nav-text">install TypeScript module</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#change-all-js-files-to-ts-fix-some-typescript-error"><span class="nav-number">2.7.2.</span> <span class="nav-text">change all .js files to .ts + fix some typescript error</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#background-ts"><span class="nav-number">2.7.2.1.</span> <span class="nav-text">background.ts</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#content-ts"><span class="nav-number">2.7.2.2.</span> <span class="nav-text">content.ts</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-tsconfig-json"><span class="nav-number">2.7.3.</span> <span class="nav-text">add tsconfig.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-build-command-package-json"><span class="nav-number">2.7.4.</span> <span class="nav-text">add build command - package.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#build-typescript"><span class="nav-number">2.7.5.</span> <span class="nav-text">build typescript</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Webpack"><span class="nav-number">2.8.</span> <span class="nav-text">Webpack</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Start"><span class="nav-number">3.</span> <span class="nav-text">Start</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setup"><span class="nav-number">3.1.</span> <span class="nav-text">setup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1st-project"><span class="nav-number">3.2.</span> <span class="nav-text">1st project</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#init-install-type"><span class="nav-number">3.2.1.</span> <span class="nav-text">init + install type</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-manifest-json"><span class="nav-number">3.2.2.</span> <span class="nav-text">add manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#load-chrome-extension-from-local"><span class="nav-number">3.2.3.</span> <span class="nav-text">load chrome extension from local</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-background-scripts-for-event-control"><span class="nav-number">3.2.4.</span> <span class="nav-text">add background scripts - for event control</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#manifest-json-5"><span class="nav-number">3.2.4.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#add-background-js"><span class="nav-number">3.2.4.2.</span> <span class="nav-text">add background.js</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#reload-and-see-result"><span class="nav-number">3.2.4.3.</span> <span class="nav-text">reload and see result</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-bookmarks-event"><span class="nav-number">3.2.5.</span> <span class="nav-text">add bookmarks event</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#background-js-1"><span class="nav-number">3.2.5.1.</span> <span class="nav-text">background.js</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#reload-error"><span class="nav-number">3.2.5.2.</span> <span class="nav-text">reload(error)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#manifest-json-add-permissions-for-bookmarks"><span class="nav-number">3.2.5.3.</span> <span class="nav-text">manifest.json add permissions for bookmarks</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#clear-error-then-reload"><span class="nav-number">3.2.5.4.</span> <span class="nav-text">clear error then reload</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#open-new-page-save-bookmark-%E2%80%93-gt-see-triger-bookmarks-onCreated"><span class="nav-number">3.2.5.5.</span> <span class="nav-text">open new page + save bookmark –&gt; see triger bookmarks.onCreated</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#add-content-scripts-add-text-%E2%80%9CDark-mode%E2%80%9D-change-website-page"><span class="nav-number">3.3.</span> <span class="nav-text">add content scripts(add text “Dark mode”) - change website page</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-add-content-scripts"><span class="nav-number">3.3.1.</span> <span class="nav-text">manifest.json add content_scripts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#try-Youtube-add-string-%E2%80%9CDark-mode%E2%80%9D"><span class="nav-number">3.3.2.</span> <span class="nav-text">try Youtube add string “Dark mode”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-content-js"><span class="nav-number">3.3.3.</span> <span class="nav-text">add content.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#reload-extension"><span class="nav-number">3.3.4.</span> <span class="nav-text">reload extension</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-add-matches"><span class="nav-number">3.3.5.</span> <span class="nav-text">manifest.json add matches</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#reload-then-refresh-youtube-website"><span class="nav-number">3.3.6.</span> <span class="nav-text">reload then refresh youtube website</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#content-scripts-add-button-click-trigger-drak-mode"><span class="nav-number">3.4.</span> <span class="nav-text">content scripts(add button, click trigger drak mode)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#content-js-1"><span class="nav-number">3.4.1.</span> <span class="nav-text">content.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-add-exclude-matches-run-at"><span class="nav-number">3.4.2.</span> <span class="nav-text">manifest.json : add exclude_matches, run_at</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#user-interface-change-icon"><span class="nav-number">3.5.</span> <span class="nav-text">user interface(change icon)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#add-icon"><span class="nav-number">3.5.1.</span> <span class="nav-text">add icon</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-add-icon"><span class="nav-number">3.5.2.</span> <span class="nav-text">manifest.json : add icon</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#result-2"><span class="nav-number">3.5.3.</span> <span class="nav-text">result</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#user-interface-show-title-and-popup-window"><span class="nav-number">3.6.</span> <span class="nav-text">user interface(show title and popup window)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-6"><span class="nav-number">3.6.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#background-js-2"><span class="nav-number">3.6.2.</span> <span class="nav-text">background.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-html"><span class="nav-number">3.6.3.</span> <span class="nav-text">popup.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#result-3"><span class="nav-number">3.6.4.</span> <span class="nav-text">result</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#user-interface-add-href-button"><span class="nav-number">3.7.</span> <span class="nav-text">user interface(add href button)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-html-1"><span class="nav-number">3.7.1.</span> <span class="nav-text">popup.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#result-4"><span class="nav-number">3.7.2.</span> <span class="nav-text">result</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Timer-Basic"><span class="nav-number">4.</span> <span class="nav-text">Timer Basic</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#manifest-json-7"><span class="nav-number">4.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#background-js-3"><span class="nav-number">4.2.</span> <span class="nav-text">background.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#popup"><span class="nav-number">4.3.</span> <span class="nav-text">popup</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-html-2"><span class="nav-number">4.3.1.</span> <span class="nav-text">popup.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-css"><span class="nav-number">4.3.2.</span> <span class="nav-text">popup.css</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-js"><span class="nav-number">4.3.3.</span> <span class="nav-text">popup.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#options"><span class="nav-number">4.4.</span> <span class="nav-text">options</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#options-html"><span class="nav-number">4.4.1.</span> <span class="nav-text">options.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#options-css"><span class="nav-number">4.4.2.</span> <span class="nav-text">options.css</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#options-js"><span class="nav-number">4.4.3.</span> <span class="nav-text">options.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pomotoro-Timer"><span class="nav-number">5.</span> <span class="nav-text">Pomotoro Timer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#manifest-json-8"><span class="nav-number">5.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#popup-1"><span class="nav-number">5.2.</span> <span class="nav-text">popup.*</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-html-3"><span class="nav-number">5.2.1.</span> <span class="nav-text">popup.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-css-1"><span class="nav-number">5.2.2.</span> <span class="nav-text">popup.css</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-js-1"><span class="nav-number">5.2.3.</span> <span class="nav-text">popup.js</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#options-1"><span class="nav-number">5.3.</span> <span class="nav-text">options.*</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#options-html-1"><span class="nav-number">5.3.1.</span> <span class="nav-text">options.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#options-css-1"><span class="nav-number">5.3.2.</span> <span class="nav-text">options.css</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#options-js-1"><span class="nav-number">5.3.3.</span> <span class="nav-text">options.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TV-Show"><span class="nav-number">6.</span> <span class="nav-text">TV Show</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#manifest-json-9"><span class="nav-number">6.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#background-js-4"><span class="nav-number">6.2.</span> <span class="nav-text">background.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contentScript-js"><span class="nav-number">6.3.</span> <span class="nav-text">contentScript.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contentScript-css"><span class="nav-number">6.4.</span> <span class="nav-text">contentScript.css</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#popup-2"><span class="nav-number">6.5.</span> <span class="nav-text">popup.*</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-html-4"><span class="nav-number">6.5.1.</span> <span class="nav-text">popup.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-css-2"><span class="nav-number">6.5.2.</span> <span class="nav-text">popup.css</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-js-2"><span class="nav-number">6.5.3.</span> <span class="nav-text">popup.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Extension"><span class="nav-number">7.</span> <span class="nav-text">React Extension</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AA%AA%E6%98%8E-1"><span class="nav-number">7.1.</span> <span class="nav-text">說明</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ts-vs-tsx"><span class="nav-number">7.1.1.</span> <span class="nav-text">.ts vs .tsx</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-init"><span class="nav-number">7.2.</span> <span class="nav-text">npm init</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#test-simple-TypeScript-compile"><span class="nav-number">7.3.</span> <span class="nav-text">test simple TypeScript compile</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#install-TypeScript"><span class="nav-number">7.3.1.</span> <span class="nav-text">install TypeScript</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#test-ts"><span class="nav-number">7.3.2.</span> <span class="nav-text">test.ts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#compile"><span class="nav-number">7.3.3.</span> <span class="nav-text">compile</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#test-React-TypeScript-compile"><span class="nav-number">7.4.</span> <span class="nav-text">test React TypeScript compile</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#install-React"><span class="nav-number">7.4.1.</span> <span class="nav-text">install React</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#tsconfig-json"><span class="nav-number">7.4.2.</span> <span class="nav-text">tsconfig.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#src-x2F-test-jsx"><span class="nav-number">7.4.3.</span> <span class="nav-text">src&#x2F;test.jsx</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#compile-1"><span class="nav-number">7.4.4.</span> <span class="nav-text">compile</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#React-Extension-Template-webpack"><span class="nav-number">7.5.</span> <span class="nav-text">React Extension Template- webpack</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#install-package"><span class="nav-number">7.5.1.</span> <span class="nav-text">install package</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#package-json"><span class="nav-number">7.5.2.</span> <span class="nav-text">package.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#tsconfig-json-TypeScript-configuration"><span class="nav-number">7.5.3.</span> <span class="nav-text">tsconfig.json : TypeScript configuration</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#webpack-configuration"><span class="nav-number">7.5.4.</span> <span class="nav-text">webpack configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#webpack-dev-js-development-configuration"><span class="nav-number">7.5.4.1.</span> <span class="nav-text">webpack.dev.js : development configuration</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#webpack-prod-js-production-configuration"><span class="nav-number">7.5.4.2.</span> <span class="nav-text">webpack.prod.js : production configuration</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#webpack-common-js-common-configuration"><span class="nav-number">7.5.4.3.</span> <span class="nav-text">webpack.common.js :  common configuration</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-3"><span class="nav-number">7.5.5.</span> <span class="nav-text">popup</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#popup-tsx"><span class="nav-number">7.5.5.1.</span> <span class="nav-text">popup.tsx</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#popup-css-3"><span class="nav-number">7.5.5.2.</span> <span class="nav-text">popup.css</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#options-2"><span class="nav-number">7.5.6.</span> <span class="nav-text">options</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#options-tsx"><span class="nav-number">7.5.6.1.</span> <span class="nav-text">options.tsx</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#options-css-2"><span class="nav-number">7.5.6.2.</span> <span class="nav-text">options.css</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#background-ts-1"><span class="nav-number">7.5.7.</span> <span class="nav-text">background.ts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#contentScript-ts"><span class="nav-number">7.5.8.</span> <span class="nav-text">contentScript.ts</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Weather-Extersion"><span class="nav-number">8.</span> <span class="nav-text">Weather Extersion</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#install"><span class="nav-number">8.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#webpack-common-js"><span class="nav-number">8.2.</span> <span class="nav-text">webpack.common.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#manifest-json-10"><span class="nav-number">8.3.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#background-ts-2"><span class="nav-number">8.4.</span> <span class="nav-text">background.ts</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#utils"><span class="nav-number">8.5.</span> <span class="nav-text">utils</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#api-ts"><span class="nav-number">8.5.1.</span> <span class="nav-text">api.ts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#storage-ts"><span class="nav-number">8.5.2.</span> <span class="nav-text">storage.ts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#messages-ts"><span class="nav-number">8.5.3.</span> <span class="nav-text">messages.ts</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#components"><span class="nav-number">8.6.</span> <span class="nav-text">components</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WeatherCard-tsx"><span class="nav-number">8.6.1.</span> <span class="nav-text">WeatherCard.tsx</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WearthCard-css"><span class="nav-number">8.6.2.</span> <span class="nav-text">WearthCard.css</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#options-3"><span class="nav-number">8.7.</span> <span class="nav-text">options</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#options-tsx-1"><span class="nav-number">8.7.1.</span> <span class="nav-text">options.tsx</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#options-css-3"><span class="nav-number">8.7.2.</span> <span class="nav-text">options.css</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#popup-4"><span class="nav-number">8.8.</span> <span class="nav-text">popup</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-tsx-1"><span class="nav-number">8.8.1.</span> <span class="nav-text">popup.tsx</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#popup-css-4"><span class="nav-number">8.8.2.</span> <span class="nav-text">popup.css</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contentScript"><span class="nav-number">8.9.</span> <span class="nav-text">contentScript</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#contentScript-tsx"><span class="nav-number">8.9.1.</span> <span class="nav-text">contentScript.tsx</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#contentScript-css-1"><span class="nav-number">8.9.2.</span> <span class="nav-text">contentScript.css</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AdBlock-Extension"><span class="nav-number">9.</span> <span class="nav-text">AdBlock Extension</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AA%AA%E6%98%8E-2"><span class="nav-number">9.1.</span> <span class="nav-text">說明</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#API"><span class="nav-number">9.1.1.</span> <span class="nav-text">API</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#install-1"><span class="nav-number">9.2.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#version-2-1"><span class="nav-number">9.3.</span> <span class="nav-text">version 2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-11"><span class="nav-number">9.3.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#background-ts-3"><span class="nav-number">9.3.2.</span> <span class="nav-text">background.ts</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#version-3"><span class="nav-number">9.4.</span> <span class="nav-text">version 3</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-12"><span class="nav-number">9.4.1.</span> <span class="nav-text">manifest.json</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#rules-1-json"><span class="nav-number">9.4.2.</span> <span class="nav-text">rules_1.json</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#version-block-by-JS"><span class="nav-number">9.5.</span> <span class="nav-text">version block by JS</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#manifest-json-%E2%80%9Cenabled%E2%80%9D-false-%E4%B8%8D%E4%BD%BF%E7%94%A8-declarativeNetRequest"><span class="nav-number">9.5.1.</span> <span class="nav-text">manifest.json (“enabled”: false 不使用 declarativeNetRequest)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#contentScript-tsx-1"><span class="nav-number">9.5.2.</span> <span class="nav-text">contentScript.tsx</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">10.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ref"><span class="nav-number">11.</span> <span class="nav-text">Ref</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Robert Kao"
      src="/images/head.png">
  <p class="site-author-name" itemprop="name">Robert Kao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">171</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">66</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://hot5656.github.io/2023/05/23/chrome-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="Robert Kao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Robert 雜記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Chrome Extension
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2023-05-23 16:52:05" itemprop="dateCreated datePublished" datetime="2023-05-23T16:52:05+08:00">2023-05-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2023-10-27 12:29:12" itemprop="dateModified" datetime="2023-10-27T12:29:12+08:00">2023-10-27</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2023/05/23/chrome-3/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/05/23/chrome-3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>82k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>1:15</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h4 id="chrome-extension-component"><a href="#chrome-extension-component" class="headerlink" title="chrome extension component"></a>chrome extension component</h4><ul>
<li>background scripts : event control</li>
<li>content scripts : change website page </li>
<li>options page</li>
<li>UI elements<br>.crx<br>+manifest file(manifest.json)</li>
</ul>
<span id="more"></span>

<h4 id="search-source-file"><a href="#search-source-file" class="headerlink" title="search source file"></a>search source file</h4><ul>
<li>Source –&gt; Ctrl + O : search file<div style="max-width:1000px">
<img src="/2023/05/23/chrome-3/pic31.png" class="" title="pic31">
</div></li>
</ul>
<h5 id="modify-manifest-json-name-amp-description"><a href="#modify-manifest-json-name-amp-description" class="headerlink" title="modify manifest.json name&amp;description"></a>modify manifest.json name&amp;description</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;YouTube dark mode&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This extension turn YouTube background to black&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;user.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Created by Robert.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="prepare-for-publish-move-source-to-src-compress-to-zip"><a href="#prepare-for-publish-move-source-to-src-compress-to-zip" class="headerlink" title="prepare for publish(move source to src,compress to .zip)"></a>prepare for publish(move source to src,compress to .zip)</h4><div style="max-width:300px">
  <img src="/2023/05/23/chrome-3/pic32.png" class="" title="pic32">
</div>

<h4 id="Extension-other-function"><a href="#Extension-other-function" class="headerlink" title="Extension other function"></a>Extension other function</h4><ul>
<li>options_page</li>
<li>notifications</li>
<li>Context Menu</li>
</ul>
<h4 id="Extension-using-react-warning"><a href="#Extension-using-react-warning" class="headerlink" title="Extension using react warning"></a>Extension using react warning</h4><h5 id="exceed-the-recommended-size-limit"><a href="#exceed-the-recommended-size-limit" class="headerlink" title="exceed the recommended size limit"></a>exceed the recommended size limit</h5><p>WARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).</p>
<h6 id="webpack-config-js-change-size"><a href="#webpack-config-js-change-size" class="headerlink" title="webpack.config.js change size"></a>webpack.config.js change size</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">performance: &#123;</span><br><span class="line">  maxEntrypointSize: 512000,</span><br><span class="line">  maxAssetSize: 512000,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h6 id="webpack-config-js-disable-size-check"><a href="#webpack-config-js-disable-size-check" class="headerlink" title="webpack.config.js disable size check"></a>webpack.config.js disable size check</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">performance: &#123;</span><br><span class="line">  hints: false,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="tool"><a href="#tool" class="headerlink" title="tool"></a>tool</h4><h5 id="vscode-setup"><a href="#vscode-setup" class="headerlink" title="vscode setup"></a>vscode setup</h5><h6 id="basic-for-JavaScript"><a href="#basic-for-JavaScript" class="headerlink" title="basic for JavaScript"></a>basic for JavaScript</h6><ul>
<li><p>install Prettier - Code formatter</p>
</li>
<li><p>default format(Workspaces)</p>
<div style="max-width:700px">
<img src="/2023/05/23/chrome-3/pic61.png" class="" title="pic61">
</div>
</li>
<li><p>Format On Save</p>
<div style="max-width:700px">
<img src="/2023/05/23/chrome-3/pic62.png" class="" title="pic62">
</div></li>
</ul>
<h6 id="some-for-Rectc-amp-TypeScript"><a href="#some-for-Rectc-amp-TypeScript" class="headerlink" title="some for Rectc &amp;  TypeScript"></a>some for Rectc &amp;  TypeScript</h6><ul>
<li><p>prettier single quote</p>
<div style="max-width:700px">
<img src="/2023/05/23/chrome-3/pic63.png" class="" title="pic63">
</div>
</li>
<li><p>prettier semi</p>
<div style="max-width:700px">
<img src="/2023/05/23/chrome-3/pic64.png" class="" title="pic64">
</div></li>
</ul>
<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><h4 id="version-2"><a href="#version-2" class="headerlink" title="version 2"></a>version 2</h4><h5 id="manifest-json"><a href="#manifest-json" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;__MSG_appName__&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;__MSG_appDescription__&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;default_locale&quot;</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: [<span class="string">&quot;background.js&quot;</span>, <span class="string">&quot;backgroundMessaging.js&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;content.js&quot;</span>, </span><br><span class="line">        <span class="string">&quot;contentMessaging.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contentRequests.js&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span>, </span><br><span class="line">    <span class="string">&quot;storage&quot;</span>, </span><br><span class="line">    <span class="string">&quot;tabs&quot;</span>, </span><br><span class="line">    <span class="string">&quot;https://api.github.com/&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;darkIcon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;darkIcon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;darkIcon.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Created by Tomas, enjoy! :)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="chrome-storage-加入-storage-後-有時要移除再載入才會正常"><a href="#chrome-storage-加入-storage-後-有時要移除再載入才會正常" class="headerlink" title="chrome storage(加入 storage 後,有時要移除再載入才會正常)"></a>chrome storage(加入 storage 後,有時要移除再載入才會正常)</h4><ul>
<li>Storage areas<ul>
<li>storage.local</li>
<li>storage.sync</li>
</ul>
</li>
</ul>
<h5 id="manifest-json-1"><a href="#manifest-json-1" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;YouTube dark mode&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This extension turn YouTube background to black&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span>,</span><br><span class="line">    <span class="string">&quot;storage&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;user.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Created by Robert.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="content-js"><a href="#content-js" class="headerlink" title="content.js"></a>content.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">  button.id = <span class="string">&#x27;darkModeButton&#x27;</span>;</span><br><span class="line">  button.textContent = <span class="string">&quot;DO IT DACK&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> input = <span class="built_in">document</span>.createElement(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">  input.type = <span class="string">&#x27;checkbox&#x27;</span>;</span><br><span class="line">  input.id = <span class="string">&#x27;darkSetting&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// add button ,若使用 #buttons 最後不能顯示,可能是原程式蓋掉加入之button</span></span><br><span class="line">  <span class="comment">// document.querySelector(&quot;#buttons&quot;).prepend(button);</span></span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#end&quot;</span>).prepend(button, input, <span class="string">&#x27;Auto apply?&#x27;</span>);</span><br><span class="line">  button.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    chrome.storage.local.get([<span class="string">&#x27;enabled&#x27;</span>], <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> isEnable = !result.enabled;</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">&#x27;darkSetting&#x27;</span>).checked = isEnable;</span><br><span class="line">      storeSetting();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    enableDarkMode(<span class="literal">true</span>)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save dark mode to chrome storage</span></span><br><span class="line">  input.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> storeSetting())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save dark mode to chrome storage</span></span><br><span class="line">  checkSetting();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// save dark mode to chrome storage</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSetting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  chrome.storage.local.get([<span class="string">&#x27;enabled&#x27;</span>, <span class="string">&#x27;color&#x27;</span>], <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isEnable = result.enabled</span><br><span class="line">    <span class="built_in">console</span>.log(isEnable)</span><br><span class="line">    <span class="built_in">console</span>.log(result.color)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;darkSetting&#x27;</span>).checked = isEnable;</span><br><span class="line">    <span class="keyword">if</span> (isEnable) &#123;</span><br><span class="line">      enableDarkMode(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// save dark mode to chrome storage</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">storeSetting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isEnabled = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;darkSetting&#x27;</span>).checked;</span><br><span class="line">  <span class="keyword">const</span> setting = &#123; <span class="attr">enabled</span>: isEnabled, <span class="attr">color</span>:<span class="string">&#x27;purple&#x27;</span>&#125; ;</span><br><span class="line"></span><br><span class="line">  chrome.storage.local.set(setting, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;store&#x27;</span>, setting);</span><br><span class="line">  &#125;)</span><br><span class="line">  enableDarkMode(isEnabled);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enableDarkMode</span>(<span class="params">flag</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;ytd-app&#x27;</span>)[<span class="number">0</span>].style.backgroundColor= <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;ytd-app&#x27;</span>)[<span class="number">0</span>].style.backgroundColor= <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="script-comminication-x2F-message-passing"><a href="#script-comminication-x2F-message-passing" class="headerlink" title="script comminication&#x2F;message passing"></a>script comminication&#x2F;message passing</h4><h5 id="manifest-json-2"><a href="#manifest-json-2" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;YouTube dark mode&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This extension turn YouTube background to black&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;background.js support import&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;content.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contentMessaging.js&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span>,</span><br><span class="line">    <span class="string">&quot;storage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tabs&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;user.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Created by Robert.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="background-js"><a href="#background-js" class="headerlink" title="background.js"></a>background.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> message <span class="keyword">from</span> <span class="string">&quot;./backgroundMessaging.js&quot;</span></span><br><span class="line"></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">(<span class="params">tab</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(tab)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Extension installed&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">chrome.bookmarks.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Bookmark saved&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要有此 function</span></span><br><span class="line"><span class="comment">// chrome.action.onClicked.addListener( () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;chrome action click&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure>

<h5 id="backgroundMessaging-js"><a href="#backgroundMessaging-js" class="headerlink" title="backgroundMessaging.js"></a>backgroundMessaging.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// chrome.bookmarks.onMoved.addListener(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;Bookmark moved&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">message, sender, sendResponse</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;message&#x27;</span>, message);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;sender&#x27;</span>,sender);</span><br><span class="line">  sendResponse(&#123; <span class="attr">content</span>: <span class="string">&quot;background response&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chrome.bookmarks.onMoved.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// send to active windows</span></span><br><span class="line">  chrome.tabs.query(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, </span><br><span class="line">    tabs =&gt; &#123;</span><br><span class="line">      chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, &#123;<span class="attr">name</span>: <span class="string">&#x27;Robert&#x27;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="contentMessaging-js"><a href="#contentMessaging-js" class="headerlink" title="contentMessaging.js"></a>contentMessaging.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// window.onload(alert(&#x27;I loaded&#x27;));</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload(testMessage());</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testMessage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  chrome.runtime.sendMessage(</span><br><span class="line">    &#123; <span class="attr">payload</span>: <span class="string">&quot;Hellow from a content&quot;</span> &#125;, </span><br><span class="line">    <span class="comment">// backback function for receive side</span></span><br><span class="line">    (response) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(response);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">message, sender</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;message&#x27;</span>, message);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;sender&#x27;</span>,sender);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="result"><a href="#result" class="headerlink" title="result"></a>result</h5><ul>
<li>reload extension</li>
<li>reflash YouTube page</li>
<li>move bookmark</li>
</ul>
<div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic33.png" class="" title="pic33">
</div>

<div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic34.png" class="" title="pic34">
</div>

<h4 id="cross-origin-http-request-XHR"><a href="#cross-origin-http-request-XHR" class="headerlink" title="cross-origin http request(XHR)"></a>cross-origin http request(XHR)</h4><h5 id="manifest-json-3"><a href="#manifest-json-3" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;YouTube dark mode&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This extension turn YouTube background to black&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;background.js support import&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;content.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contentMessaging.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contentRequests.js&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span>,</span><br><span class="line">    <span class="string">&quot;storage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tabs&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;host_permissions&quot;</span>: [<span class="string">&quot;https://api.github.com/&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;user.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Created by Robert.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="contentRequests-js"><a href="#contentRequests-js" class="headerlink" title="contentRequests.js"></a>contentRequests.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nee github api permission(manifest.json</span></span><br><span class="line"><span class="comment">// &quot;host_permissions&quot;: [&quot;https://api.github.com&quot;],</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> requestSender = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">requestSender.onreadystatechange = apiHandler;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0  UNSENT  客戶端已被建立，但 open() 方法尚未被呼叫。</span></span><br><span class="line"><span class="comment">// 1  OPENED  open() 方法已被呼叫。</span></span><br><span class="line"><span class="comment">// 2  HEADERS_RECEIVED  send() 方法已被呼叫，而且可取得 header 與狀態。</span></span><br><span class="line"><span class="comment">// 3  LOADING  回應資料下載中，此時 responseText 會擁有部分資料。</span></span><br><span class="line"><span class="comment">// 4  DONE  完成下載操作。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">apiHandler</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (requestSender.readyState === <span class="number">4</span>  &amp;&amp; requestSender.status === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(response)</span></span><br><span class="line">    <span class="built_in">console</span>.log(response.target.response)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// sync</span></span><br><span class="line"><span class="comment">// requestSender.open(&#x27;GET&#x27;, &#x27;https://api.github.com/users/peter&#x27;, true);</span></span><br><span class="line"><span class="comment">// requestSender.send();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// requestSender.open(&#x27;GET&#x27;, &#x27;https://api.github.com/users/tomas&#x27;, true);</span></span><br><span class="line"><span class="comment">// requestSender.send();</span></span><br><span class="line"><span class="comment">// --&gt; response tomas</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// async</span></span><br><span class="line">requestSender.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;https://api.github.com/users/peter&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">requestSender.send();</span><br><span class="line"></span><br><span class="line">requestSender.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;https://api.github.com/users/tomas&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">requestSender.send();</span><br><span class="line"><span class="comment">// --&gt; response peter and tomas</span></span><br></pre></td></tr></table></figure>

<h5 id="result-1"><a href="#result-1" class="headerlink" title="result"></a>result</h5><div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic35.png" class="" title="pic35">
</div>

<h4 id="internationalization-localization"><a href="#internationalization-localization" class="headerlink" title="internationalization(localization)"></a>internationalization(localization)</h4><h5 id="manifest-json-4"><a href="#manifest-json-4" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;__MSG_appName__&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;__MSG_appDescription__&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;default_locale&quot;</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;background.js support import&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;content.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contentMessaging.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;contentRequests.js&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span>,</span><br><span class="line">    <span class="string">&quot;storage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tabs&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;host_permissions&quot;</span>: [<span class="string">&quot;https://api.github.com/&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;user.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Created by Robert.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="add-message-for-English-and-Traditional-Chinese"><a href="#add-message-for-English-and-Traditional-Chinese" class="headerlink" title="add message for English and Traditional Chinese"></a>add message for English and Traditional Chinese</h5><div style="max-width:300px">
  <img src="/2023/05/23/chrome-3/pic55.png" class="" title="pic55">
</div>

<h5 id="locales-x2F-en-x2F-messages-json"><a href="#locales-x2F-en-x2F-messages-json" class="headerlink" title="_locales&#x2F;en&#x2F;messages.json"></a>_locales&#x2F;en&#x2F;messages.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;appName&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;YouTube dark mode&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;appDescription&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;This extension turn YouTube background to black&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;enableDarkModeText&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;DO IT DARK&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="locales-x2F-zh-TW-x2F-messages-json"><a href="#locales-x2F-zh-TW-x2F-messages-json" class="headerlink" title="_locales&#x2F;zh_TW&#x2F;messages.json"></a>_locales&#x2F;zh_TW&#x2F;messages.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;appName&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;YouTube 深色模式&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;appDescription&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;此擴展將 YouTube 背景變成黑色&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;enableDarkModeText&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;深色模式&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="reload-extension-default-Traditional-Chinese"><a href="#reload-extension-default-Traditional-Chinese" class="headerlink" title="reload extension(default Traditional Chinese)"></a>reload extension(default Traditional Chinese)</h5><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic51.png" class="" title="pic51">
</div>

<h5 id="change-language-to-english-then-reload-extension"><a href="#change-language-to-english-then-reload-extension" class="headerlink" title="change language to english then reload extension"></a>change language to english then reload extension</h5><div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic52.png" class="" title="pic52">
</div>

<div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic53.png" class="" title="pic53">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic54.png" class="" title="pic54">
</div>


<h5 id="change-button-text-content-js"><a href="#change-button-text-content-js" class="headerlink" title="change button text(content.js)"></a>change button text(content.js)</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">  button.id = <span class="string">&#x27;darkModeButton&#x27;</span>;</span><br><span class="line">  <span class="comment">// button.textContent = &quot;DO IT DACK&quot;;</span></span><br><span class="line">  button.textContent =  chrome.i18n.getMessage(<span class="string">&quot;enableDarkModeText&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> input = <span class="built_in">document</span>.createElement(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">  input.type = <span class="string">&#x27;checkbox&#x27;</span>;</span><br><span class="line">  input.id = <span class="string">&#x27;darkSetting&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// add button ,若使用 #buttons 最後不能顯示,可能是原程式蓋掉加入之button</span></span><br><span class="line">  <span class="comment">// document.querySelector(&quot;#buttons&quot;).prepend(button);</span></span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#end&quot;</span>).prepend(button, input, <span class="string">&#x27;Auto apply?&#x27;</span>);</span><br><span class="line">  button.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    chrome.storage.local.get([<span class="string">&#x27;enabled&#x27;</span>], <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> isEnable = !result.enabled;</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">&#x27;darkSetting&#x27;</span>).checked = isEnable;</span><br><span class="line">      storeSetting();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    enableDarkMode(<span class="literal">true</span>)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save dark mode to chrome storage</span></span><br><span class="line">  input.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> storeSetting())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save dark mode to chrome storage</span></span><br><span class="line">  checkSetting();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic56.png" class="" title="pic56">
</div>

<h4 id="fix-show-2-“DO-IT-DARK”-button"><a href="#fix-show-2-“DO-IT-DARK”-button" class="headerlink" title="fix show 2 “DO IT DARK” button"></a>fix show 2 “DO IT DARK” button</h4><h5 id="contentMessaging-js-1"><a href="#contentMessaging-js-1" class="headerlink" title="contentMessaging.js"></a>contentMessaging.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// window.onload(alert(&#x27;I loaded&#x27;));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// call window.onload twince ,show 2 &quot;DO IT DARK&quot; button</span></span><br><span class="line"><span class="comment">// window.onload(testMessage());</span></span><br><span class="line">testMessage()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testMessage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  chrome.runtime.sendMessage(</span><br><span class="line">    &#123; <span class="attr">payload</span>: <span class="string">&quot;Hellow from a content&quot;</span> &#125;, </span><br><span class="line">    <span class="comment">// backback function for receive side</span></span><br><span class="line">    (response) =&gt; &#123;</span><br><span class="line">      <span class="comment">// console.log(response);</span></span><br><span class="line">      ;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">message, sender</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;message&#x27;</span>, message);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;sender&#x27;</span>,sender);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="TypeScript-build"><a href="#TypeScript-build" class="headerlink" title="TypeScript build"></a>TypeScript build</h4><h5 id="install-TypeScript-module"><a href="#install-TypeScript-module" class="headerlink" title="install TypeScript module"></a>install TypeScript module</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install TypeScript</span></span><br><span class="line">npm install typescript --save-dev</span><br></pre></td></tr></table></figure>

<h5 id="change-all-js-files-to-ts-fix-some-typescript-error"><a href="#change-all-js-files-to-ts-fix-some-typescript-error" class="headerlink" title="change all .js files to .ts + fix some typescript error"></a>change all .js files to .ts + fix some typescript error</h5><h6 id="background-ts"><a href="#background-ts" class="headerlink" title="background.ts"></a>background.ts</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import * as message from &quot;./backgroundMessaging.js&quot;</span></span><br><span class="line"><span class="comment">// typescript fix</span></span><br><span class="line">importScripts(<span class="string">&quot;./backgroundMessaging.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">(<span class="params">tab</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(tab)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Extension installed&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">chrome.bookmarks.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Bookmark saved&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要有此 function</span></span><br><span class="line"><span class="comment">// chrome.action.onClicked.addListener( () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;chrome action click&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure>

<h6 id="content-ts"><a href="#content-ts" class="headerlink" title="content.ts"></a>content.ts</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">  button.id = <span class="string">&#x27;darkModeButton&#x27;</span>;</span><br><span class="line">  <span class="comment">// button.textContent = &quot;DO IT DACK&quot;;</span></span><br><span class="line">  button.textContent =  chrome.i18n.getMessage(<span class="string">&quot;enableDarkModeText&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> input = <span class="built_in">document</span>.createElement(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">  input.type = <span class="string">&#x27;checkbox&#x27;</span>;</span><br><span class="line">  input.id = <span class="string">&#x27;darkSetting&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// add button ,若使用 #buttons 最後不能顯示,可能是原程式蓋掉加入之button</span></span><br><span class="line">  <span class="comment">// document.querySelector(&quot;#buttons&quot;).prepend(button);</span></span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#end&quot;</span>).prepend(button, input, <span class="string">&#x27;Auto apply?&#x27;</span>);</span><br><span class="line">  button.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    chrome.storage.local.get([<span class="string">&#x27;enabled&#x27;</span>], <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> isEnable = !result.enabled;</span><br><span class="line">      <span class="comment">// typescript fix</span></span><br><span class="line">      <span class="keyword">const</span> settingCheckbox = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;darkSetting&#x27;</span>) <span class="keyword">as</span> HTMLInputElement;</span><br><span class="line">      <span class="comment">// (document.getElementById(&#x27;darkSetting&#x27;) as HTMLInputElement).checked = isEnable;</span></span><br><span class="line">      settingCheckbox.checked = isEnable;</span><br><span class="line">      storeSetting();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    enableDarkMode(<span class="literal">true</span>)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save dark mode to chrome storage</span></span><br><span class="line">  input.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> storeSetting())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save dark mode to chrome storage</span></span><br><span class="line">  checkSetting();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// save dark mode to chrome storage</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSetting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  chrome.storage.local.get([<span class="string">&#x27;enabled&#x27;</span>, <span class="string">&#x27;color&#x27;</span>], <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isEnable = result.enabled</span><br><span class="line">    <span class="comment">// console.log(isEnable)</span></span><br><span class="line">    <span class="comment">// console.log(result.color)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// typescript fix</span></span><br><span class="line">    <span class="keyword">const</span> settingCheckbox = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;darkSetting&#x27;</span>) <span class="keyword">as</span> HTMLInputElement;</span><br><span class="line">    settingCheckbox.checked = isEnable;</span><br><span class="line">    <span class="keyword">if</span> (isEnable) &#123;</span><br><span class="line">      enableDarkMode(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// save dark mode to chrome storage</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">storeSetting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> settingCheckbox = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;darkSetting&#x27;</span>) <span class="keyword">as</span> HTMLInputElement;</span><br><span class="line">  <span class="keyword">const</span> isEnabled = settingCheckbox.checked;</span><br><span class="line">  <span class="keyword">const</span> setting = &#123; <span class="attr">enabled</span>: isEnabled, <span class="attr">color</span>:<span class="string">&#x27;purple&#x27;</span>&#125; ;</span><br><span class="line"></span><br><span class="line">  chrome.storage.local.set(setting, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;store&#x27;, setting);</span></span><br><span class="line">    ;</span><br><span class="line">  &#125;)</span><br><span class="line">  enableDarkMode(isEnabled);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enableDarkMode</span>(<span class="params">flag</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// typescript fix</span></span><br><span class="line">  <span class="keyword">const</span> websiteBody = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;ytd-app&#x27;</span>)[<span class="number">0</span>] <span class="keyword">as</span> HTMLElement;</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    websiteBody.style.backgroundColor= <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    websiteBody.style.backgroundColor= <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="add-tsconfig-json"><a href="#add-tsconfig-json" class="headerlink" title="add tsconfig.json"></a>add tsconfig.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span>: <span class="string">&quot;./dist&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [<span class="string">&quot;./src/**/*&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="add-build-command-package-json"><a href="#add-build-command-package-json" class="headerlink" title="add build command - package.json"></a>add build command - package.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;01-xx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;1st chrome &quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;tsc&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@types/chrome&quot;</span>: <span class="string">&quot;^0.0.243&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: <span class="string">&quot;^0.1.1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span>: <span class="string">&quot;^5.1.6&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="build-typescript"><a href="#build-typescript" class="headerlink" title="build typescript"></a>build typescript</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<div style="max-width:400px">
  <img src="/2023/05/23/chrome-3/pic57.png" class="" title="pic57">
</div>

<h4 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># have some issue - just list need instal package</span></span><br><span class="line">npm install webpack webpack-cli --save-dev</span><br><span class="line">npm install glob --save-dev</span><br><span class="line">npm install ts-loader --save-dev</span><br><span class="line">npm install copy-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h3><h4 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h4><ul>
<li><p>install node.js</p>
</li>
<li><p>chrome:&#x2F;&#x2F;extensions –&gt; on developer mode(開發人員模式)</p>
<div style="max-width:500px">
<img src="/2023/05/23/chrome-3/pic1.png" class="" title="pic1">
</div></li>
</ul>
<h4 id="1st-project"><a href="#1st-project" class="headerlink" title="1st project"></a>1st project</h4><h5 id="init-install-type"><a href="#init-install-type" class="headerlink" title="init + install type"></a>init + install type</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm install types @types/chrome</span><br><span class="line"></span><br><span class="line"><span class="comment"># install yarn by npm</span></span><br><span class="line">npm install --global yarn</span><br><span class="line">yarn --version</span><br></pre></td></tr></table></figure>

<h5 id="add-manifest-json"><a href="#add-manifest-json" class="headerlink" title="add manifest.json"></a>add manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="load-chrome-extension-from-local"><a href="#load-chrome-extension-from-local" class="headerlink" title="load chrome extension from local"></a>load chrome extension from local</h5><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic2.png" class="" title="pic2">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic3.png" class="" title="pic3">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic4.png" class="" title="pic4">
</div>


<h5 id="add-background-scripts-for-event-control"><a href="#add-background-scripts-for-event-control" class="headerlink" title="add background scripts - for event control"></a>add background scripts - for event control</h5><h6 id="manifest-json-5"><a href="#manifest-json-5" class="headerlink" title="manifest.json"></a>manifest.json</h6><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="add-background-js"><a href="#add-background-js" class="headerlink" title="add background.js"></a>add background.js</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;installed&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h6 id="reload-and-see-result"><a href="#reload-and-see-result" class="headerlink" title="reload and see result"></a>reload and see result</h6><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic5.png" class="" title="pic5">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic6.png" class="" title="pic6">
</div>

<div style="max-width:700px">
  <img src="/2023/05/23/chrome-3/pic7.png" class="" title="pic7">
</div>

<div style="max-width:700px">
  <img src="/2023/05/23/chrome-3/pic8.png" class="" title="pic8">
</div>

<h5 id="add-bookmarks-event"><a href="#add-bookmarks-event" class="headerlink" title="add bookmarks event"></a>add bookmarks event</h5><h6 id="background-js-1"><a href="#background-js-1" class="headerlink" title="background.js"></a>background.js</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;installed&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">chrome.bookmarks.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Bookmark saved&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="reload-error"><a href="#reload-error" class="headerlink" title="reload(error)"></a>reload(error)</h6><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic5.png" class="" title="pic5">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic9.png" class="" title="pic9">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic10.png" class="" title="pic10">
</div>

<h6 id="manifest-json-add-permissions-for-bookmarks"><a href="#manifest-json-add-permissions-for-bookmarks" class="headerlink" title="manifest.json add permissions for bookmarks"></a>manifest.json add permissions for bookmarks</h6><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="clear-error-then-reload"><a href="#clear-error-then-reload" class="headerlink" title="clear error then reload"></a>clear error then reload</h6><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic11.png" class="" title="pic11">
</div>
<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic12.png" class="" title="pic12">
</div>

<h6 id="open-new-page-save-bookmark-–-gt-see-triger-bookmarks-onCreated"><a href="#open-new-page-save-bookmark-–-gt-see-triger-bookmarks-onCreated" class="headerlink" title="open new page + save bookmark –&gt; see triger bookmarks.onCreated"></a>open new page + save bookmark –&gt; see triger bookmarks.onCreated</h6><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic13.png" class="" title="pic13">
</div>
<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic14.png" class="" title="pic14">
</div>

<h4 id="add-content-scripts-add-text-“Dark-mode”-change-website-page"><a href="#add-content-scripts-add-text-“Dark-mode”-change-website-page" class="headerlink" title="add content scripts(add text “Dark mode”) - change website page"></a>add content scripts(add text “Dark mode”) - change website page</h4><h5 id="manifest-json-add-content-scripts"><a href="#manifest-json-add-content-scripts" class="headerlink" title="manifest.json add content_scripts"></a>manifest.json add content_scripts</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="try-Youtube-add-string-“Dark-mode”"><a href="#try-Youtube-add-string-“Dark-mode”" class="headerlink" title="try Youtube add string “Dark mode”"></a>try Youtube add string “Dark mode”</h5><div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic21.png" class="" title="pic21">
</div>

<h5 id="add-content-js"><a href="#add-content-js" class="headerlink" title="add content.js"></a>add content.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#buttons&quot;</span>).prepend(<span class="string">&quot;Dark mode&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="reload-extension"><a href="#reload-extension" class="headerlink" title="reload extension"></a>reload extension</h5><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic22.png" class="" title="pic22">
</div>


<h5 id="manifest-json-add-matches"><a href="#manifest-json-add-matches" class="headerlink" title="manifest.json add matches"></a>manifest.json add matches</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="reload-then-refresh-youtube-website"><a href="#reload-then-refresh-youtube-website" class="headerlink" title="reload then refresh youtube website"></a>reload then refresh youtube website</h5><div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic23.png" class="" title="pic23">
</div>


<h4 id="content-scripts-add-button-click-trigger-drak-mode"><a href="#content-scripts-add-button-click-trigger-drak-mode" class="headerlink" title="content scripts(add button, click trigger drak mode)"></a>content scripts(add button, click trigger drak mode)</h4><h5 id="content-js-1"><a href="#content-js-1" class="headerlink" title="content.js"></a>content.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">  button.id = <span class="string">&#x27;darkModeButton&#x27;</span>;</span><br><span class="line">  button.textContent = <span class="string">&quot;DO IT DACK&quot;</span>;</span><br><span class="line">  <span class="comment">// add button ,若使用 #buttons 最後不能顯示,可能是原程式蓋掉加入之button</span></span><br><span class="line">  <span class="comment">// document.querySelector(&quot;#buttons&quot;).prepend(button);</span></span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#end&quot;</span>).prepend(button);</span><br><span class="line">  button.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> enableDarkMode());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enableDarkMode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;ytd-app&#x27;</span>)[<span class="number">0</span>].style.backgroundColor= <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="manifest-json-add-exclude-matches-run-at"><a href="#manifest-json-add-exclude-matches-run-at" class="headerlink" title="manifest.json : add exclude_matches, run_at"></a>manifest.json : add exclude_matches, run_at</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;調整 js 開始執行時間&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic24.png" class="" title="pic24">
</div>

<div style="max-width:1000px">
  <img src="/2023/05/23/chrome-3/pic25.png" class="" title="pic25">
</div>

<h4 id="user-interface-change-icon"><a href="#user-interface-change-icon" class="headerlink" title="user interface(change icon)"></a>user interface(change icon)</h4><h5 id="add-icon"><a href="#add-icon" class="headerlink" title="add icon"></a>add icon</h5><div style="max-width:300px">
  <img src="/2023/05/23/chrome-3/pic41.png" class="" title="pic41">
</div>

<h5 id="manifest-json-add-icon"><a href="#manifest-json-add-icon" class="headerlink" title="manifest.json : add icon"></a>manifest.json : add icon</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;調整 js 開始執行時間&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;user.png&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="result-2"><a href="#result-2" class="headerlink" title="result"></a>result</h5><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic42.png" class="" title="pic42">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic43.png" class="" title="pic43">
</div>

<h4 id="user-interface-show-title-and-popup-window"><a href="#user-interface-show-title-and-popup-window" class="headerlink" title="user interface(show title and popup window)"></a>user interface(show title and popup window)</h4><h5 id="manifest-json-6"><a href="#manifest-json-6" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;My first extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is my very first coll extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;//&quot;</span>: <span class="string">&quot;排除某些執行 url&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [<span class="string">&quot;https://*.youtube.com/watch*&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_end&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;user.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;user.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Created by Robert.&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="background-js-2"><a href="#background-js-2" class="headerlink" title="background.js"></a>background.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">(<span class="params">tab</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(tab)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;installed&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">chrome.bookmarks.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Bookmark saved&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要有此 function</span></span><br><span class="line"><span class="comment">// chrome.action.onClicked.addListener( () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;chrome action click&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure>

<h5 id="popup-html"><a href="#popup-html" class="headerlink" title="popup.html"></a>popup.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./user.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span>&gt;</span></span><br><span class="line">  Head over to YouTube and a new icon wall appear!</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="result-3"><a href="#result-3" class="headerlink" title="result"></a>result</h5><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic44.png" class="" title="pic44">
</div>

<div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic45.png" class="" title="pic45">
</div>

<h4 id="user-interface-add-href-button"><a href="#user-interface-add-href-button" class="headerlink" title="user interface(add href button)"></a>user interface(add href button)</h4><h5 id="popup-html-1"><a href="#popup-html-1" class="headerlink" title="popup.html"></a>popup.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./user.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span>&gt;</span></span><br><span class="line">  Head over to YouTube and a new icon wall appear!</span><br><span class="line">  <span class="comment">&lt;!-- add href button(need add target open another page)--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://google.com.tw&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_balck&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>Visit homepage<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- add js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;popup.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="result-4"><a href="#result-4" class="headerlink" title="result"></a>result</h5><div style="max-width:500px">
  <img src="/2023/05/23/chrome-3/pic46.png" class="" title="pic46">
</div>

<h3 id="Timer-Basic"><a href="#Timer-Basic" class="headerlink" title="Timer Basic"></a>Timer Basic</h3><ul>
<li><p>manifest.json</p>
<ul>
<li><p>manifest_version(1)</p>
</li>
<li><p>name(1)</p>
</li>
<li><p>version(1)</p>
</li>
<li><p>description(1)</p>
</li>
<li><p>icons(1)</p>
</li>
<li><p>action(2)</p>
</li>
<li><p>options_page(3)</p>
</li>
<li><p>permissions(4)</p>
</li>
<li><p>background(5)</p>
</li>
</ul>
</li>
<li><p>action</p>
<ul>
<li>popup.*</li>
<li>setBadgeText</li>
</ul>
</li>
<li><p>options_page</p>
<ul>
<li>options.*</li>
</ul>
</li>
<li><p>storage</p>
<ul>
<li>permissions</li>
<li>chrome.storage.sync.set</li>
<li>chrome.storage.sync.get</li>
<li>chrome.storage.local.set</li>
<li>chrome.storage.local.get</li>
</ul>
</li>
<li><p>background(sometime sleep)</p>
<ul>
<li>“service_worker”: “background.js”</li>
</ul>
</li>
<li><p>alarm API(trigger continue run)</p>
<ul>
<li>permissions</li>
<li>chrome.alarms.create</li>
<li>chrome.alarms.onAlarm.addListener(</li>
</ul>
</li>
<li><p>notifications API</p>
<ul>
<li>permissions</li>
<li>this.registration.showNotification</li>
</ul>
</li>
</ul>
<h4 id="manifest-json-7"><a href="#manifest-json-7" class="headerlink" title="manifest.json"></a>manifest.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Timer Extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Hellow Chrome world!&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;24&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;32&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Timer Extension Action Title&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;storage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;alarms&quot;</span>,</span><br><span class="line">    <span class="string">&quot;notifications&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="background-js-3"><a href="#background-js-3" class="headerlink" title="background.js"></a>background.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console.log(&quot;Hello from the background script!&quot;);</span></span><br><span class="line"><span class="comment">// console.log(this);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let time = 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// setInterval(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   time += 1;</span></span><br><span class="line"><span class="comment">//   console.log(time);</span></span><br><span class="line"><span class="comment">// &#125;, 1000);</span></span><br><span class="line"></span><br><span class="line">chrome.alarms.create(&#123;</span><br><span class="line">  periodInMinutes: <span class="number">1</span> / <span class="number">60</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">chrome.alarms.onAlarm.addListener(<span class="function">(<span class="params">alarm</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(alarm);</span></span><br><span class="line"></span><br><span class="line">  chrome.storage.local.get([<span class="string">&quot;timer&quot;</span>, <span class="string">&quot;isRunning&quot;</span>], <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(&quot;background&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> time = res.timer ?? <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> isRunning = res.isRunning ?? <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isRunning) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    chrome.storage.local.set(&#123;</span><br><span class="line">      timer: time + <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    chrome.action.setBadgeText(&#123;</span><br><span class="line">      text: <span class="string">`<span class="subst">$&#123;time + <span class="number">1</span>&#125;</span>`</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    chrome.storage.sync.get(<span class="string">&quot;notificationTime&quot;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> notificationTime = res.notificationTime ?? <span class="number">10000</span>;</span><br><span class="line">      <span class="keyword">if</span> (time % notificationTime == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.registration.showNotification(<span class="string">&quot;Chrome Timer Extension&quot;</span>, &#123;</span><br><span class="line">          body: <span class="string">`<span class="subst">$&#123;notificationTime&#125;</span> senconds has passed! (time = <span class="subst">$&#123;time&#125;</span>)`</span>,</span><br><span class="line">          icon: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// console.log(&quot;tick&quot;, notificationTime, time);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if (time % 100 == 0) &#123;</span></span><br><span class="line">    <span class="comment">//   this.registration.showNotification(&quot;Chrome Timer Extension&quot;, &#123;</span></span><br><span class="line">    <span class="comment">//     body: &quot;100 senconds has passed!&quot;,</span></span><br><span class="line">    <span class="comment">//     icon: &quot;icon.png&quot;,</span></span><br><span class="line">    <span class="comment">//   &#125;);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="popup"><a href="#popup" class="headerlink" title="popup"></a>popup</h4><h5 id="popup-html-2"><a href="#popup-html-2" class="headerlink" title="popup.html"></a>popup.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Timer Extension(popup)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;popup.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Timer Extension<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;time&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;timer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;start&quot;</span>&gt;</span>Start Timer<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;stop&quot;</span>&gt;</span>Stop Timer<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;reset&quot;</span>&gt;</span>Reset Timer<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;popup.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="popup-css"><a href="#popup-css" class="headerlink" title="popup.css"></a>popup.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="popup-js"><a href="#popup-js" class="headerlink" title="popup.js"></a>popup.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeElement = <span class="built_in">document</span>.getElementById(<span class="string">&quot;time&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> nameElement = <span class="built_in">document</span>.getElementById(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> timerElement = <span class="built_in">document</span>.getElementById(<span class="string">&quot;timer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateTimeElement</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;popup&quot;);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> currentTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleTimeString();</span><br><span class="line">  timeElement.textContent = <span class="string">`The Time is: <span class="subst">$&#123;currentTime&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  chrome.storage.local.get([<span class="string">&quot;timer&quot;</span>], <span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> time = resp.timer ?? <span class="number">0</span>;</span><br><span class="line">    timerElement.textContent = <span class="string">`The timer is at: <span class="subst">$&#123;time&#125;</span> seconds`</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateTimeElement();</span><br><span class="line"><span class="built_in">setInterval</span>(updateTimeElement, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// move to background.js</span></span><br><span class="line"><span class="comment">// chrome.action.setBadgeText(</span></span><br><span class="line"><span class="comment">//   &#123;</span></span><br><span class="line"><span class="comment">//     text: &quot;TIME&quot;,</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">//   () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log(&quot;Finished setting badge text.&quot;);</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// );</span></span><br><span class="line"></span><br><span class="line">chrome.storage.sync.get([<span class="string">&quot;name&quot;</span>], <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// if undefine or null return string</span></span><br><span class="line">  <span class="keyword">const</span> name = res.name ?? <span class="string">&quot;???&quot;</span>;</span><br><span class="line">  nameElement.textContent = <span class="string">`Your name is: <span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// start, stop, reset</span></span><br><span class="line"><span class="keyword">const</span> startBtn = <span class="built_in">document</span>.getElementById(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> stopBtn = <span class="built_in">document</span>.getElementById(<span class="string">&quot;stop&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> resetBtn = <span class="built_in">document</span>.getElementById(<span class="string">&quot;reset&quot;</span>);</span><br><span class="line"></span><br><span class="line">startBtn.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  chrome.storage.local.set(&#123;</span><br><span class="line">    isRunning: <span class="literal">true</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">stopBtn.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  chrome.storage.local.set(&#123;</span><br><span class="line">    isRunning: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">resetBtn.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  chrome.storage.local.set(&#123;</span><br><span class="line">    timer: <span class="number">0</span>,</span><br><span class="line">    isRunning: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="options"><a href="#options" class="headerlink" title="options"></a>options</h4><h5 id="options-html"><a href="#options-html" class="headerlink" title="options.html"></a>options.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Timer Entension Options<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;options.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Timer Extension Options<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;name-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your name&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;time-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter notification time in seconds&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;save-btn&quot;</span>&gt;</span>Save Options<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;options.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="options-css"><a href="#options-css" class="headerlink" title="options.css"></a>options.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="options-js"><a href="#options-js" class="headerlink" title="options.js"></a>options.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console.log(&quot;Hello from the options page!&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nameInput = <span class="built_in">document</span>.getElementById(<span class="string">&quot;name-input&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> timeInput = <span class="built_in">document</span>.getElementById(<span class="string">&quot;time-input&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> saveBtn = <span class="built_in">document</span>.getElementById(<span class="string">&quot;save-btn&quot;</span>);</span><br><span class="line"></span><br><span class="line">saveBtn.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(nameInput.value);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> name = nameInput.value;</span><br><span class="line">  <span class="keyword">const</span> notificationTime = timeInput.value;</span><br><span class="line">  chrome.storage.sync.set(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// name: name</span></span><br><span class="line">      name,</span><br><span class="line">      notificationTime,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// () =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   console.log(`Name is set to $&#123;name&#125;`);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">chrome.storage.sync.get([<span class="string">&quot;name&quot;</span>, <span class="string">&quot;notificationTime&quot;</span>], <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(res);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// if undefine or null return string</span></span><br><span class="line">  nameInput.value = res.name ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">  timeInput.value = res.notificationTime ?? <span class="number">1000</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(&quot;options&quot;);</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Pomotoro-Timer"><a href="#Pomotoro-Timer" class="headerlink" title="Pomotoro Timer"></a>Pomotoro Timer</h3><h4 id="manifest-json-8"><a href="#manifest-json-8" class="headerlink" title="manifest.json"></a>manifest.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Pomotoro Timer&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Helps you focus on some things!&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Pomodoro Timer&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup/popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;storage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;alarms&quot;</span>,</span><br><span class="line">    <span class="string">&quot;notifications&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span>: <span class="string">&quot;options/options.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="popup-1"><a href="#popup-1" class="headerlink" title="popup.*"></a>popup.*</h4><h5 id="popup-html-3"><a href="#popup-html-3" class="headerlink" title="popup.html"></a>popup.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;popup.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pomodoro Timer<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../icon.png&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;time&quot;</span>&gt;</span>00:00<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;btn-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;start-timer-btn&quot;</span>&gt;</span>Start Timer<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;reset-timer-btn&quot;</span>&gt;</span>Reset Timer<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;add-task-btn&quot;</span>&gt;</span>Add Task<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;task-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;input type=&quot;text&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;input type=&quot;button&quot; value=&quot;x&quot;&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;popup.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="popup-css-1"><a href="#popup-css-1" class="headerlink" title="popup.css"></a>popup.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">350px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: indianred;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: whitesmoke;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#time</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">color</span>: whitesmoke;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#btn-container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-evenly;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#btn-container</span> &gt; <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: indianred;</span><br><span class="line">  <span class="attribute">background-color</span>: whitesmoke;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#task-container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-input</span> &#123;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">250px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-delete</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">color</span>: indianred;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">25px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="popup-js-1"><a href="#popup-js-1" class="headerlink" title="popup.js"></a>popup.js</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tasks = [];</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">updateTime</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  chrome.storage.local.<span class="keyword">get</span>([<span class="string">&quot;timer&quot;</span>, <span class="string">&quot;timeOption&quot;</span>], (res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> time = document.getElementById(<span class="string">&quot;time&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> minutes = `$&#123;res.timeOption - Math.ceil(res.timer / <span class="number">60</span>)&#125;`.padStart(</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">&quot;0&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> seconds =</span><br><span class="line">      res.timer % <span class="number">60</span> != <span class="number">0</span> ? `$&#123;<span class="number">60</span> - (res.timer % <span class="number">60</span>)&#125;`.padStart(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>) : <span class="string">&quot;00&quot;</span>;</span><br><span class="line">    time.textContent = `$&#123;minutes&#125;:$&#123;seconds&#125;`;</span><br><span class="line">    <span class="comment">// time.textContent = res.timer;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateTime();</span><br><span class="line">chrome.storage.local.<span class="keyword">get</span>([<span class="string">&quot;isRunning&quot;</span>], (res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> startTimerBtn = document.getElementById(<span class="string">&quot;start-timer-btn&quot;</span>);</span><br><span class="line">  startTimerBtn.textContent = res.isRunning ? <span class="string">&quot;Pause Timer&quot;</span> : <span class="string">&quot;Start Timer&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">setInterval(updateTime, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> startTimerBtn = document.getElementById(<span class="string">&quot;start-timer-btn&quot;</span>);</span><br><span class="line">startTimerBtn.addEventListener(<span class="string">&quot;click&quot;</span>, () =&gt; &#123;</span><br><span class="line">  chrome.storage.local.<span class="keyword">get</span>([<span class="string">&quot;isRunning&quot;</span>], (res) =&gt; &#123;</span><br><span class="line">    chrome.storage.local.<span class="keyword">set</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        isRunning: !res.isRunning,</span><br><span class="line">      &#125;,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        startTimerBtn.textContent = !res.isRunning</span><br><span class="line">          ? <span class="string">&quot;Pause Timer&quot;</span></span><br><span class="line">          : <span class="string">&quot;Start Timer&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resetTimerBtn = document.getElementById(<span class="string">&quot;reset-timer-btn&quot;</span>);</span><br><span class="line">resetTimerBtn.addEventListener(<span class="string">&quot;click&quot;</span>, () =&gt; &#123;</span><br><span class="line">  chrome.storage.local.<span class="keyword">set</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      timer: <span class="number">0</span>,</span><br><span class="line">      isRunning: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      startTimerBtn.textContent = <span class="string">&quot;Start Timer&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addTaskBtn = document.getElementById(<span class="string">&quot;add-task-btn&quot;</span>);</span><br><span class="line">addTaskBtn.addEventListener(<span class="string">&quot;click&quot;</span>, () =&gt; addTask());</span><br><span class="line"></span><br><span class="line">chrome.storage.sync.<span class="keyword">get</span>([<span class="string">&quot;tasks&quot;</span>], (res) =&gt; &#123;</span><br><span class="line">  tasks = res.tasks ? res.tasks : [];</span><br><span class="line">  renderTasks();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">saveTasks</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  chrome.storage.sync.<span class="keyword">set</span>(&#123;</span><br><span class="line">    tasks,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">renderTask</span>(<span class="params">taskNum</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> taskRow = document.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> text = document.createElement(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">  text.type = <span class="string">&quot;text&quot;</span>;</span><br><span class="line">  text.placeholder = <span class="string">&quot;Enter a task...&quot;</span>;</span><br><span class="line">  text.<span class="keyword">value</span> = tasks[taskNum];</span><br><span class="line">  text.classList = <span class="string">&quot;task-input&quot;</span>;</span><br><span class="line">  text.addEventListener(<span class="string">&quot;change&quot;</span>, () =&gt; &#123;</span><br><span class="line">    tasks[taskNum] = text.<span class="keyword">value</span>;</span><br><span class="line">    saveTasks();</span><br><span class="line">    <span class="comment">// console.log(taskNum, tasks);</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> deleteBtn = document.createElement(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">  deleteBtn.type = <span class="string">&quot;button&quot;</span>;</span><br><span class="line">  deleteBtn.<span class="keyword">value</span> = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">  deleteBtn.className = <span class="string">&quot;task-delete&quot;</span>;</span><br><span class="line">  deleteBtn.addEventListener(<span class="string">&quot;click&quot;</span>, () =&gt; &#123;</span><br><span class="line">    deleteTask(taskNum);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  taskRow.appendChild(text);</span><br><span class="line">  taskRow.appendChild(deleteBtn);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> taskContainer = document.getElementById(<span class="string">&quot;task-container&quot;</span>);</span><br><span class="line">  taskContainer.appendChild(taskRow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">addTask</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> taskNum = tasks.length;</span><br><span class="line">  tasks.push(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  renderTask(taskNum);</span><br><span class="line">  saveTasks();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">deleteTask</span>(<span class="params">taskNum</span>)</span> &#123;</span><br><span class="line">  tasks.splice(taskNum, <span class="number">1</span>);</span><br><span class="line">  renderTasks();</span><br><span class="line">  saveTasks();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">renderTasks</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> taskContainer = document.getElementById(<span class="string">&quot;task-container&quot;</span>);</span><br><span class="line">  taskContainer.textContent = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  tasks.forEach((taskText, taskNum) =&gt; &#123;</span><br><span class="line">    renderTask(taskNum);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="options-1"><a href="#options-1" class="headerlink" title="options.*"></a>options.*</h4><h5 id="options-html-1"><a href="#options-html-1" class="headerlink" title="options.html"></a>options.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;options.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pomodoro Timer Extension Options<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Pomodoro Timer Options<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      Deafult Timer Mintues (1 - 60):</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;time-option&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">min</span>=<span class="string">&quot;1&quot;</span> <span class="attr">max</span>=<span class="string">&quot;60&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;save-btn&quot;</span>&gt;</span>Save Options<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;options.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="options-css-1"><a href="#options-css-1" class="headerlink" title="options.css"></a>options.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: indianred;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: whitesmoke;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">color</span>: whitesmoke;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#time-option</span> &#123;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#save-btn</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">color</span>: indianred;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="options-js-1"><a href="#options-js-1" class="headerlink" title="options.js"></a>options.js</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeOption = document.getElementById(<span class="string">&quot;time-option&quot;</span>);</span><br><span class="line">timeOption.addEventListener(<span class="string">&quot;change&quot;</span>, (<span class="keyword">event</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> val = <span class="keyword">event</span>.target.<span class="keyword">value</span>;</span><br><span class="line">  <span class="keyword">if</span> (val &lt; <span class="number">1</span> || val &gt; <span class="number">60</span>) &#123;</span><br><span class="line">    timeOption.<span class="keyword">value</span> = <span class="number">25</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> saveBtn = document.getElementById(<span class="string">&quot;save-btn&quot;</span>);</span><br><span class="line">saveBtn.addEventListener(<span class="string">&quot;click&quot;</span>, () =&gt; &#123;</span><br><span class="line">  chrome.storage.local.<span class="keyword">set</span>(&#123;</span><br><span class="line">    timer: <span class="number">0</span>,</span><br><span class="line">    timeOption: timeOption.<span class="keyword">value</span>,</span><br><span class="line">    isRunning: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">chrome.storage.local.<span class="keyword">get</span>([<span class="string">&quot;timeOption&quot;</span>], (res) =&gt; &#123;</span><br><span class="line">  timeOption.<span class="keyword">value</span> = res.timeOption;</span><br><span class="line">  console.log(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="TV-Show"><a href="#TV-Show" class="headerlink" title="TV Show"></a>TV Show</h3><ul>
<li>background.js<ul>
<li>chrome.runtime</li>
<li>chrome.contextMenus</li>
<li>chrome.search</li>
<li>chrome.tabs</li>
</ul>
</li>
<li>Content scripts</li>
<li>Message<ul>
<li>chrome.runtime.sendMessage</li>
<li>chrome.runtime.onMessage.addListener</li>
<li>chrome.tabs.sendMessage</li>
</ul>
</li>
<li>Data Fetching:fetch()</li>
<li>chrome.tts (synthesized text-to-speech)</li>
</ul>
<h4 id="manifest-json-9"><a href="#manifest-json-9" class="headerlink" title="manifest.json"></a>manifest.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;TV Show Search&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Search for all your favourite TV shows!&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;TV Show Search&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup/popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;contextMenus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;search&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tabs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;storage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tts&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;&lt;all_urls&gt;&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;exclude_matches&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;https://store.google.com/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;css&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;contentScript.css&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;contentScript.js&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="background-js-4"><a href="#background-js-4" class="headerlink" title="background.js"></a>background.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">(<span class="params">details</span>) =&gt;</span> &#123;</span><br><span class="line">  chrome.storage.local.set(&#123;</span><br><span class="line">    shows: [],</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console.log(details);</span></span><br><span class="line">  chrome.contextMenus.create(&#123;</span><br><span class="line">    title: <span class="string">&quot;Search TV Show&quot;</span>,</span><br><span class="line">    id: <span class="string">&quot;contextMenu1&quot;</span>,</span><br><span class="line">    contexts: [<span class="string">&quot;page&quot;</span>, <span class="string">&quot;selection&quot;</span>],</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  chrome.contextMenus.create(&#123;</span><br><span class="line">    title: <span class="string">&quot;Read This Text&quot;</span>,</span><br><span class="line">    id: <span class="string">&quot;contextMenu2&quot;</span>,</span><br><span class="line">    contexts: [<span class="string">&quot;page&quot;</span>, <span class="string">&quot;selection&quot;</span>],</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// call 3rd party API</span></span><br><span class="line">  chrome.contextMenus.onClicked.addListener(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.menuItemId === <span class="string">&quot;contextMenu1&quot;</span>) &#123;</span><br><span class="line">      fetch(<span class="string">`https://api.tvmaze.com/search/shows?q=<span class="subst">$&#123;event.selectionText&#125;</span>`</span>)</span><br><span class="line">        .then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">        .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(data);</span><br><span class="line">          chrome.storage.local.set(&#123;</span><br><span class="line">            shows: data,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event.menuItemId === <span class="string">&quot;contextMenu2&quot;</span>) &#123;</span><br><span class="line">      chrome.tts.speak(event.selectionText, &#123;</span><br><span class="line">        <span class="comment">// support auto detect</span></span><br><span class="line">        <span class="comment">// lang: &quot;zh&quot;,</span></span><br><span class="line">        rate: <span class="number">2</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// search</span></span><br><span class="line">  <span class="comment">// chrome.contextMenus.onClicked.addListener((event) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(event);</span></span><br><span class="line">  <span class="comment">//   // google search</span></span><br><span class="line">  <span class="comment">//   // chrome.search.query(&#123;</span></span><br><span class="line">  <span class="comment">//   //   disposition: &quot;NEW_TAB&quot;,</span></span><br><span class="line">  <span class="comment">//   //   // imdb TV show</span></span><br><span class="line">  <span class="comment">//   //   text: `imdb $&#123;event.selectionText&#125;`,</span></span><br><span class="line">  <span class="comment">//   // &#125;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//   // check open website</span></span><br><span class="line">  <span class="comment">//   // chrome.tabs.query(</span></span><br><span class="line">  <span class="comment">//   //   &#123;</span></span><br><span class="line">  <span class="comment">//   //     currentWindow: true,</span></span><br><span class="line">  <span class="comment">//   //   &#125;,</span></span><br><span class="line">  <span class="comment">//   //   (tabs) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   //     console.log(tabs);</span></span><br><span class="line">  <span class="comment">//   //   &#125;</span></span><br><span class="line">  <span class="comment">//   // );</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//   // create window</span></span><br><span class="line">  <span class="comment">//   chrome.tabs.create(&#123;</span></span><br><span class="line">  <span class="comment">//     url: `https://www.imdb.com/find/?q=$&#123;event.selectionText&#125;&amp;ref_=nv_sr_sm`,</span></span><br><span class="line">  <span class="comment">//   &#125;);</span></span><br><span class="line">  <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// children menu</span></span><br><span class="line">  <span class="comment">// chrome.contextMenus.create(&#123;</span></span><br><span class="line">  <span class="comment">//   title: &quot;Test Context Menu 1&quot;,</span></span><br><span class="line">  <span class="comment">//   id: &quot;contextMenu1-1&quot;,</span></span><br><span class="line">  <span class="comment">//   parentId: &quot;contextMenu1&quot;,</span></span><br><span class="line">  <span class="comment">//   contexts: [&quot;page&quot;, &quot;selection&quot;],</span></span><br><span class="line">  <span class="comment">// &#125;);</span></span><br><span class="line">  <span class="comment">// chrome.contextMenus.create(&#123;</span></span><br><span class="line">  <span class="comment">//   title: &quot;Test Context Menu 2&quot;,</span></span><br><span class="line">  <span class="comment">//   id: &quot;contextMenu1-2&quot;,</span></span><br><span class="line">  <span class="comment">//   parentId: &quot;contextMenu1&quot;,</span></span><br><span class="line">  <span class="comment">//   contexts: [&quot;page&quot;, &quot;selection&quot;],</span></span><br><span class="line">  <span class="comment">// &#125;);</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(&quot;background script running&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// receive message from content</span></span><br><span class="line"><span class="comment">// chrome.runtime.onMessage.addListener((msg, sender, sendResponse) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;msg(background):&quot;, msg);</span></span><br><span class="line"><span class="comment">//   console.log(&quot;sender(background):&quot;, sender);</span></span><br><span class="line"><span class="comment">//   // console.log(&quot;sendResponse:&quot;, sendResponse);</span></span><br><span class="line"><span class="comment">//   sendResponse(&quot;receive message from background&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//   chrome.tabs.sendMessage(sender.tab.id, &quot;Got your message from background!&quot;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br></pre></td></tr></table></figure>

<h4 id="contentScript-js"><a href="#contentScript-js" class="headerlink" title="contentScript.js"></a>contentScript.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console.log(&quot;Hello from the content script!&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// confirm(&quot;Hello from the content script!&quot;);</span></span><br><span class="line"><span class="comment">// const aTags = document.getElementsByTagName(&quot;a&quot;);</span></span><br><span class="line"><span class="comment">// for (const tag of aTags) &#123;</span></span><br><span class="line"><span class="comment">//   // tag.textContent = &quot;Hello world!&quot;;</span></span><br><span class="line"><span class="comment">//   if (tag.textContent.includes(&quot;i&quot;)) &#123;</span></span><br><span class="line"><span class="comment">//     tag.style = &quot;background-color: yellow;&quot;;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> text = [];</span><br><span class="line"><span class="keyword">const</span> aTags = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> tag <span class="keyword">of</span> aTags) &#123;</span><br><span class="line">  text.push(tag.textContent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chrome.storage.local.set(&#123;</span><br><span class="line">  text,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// send message to background</span></span><br><span class="line"><span class="comment">// chrome.runtime.sendMessage(null, text, (response) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;I&#x27;m from the send response function:&quot; + response);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// receive message from background</span></span><br><span class="line"><span class="comment">// chrome.runtime.onMessage.addListener((message, sender, sendResponse) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;message(content):&quot; + message);</span></span><br><span class="line"><span class="comment">//   console.log(&quot;sender(content):&quot;, sender);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br></pre></td></tr></table></figure>

<h4 id="contentScript-css"><a href="#contentScript-css" class="headerlink" title="contentScript.css"></a>contentScript.css</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="comment">/* background-color: palegreen !important; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="popup-2"><a href="#popup-2" class="headerlink" title="popup.*"></a>popup.*</h4><h5 id="popup-html-4"><a href="#popup-html-4" class="headerlink" title="popup.html"></a>popup.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;popup.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>TV Show Search<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;popup.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="popup-css-2"><a href="#popup-css-2" class="headerlink" title="popup.css"></a>popup.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="popup-js-2"><a href="#popup-js-2" class="headerlink" title="popup.js"></a>popup.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// receive message from content(same as background)</span></span><br><span class="line"><span class="comment">// chrome.runtime.onMessage.addListener((message, sender, sendResponse) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;message(popup):&quot; + message);</span></span><br><span class="line"><span class="comment">//   console.log(&quot;sender(popup):&quot;, sender);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// show 3rd party json from storage</span></span><br><span class="line">chrome.storage.local.get([<span class="string">&quot;shows&quot;</span>], <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> show <span class="keyword">of</span> res.shows) &#123;</span><br><span class="line">    renderShow(show);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderShow</span>(<span class="params">show</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> showDiv = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> title = <span class="built_in">document</span>.createElement(<span class="string">&quot;h3&quot;</span>);</span><br><span class="line">  title.textContent = show.show.name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> image = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">  image.src = show.show.image ? show.show.image.medium : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  showDiv.appendChild(title);</span><br><span class="line">  showDiv.appendChild(image);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(showDiv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="React-Extension"><a href="#React-Extension" class="headerlink" title="React Extension"></a>React Extension</h3><h4 id="說明-1"><a href="#說明-1" class="headerlink" title="說明"></a>說明</h4><h5 id="ts-vs-tsx"><a href="#ts-vs-tsx" class="headerlink" title=".ts vs .tsx"></a>.ts vs .tsx</h5><ul>
<li>.jsx 是javascript文件並表明使用了JSX語法。</li>
<li>.ts 是typescript 文件的擴展名</li>
<li>.tsx 表明是typescript 文件並使用了JSX語法。</li>
</ul>
<h4 id="npm-init"><a href="#npm-init" class="headerlink" title="npm init"></a>npm init</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm init</span></span><br><span class="line">$ npm init</span><br><span class="line">  package name: (j04-react) react-extension</span><br><span class="line">  version: (1.0.0)</span><br><span class="line">  description: Chrome extension <span class="keyword">in</span> React!</span><br><span class="line">  entry point: (index.js)</span><br><span class="line">  <span class="built_in">test</span> <span class="built_in">command</span>:</span><br><span class="line">  git repository:</span><br><span class="line">  keywords:</span><br><span class="line">  author: Robert</span><br><span class="line">  license: (ISC)</span><br></pre></td></tr></table></figure>

<h4 id="test-simple-TypeScript-compile"><a href="#test-simple-TypeScript-compile" class="headerlink" title="test simple TypeScript compile"></a>test simple TypeScript compile</h4><h5 id="install-TypeScript"><a href="#install-TypeScript" class="headerlink" title="install TypeScript"></a>install TypeScript</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install typescript</span></span><br><span class="line">npm install typescript --save-dev</span><br></pre></td></tr></table></figure>

<h5 id="test-ts"><a href="#test-ts" class="headerlink" title="test.ts"></a>test.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> test: <span class="built_in">string</span> = <span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx tsc *.ts</span><br></pre></td></tr></table></figure>

<h4 id="test-React-TypeScript-compile"><a href="#test-React-TypeScript-compile" class="headerlink" title="test React TypeScript compile"></a>test React TypeScript compile</h4><h5 id="install-React"><a href="#install-React" class="headerlink" title="install React"></a>install React</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ======== course modify</span></span><br><span class="line"><span class="comment"># npm i react@17.0.1 --save-dev</span></span><br><span class="line">npm i react --save-dev</span><br></pre></td></tr></table></figure>

<h5 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a>tsconfig.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [<span class="string">&quot;src/**/*.ts&quot;</span>, <span class="string">&quot;src/**/*.tsx&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span>: [<span class="string">&quot;node_modules&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="src-x2F-test-jsx"><a href="#src-x2F-test-jsx" class="headerlink" title="src&#x2F;test.jsx"></a>src&#x2F;test.jsx</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> test = <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hellow Wrold!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h5 id="compile-1"><a href="#compile-1" class="headerlink" title="compile"></a>compile</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npx tsc *.ts</span><br><span class="line"><span class="comment"># src/test.js</span></span><br><span class="line"><span class="comment"># import React from &#x27;react&#x27;;</span></span><br><span class="line"><span class="comment"># const test = React.createElement(&quot;p&quot;, null, &quot;Hellow Wrold!&quot;);</span></span><br></pre></td></tr></table></figure>

<h4 id="React-Extension-Template-webpack"><a href="#React-Extension-Template-webpack" class="headerlink" title="React Extension Template- webpack"></a>React Extension Template- webpack</h4><h5 id="install-package"><a href="#install-package" class="headerlink" title="install package"></a>install package</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm init</span></span><br><span class="line">$ npm init</span><br><span class="line"><span class="comment"># install TypeScript</span></span><br><span class="line">npm install typescript --save-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># install webpack and webpack-cli</span></span><br><span class="line">npm i webpack --save-dev</span><br><span class="line">npm i webpack-cli --save-dev</span><br><span class="line"><span class="comment"># install TypeScript loader</span></span><br><span class="line">npm i ts-loader --save-dev</span><br><span class="line"><span class="comment"># install copy-webpack-plugin</span></span><br><span class="line">npm i --save-dev copy-webpack-plugin</span><br><span class="line"><span class="comment"># install html-webpack-plugin</span></span><br><span class="line">npm i --save-dev html-webpack-plugin</span><br><span class="line"><span class="comment"># install react-dom</span></span><br><span class="line">npm i --save-dev react-dom</span><br><span class="line"><span class="comment"># install style-loader/css-loader</span></span><br><span class="line">npm i --save-dev style-loader</span><br><span class="line">npm i --save-dev css-loader</span><br><span class="line"><span class="comment"># install @types</span></span><br><span class="line">npm i --save-dev @types/react</span><br><span class="line">npm i --save-dev @types/react-dom</span><br><span class="line">npm i --save-dev @types/chrome</span><br><span class="line"><span class="comment"># install webpack-merge</span></span><br><span class="line">npm i --save-dev webpack-merge</span><br><span class="line"><span class="comment"># install clean-webpack-plugin</span></span><br><span class="line">npm i --save-dev clean-webpack-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># develop build</span></span><br><span class="line">npm run start</span><br><span class="line"><span class="comment"># product build</span></span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<h5 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;react-extension&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Chrome extension in React!&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;start&quot;</span>: <span class="string">&quot;webpack --watch --progress --config webpack.dev.js&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;build&quot;</span>: <span class="string">&quot;webpack --watch --progress --config webpack.prod.js&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;author&quot;</span>: <span class="string">&quot;Robert&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;@types/chrome&quot;</span>: <span class="string">&quot;^0.0.244&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;@types/react&quot;</span>: <span class="string">&quot;^18.2.21&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;@types/react-dom&quot;</span>: <span class="string">&quot;^18.2.7&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;clean-webpack-plugin&quot;</span>: <span class="string">&quot;^4.0.0&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;copy-webpack-plugin&quot;</span>: <span class="string">&quot;^11.0.0&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;css-loader&quot;</span>: <span class="string">&quot;^6.8.1&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;html-webpack-plugin&quot;</span>: <span class="string">&quot;^5.5.3&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;react&quot;</span>: <span class="string">&quot;^18.2.0&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;react-dom&quot;</span>: <span class="string">&quot;^18.2.0&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;style-loader&quot;</span>: <span class="string">&quot;^3.3.3&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;ts-loader&quot;</span>: <span class="string">&quot;^9.4.4&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;typescript&quot;</span>: <span class="string">&quot;^5.2.2&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;^5.88.2&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^5.1.4&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;webpack-merge&quot;</span>: <span class="string">&quot;^5.9.0&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="tsconfig-json-TypeScript-configuration"><a href="#tsconfig-json-TypeScript-configuration" class="headerlink" title="tsconfig.json : TypeScript configuration"></a>tsconfig.json : TypeScript configuration</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>,               <span class="comment">// jsx 為 react 檔</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,         <span class="comment">// 指定生成哪種模組</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es6&quot;</span>,              <span class="comment">// 指定編譯生成的JS版本</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,   <span class="comment">// 選擇模組解析策略 : 支持使用import d from &#x27;cjs&#x27;的方式引入commonjs包</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>       <span class="comment">// 兼容模組導入的方式</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [<span class="string">&quot;src/**/*.ts&quot;</span>, <span class="string">&quot;src/**/*.tsx&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span>: [<span class="string">&quot;node_modules&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="webpack-configuration"><a href="#webpack-configuration" class="headerlink" title="webpack configuration"></a>webpack configuration</h5><h6 id="webpack-dev-js-development-configuration"><a href="#webpack-dev-js-development-configuration" class="headerlink" title="webpack.dev.js : development configuration"></a>webpack.dev.js : development configuration</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  devtool: <span class="string">&#x27;cheap-module-source-map&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h6 id="webpack-prod-js-production-configuration"><a href="#webpack-prod-js-production-configuration" class="headerlink" title="webpack.prod.js : production configuration"></a>webpack.prod.js : production configuration</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h6 id="webpack-common-js-common-configuration"><a href="#webpack-common-js-common-configuration" class="headerlink" title="webpack.common.js :  common configuration"></a>webpack.common.js :  common configuration</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> CopyPlugin = <span class="built_in">require</span>(<span class="string">&#x27;copy-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    <span class="comment">// process tsx/ts</span></span><br><span class="line">    popup: path.resolve(<span class="string">&#x27;src/popup/popup.tsx&#x27;</span>),</span><br><span class="line">    options: path.resolve(<span class="string">&#x27;src/options/options.tsx&#x27;</span>),</span><br><span class="line">    background: path.resolve(<span class="string">&#x27;src/background/background.ts&#x27;</span>),</span><br><span class="line">    contentScript: path.resolve(<span class="string">&#x27;src/contentScript/contentScript.ts&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">// process txs/ts rule</span></span><br><span class="line">      &#123;</span><br><span class="line">        use: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">        test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// support load .css</span></span><br><span class="line">      &#123;</span><br><span class="line">        use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">        test: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 指定 jpg,jpeg ...處理方式</span></span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">        test: <span class="regexp">/\.(jpg|jpeg|png|woff|woff2|eot|ttf|svg)$/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// clean ./dist file</span></span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(&#123;</span><br><span class="line">      cleanStaleWebpackAssets: <span class="literal">false</span>, <span class="comment">//  run when switch product/develop</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CopyPlugin(&#123;</span><br><span class="line">      patterns: [</span><br><span class="line">        <span class="comment">// copy src/static files</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">from</span>: path.resolve(<span class="string">&#x27;src/static&#x27;</span>),</span><br><span class="line">          to: path.resolve(<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// direction call HtmlPlugin</span></span><br><span class="line">    <span class="comment">// also generate .html</span></span><br><span class="line">    <span class="comment">// new HtmlPlugin(&#123;</span></span><br><span class="line">    <span class="comment">//   title: &#x27;React Extension&#x27;,</span></span><br><span class="line">    <span class="comment">//   filename: &#x27;popup.html&#x27;,</span></span><br><span class="line">    <span class="comment">//   template: &#x27;src/popup/template.html&#x27;,</span></span><br><span class="line">    <span class="comment">//   chunks: [&#x27;popup&#x27;],</span></span><br><span class="line">    <span class="comment">// &#125;),</span></span><br><span class="line">    <span class="comment">// change call HtmlPlugin by function</span></span><br><span class="line">    <span class="comment">// also generate .html</span></span><br><span class="line">    ...getHTMLPlugins([<span class="string">&#x27;popup&#x27;</span>, <span class="string">&#x27;options&#x27;</span>]),</span><br><span class="line">  ],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    <span class="comment">// 處理省略副檔名的檔案</span></span><br><span class="line">    extensions: [<span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.tx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// set output path</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    path: path.resolve(<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 依據選擇的mode執行不同的優化</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    <span class="comment">// 設定區要分割檔案區塊的項目</span></span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      <span class="comment">// 表示要用甚麼樣的方式去提取文件</span></span><br><span class="line">      <span class="comment">// async：只處理動態引入的模塊</span></span><br><span class="line">      <span class="comment">// all：不論是動態還是非動態引入的模塊，同時進行優化打包</span></span><br><span class="line">      <span class="comment">// initial：把非動態模塊打包，動態模塊進行優化打包</span></span><br><span class="line">      chunks: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// change call HtmlPlugin by function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHTMLPlugins</span>(<span class="params">chunks</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> chunks.map(</span><br><span class="line">    (chunk) =&gt;</span><br><span class="line">      <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">        title: <span class="string">&#x27;React Extension&#x27;</span>,</span><br><span class="line">        filename: <span class="string">`<span class="subst">$&#123;chunk&#125;</span>.html`</span>,</span><br><span class="line">        chunks: [chunk],</span><br><span class="line">      &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="popup-3"><a href="#popup-3" class="headerlink" title="popup"></a>popup</h5><h6 id="popup-tsx"><a href="#popup-tsx" class="headerlink" title="popup.tsx"></a>popup.tsx</h6><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./popup.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;img src=<span class="string">&quot;icon.png&quot;</span> /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(rootElement)</span><br><span class="line"><span class="keyword">const</span> root = ReactDOM.createRoot(rootElement)</span><br><span class="line"></span><br><span class="line">root.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>)</span><br></pre></td></tr></table></figure>

<h6 id="popup-css-3"><a href="#popup-css-3" class="headerlink" title="popup.css"></a>popup.css</h6><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1c1c1c</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="options-2"><a href="#options-2" class="headerlink" title="options"></a>options</h5><h6 id="options-tsx"><a href="#options-tsx" class="headerlink" title="options.tsx"></a>options.tsx</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./options.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;img src=<span class="string">&quot;icon.png&quot;</span> /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(rootElement)</span><br><span class="line"><span class="keyword">const</span> root = ReactDOM.createRoot(rootElement)</span><br><span class="line"></span><br><span class="line">root.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>)</span><br></pre></td></tr></table></figure>

<h6 id="options-css-2"><a href="#options-css-2" class="headerlink" title="options.css"></a>options.css</h6><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1c1c1c</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="background-ts-1"><a href="#background-ts-1" class="headerlink" title="background.ts"></a>background.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console.log(&#x27;Background Script&#x27;)</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> background script</span></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> on installed function</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="contentScript-ts"><a href="#contentScript-ts" class="headerlink" title="contentScript.ts"></a>contentScript.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> content script</span></span><br><span class="line"><span class="comment">// console.log(&#x27;contentScript running!&#x27;)</span></span><br></pre></td></tr></table></figure>

<h3 id="Weather-Extersion"><a href="#Weather-Extersion" class="headerlink" title="Weather Extersion"></a>Weather Extersion</h3><h4 id="install"><a href="#install" class="headerlink" title="install"></a>install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm i</span><br><span class="line"></span><br><span class="line"><span class="comment"># install material ui</span></span><br><span class="line">npm install --save--dev @mui/material @emotion/react @emotion/styled</span><br><span class="line"><span class="comment"># install Roboto font</span></span><br><span class="line">npm install --save--dev @fontsource/roboto</span><br><span class="line"></span><br><span class="line"><span class="comment"># icon</span></span><br><span class="line">npm i --save-dev @mui/icons-material</span><br></pre></td></tr></table></figure>

<h4 id="webpack-common-js"><a href="#webpack-common-js" class="headerlink" title="webpack.common.js"></a>webpack.common.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> CopyPlugin = <span class="built_in">require</span>(<span class="string">&#x27;copy-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    <span class="comment">// process tsx/ts</span></span><br><span class="line">    popup: path.resolve(<span class="string">&#x27;src/popup/popup.tsx&#x27;</span>),</span><br><span class="line">    options: path.resolve(<span class="string">&#x27;src/options/options.tsx&#x27;</span>),</span><br><span class="line">    background: path.resolve(<span class="string">&#x27;src/background/background.ts&#x27;</span>),</span><br><span class="line">    contentScript: path.resolve(<span class="string">&#x27;src/contentScript/contentScript.tsx&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">// process txs/ts rule</span></span><br><span class="line">      &#123;</span><br><span class="line">        use: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">        test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// support load .css</span></span><br><span class="line">      &#123;</span><br><span class="line">        use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">        test: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 指定 jpg,jpeg ...處理方式</span></span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">        test: <span class="regexp">/\.(jpg|jpeg|png|woff|woff2|eot|ttf|svg)$/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// clean ./dist file</span></span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(&#123;</span><br><span class="line">      cleanStaleWebpackAssets: <span class="literal">false</span>, <span class="comment">//  run when switch product/develop</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CopyPlugin(&#123;</span><br><span class="line">      patterns: [</span><br><span class="line">        <span class="comment">// copy src/static files</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">from</span>: path.resolve(<span class="string">&#x27;src/static&#x27;</span>),</span><br><span class="line">          to: path.resolve(<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// direction call HtmlPlugin</span></span><br><span class="line">    <span class="comment">// also generate .html</span></span><br><span class="line">    <span class="comment">// new HtmlPlugin(&#123;</span></span><br><span class="line">    <span class="comment">//   title: &#x27;React Extension&#x27;,</span></span><br><span class="line">    <span class="comment">//   filename: &#x27;popup.html&#x27;,</span></span><br><span class="line">    <span class="comment">//   template: &#x27;src/popup/template.html&#x27;,</span></span><br><span class="line">    <span class="comment">//   chunks: [&#x27;popup&#x27;],</span></span><br><span class="line">    <span class="comment">// &#125;),</span></span><br><span class="line">    <span class="comment">// change call HtmlPlugin by function</span></span><br><span class="line">    <span class="comment">// also generate .html</span></span><br><span class="line">    ...getHTMLPlugins([<span class="string">&#x27;popup&#x27;</span>, <span class="string">&#x27;options&#x27;</span>]),</span><br><span class="line">  ],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    <span class="comment">// 處理省略副檔名的檔案</span></span><br><span class="line">    extensions: [<span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// set output path</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    path: path.resolve(<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 依據選擇的mode執行不同的優化</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    <span class="comment">// 設定區要分割檔案區塊的項目</span></span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      <span class="comment">// 表示要用甚麼樣的方式去提取文件</span></span><br><span class="line">      <span class="comment">// async：只處理動態引入的模塊</span></span><br><span class="line">      <span class="comment">// all：不論是動態還是非動態引入的模塊，同時進行優化打包</span></span><br><span class="line">      <span class="comment">// initial：把非動態模塊打包，動態模塊進行優化打包</span></span><br><span class="line">      <span class="comment">// chunks: &#x27;all&#x27;,</span></span><br><span class="line">      <span class="comment">// 因 contentScript 不能 share Recat module, 所以不執行 chunks(優化) %?%</span></span><br><span class="line">      <span class="function"><span class="title">chunks</span>(<span class="params">chunk</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chunk.name !== <span class="string">&#x27;contentScript&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// change call HtmlPlugin by function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHTMLPlugins</span>(<span class="params">chunks</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> chunks.map(</span><br><span class="line">    (chunk) =&gt;</span><br><span class="line">      <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">        title: <span class="string">&#x27;Weather Extension&#x27;</span>,</span><br><span class="line">        filename: <span class="string">`<span class="subst">$&#123;chunk&#125;</span>.html`</span>,</span><br><span class="line">        chunks: [chunk],</span><br><span class="line">      &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="manifest-json-10"><a href="#manifest-json-10" class="headerlink" title="manifest.json"></a>manifest.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Weather Extension&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Chrome Extension for Weather&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;tabs&quot;</span>,</span><br><span class="line">		<span class="string">&quot;alarms&quot;</span>,</span><br><span class="line">		<span class="string">&quot;contextMenus&quot;</span>,</span><br><span class="line">		<span class="string">&quot;storage&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Weather Extension&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;default_icon&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;matches&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;&lt;all_urls&gt;&quot;</span></span><br><span class="line">			],</span><br><span class="line">			<span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;contentScript.js&quot;</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="background-ts-2"><a href="#background-ts-2" class="headerlink" title="background.ts"></a>background.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fetchOpenWeatherData &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/api&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getStoredCities,</span><br><span class="line">  setStoredCities,</span><br><span class="line">  getStoredOptions,</span><br><span class="line">  setStoredOptions,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  setStoredCities([])</span><br><span class="line">  setStoredOptions(&#123;</span><br><span class="line">    hasAutoOverlay: <span class="literal">false</span>,</span><br><span class="line">    homeCity: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    tempScale: <span class="string">&#x27;metric&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// context menu %?%</span></span><br><span class="line">  chrome.contextMenus.create(&#123;</span><br><span class="line">    contexts: [<span class="string">&#x27;selection&#x27;</span>],</span><br><span class="line">    title: <span class="string">&#x27;Add city to weather extension&#x27;</span>,</span><br><span class="line">    id: <span class="string">&#x27;weatherExtension&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// alarm %?%</span></span><br><span class="line">  chrome.alarms.create(&#123;</span><br><span class="line">    <span class="comment">// periodInMinutes: 60,</span></span><br><span class="line">    <span class="comment">// 10 sec</span></span><br><span class="line">    periodInMinutes: <span class="number">10</span> / <span class="number">60</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// context menu %?%</span></span><br><span class="line">chrome.contextMenus.onClicked.addListener(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  getStoredCities().then(<span class="function">(<span class="params">cities</span>) =&gt;</span> &#123;</span><br><span class="line">    setStoredCities([...cities, event.selectionText])</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// alarm %?%</span></span><br><span class="line">chrome.alarms.onAlarm.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  getStoredOptions().then(<span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (options.homeCity === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchOpenWeatherData(options.homeCity, options.tempScale).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = <span class="built_in">Math</span>.round(data.main.temp)</span><br><span class="line">      <span class="keyword">const</span> symbol = options.tempScale === <span class="string">&#x27;metric&#x27;</span> ? <span class="string">&#x27;\u2103&#x27;</span> : <span class="string">&#x27;\u2109&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// chrome extension badge %?%</span></span><br><span class="line">      chrome.action.setBadgeText(&#123;</span><br><span class="line">        text: <span class="string">`<span class="subst">$&#123;temp&#125;</span><span class="subst">$&#123;symbol&#125;</span>`</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h4><h5 id="api-ts"><a href="#api-ts" class="headerlink" title="api.ts"></a>api.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; OPEN_WEATHER_API_KEY &#125; <span class="keyword">from</span> <span class="string">&#x27;./env&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> OpenWeatherData &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  main: &#123;</span><br><span class="line">    feels_like: <span class="built_in">number</span></span><br><span class="line">    humidity: <span class="built_in">number</span></span><br><span class="line">    pressure: <span class="built_in">number</span></span><br><span class="line">    temp: <span class="built_in">number</span></span><br><span class="line">    temp_max: <span class="built_in">number</span></span><br><span class="line">    temp_min: <span class="built_in">number</span></span><br><span class="line">  &#125;</span><br><span class="line">  weather: &#123;</span><br><span class="line">    description: <span class="built_in">string</span></span><br><span class="line">    icon: <span class="built_in">string</span></span><br><span class="line">    id: <span class="built_in">number</span></span><br><span class="line">    main: <span class="built_in">string</span></span><br><span class="line">  &#125;[]</span><br><span class="line">  wind: &#123;</span><br><span class="line">    deg: <span class="built_in">number</span></span><br><span class="line">    speed: <span class="built_in">number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定義欄位 type %?%</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> OpenWeatherTempScale = <span class="string">&#x27;metric&#x27;</span> | <span class="string">&#x27;imperial&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchOpenWeatherData</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  city: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  tempScale: OpenWeatherTempScale</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">OpenWeatherData</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(</span><br><span class="line">    <span class="string">`https://api.openweathermap.org/data/2.5/weather?q=<span class="subst">$&#123;city&#125;</span>&amp;units=<span class="subst">$&#123;tempScale&#125;</span>&amp;appid=<span class="subst">$&#123;OPEN_WEATHER_API_KEY&#125;</span>`</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!res.ok) &#123;</span><br><span class="line">    <span class="comment">// 建立自定義的 Error object  %?%</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;City not found&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 會傳回所有欄位,僅定義有使用之欄位type  %?%</span></span><br><span class="line">  <span class="keyword">const</span> data: OpenWeatherData = <span class="keyword">await</span> res.json()</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getWeatherIconSrc</span>(<span class="params">iconCode: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`https://openweathermap.org/img/wn/<span class="subst">$&#123;iconCode&#125;</span>@2x.png`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="storage-ts"><a href="#storage-ts" class="headerlink" title="storage.ts"></a>storage.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; OpenWeatherTempScale &#125; <span class="keyword">from</span> <span class="string">&#x27;./api&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set LocalStorage interface</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LocalStorage &#123;</span><br><span class="line">  cities?: <span class="built_in">string</span>[]</span><br><span class="line">  options?: LocalStorageOptions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> LocalStorageOptions &#123;</span><br><span class="line">  hasAutoOverlay: <span class="built_in">boolean</span></span><br><span class="line">  homeCity: <span class="built_in">string</span></span><br><span class="line">  tempScale: OpenWeatherTempScale</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> LocalStorageKeys = keyof LocalStorage</span><br><span class="line"></span><br><span class="line"><span class="comment">// set/get options</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setStoredCities</span>(<span class="params">cities: <span class="built_in">string</span>[]</span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vals: LocalStorage = &#123;</span><br><span class="line">    cities,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    chrome.storage.local.set(vals, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getStoredCities</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">string</span>[] | []&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> keys: LocalStorageKeys[] = [<span class="string">&#x27;cities&#x27;</span>]</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    chrome.storage.local.get(keys, <span class="function">(<span class="params">res: LocalStorage</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 若無 res.cities 傳回 [] %?%</span></span><br><span class="line">      resolve(res.cities ?? [])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set/get option</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setStoredOptions</span>(<span class="params">options: LocalStorageOptions</span>): <span class="title">Promise</span>&lt;<span class="title">void</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vals: LocalStorage = &#123;</span><br><span class="line">    options,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    chrome.storage.local.set(vals, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getStoredOptions</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">LocalStorageOptions</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> keys: LocalStorageKeys[] = [<span class="string">&#x27;options&#x27;</span>]</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    chrome.storage.local.get(keys, <span class="function">(<span class="params">res: LocalStorage</span>) =&gt;</span> &#123;</span><br><span class="line">      resolve(res.options)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="messages-ts"><a href="#messages-ts" class="headerlink" title="messages.ts"></a>messages.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="built_in">enum</span> Messages &#123;</span><br><span class="line">  TOGGLE_OVERLAY,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="components"><a href="#components" class="headerlink" title="components"></a>components</h4><h5 id="WeatherCard-tsx"><a href="#WeatherCard-tsx" class="headerlink" title="WeatherCard.tsx"></a>WeatherCard.tsx</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Box,</span><br><span class="line">  Button,</span><br><span class="line">  Card,</span><br><span class="line">  CardActions,</span><br><span class="line">  CardContent,</span><br><span class="line">  Grid,</span><br><span class="line">  Typography,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@mui/material&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getWeatherIconSrc,</span><br><span class="line">  fetchOpenWeatherData,</span><br><span class="line">  OpenWeatherData,</span><br><span class="line">  OpenWeatherTempScale,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/api&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./WearthCard.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WeatherCardContainer: React.FC&lt;&#123;</span><br><span class="line">  children: React.ReactNode</span><br><span class="line">  onDelete?: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;&gt; = <span class="function">(<span class="params">&#123; children, onDelete &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Box mx=&#123;<span class="string">&#x27;4px&#x27;</span>&#125; my=&#123;<span class="string">&#x27;16px&#x27;</span>&#125;&gt;</span><br><span class="line">      &lt;Card&gt;</span><br><span class="line">        &lt;CardContent&gt;&#123;children&#125;&lt;/CardContent&gt;</span><br><span class="line">        &lt;CardActions&gt;</span><br><span class="line">          &#123;onDelete &amp;&amp; (</span><br><span class="line">            &lt;Button color=<span class="string">&quot;secondary&quot;</span> onClick=&#123;onDelete&#125;&gt;</span><br><span class="line">              &lt;Typography className=<span class="string">&quot;weatherCard-body&quot;</span>&gt;Delete&lt;/Typography&gt;</span><br><span class="line">            &lt;/Button&gt;</span><br><span class="line">          )&#125;</span><br><span class="line">        &lt;/CardActions&gt;</span><br><span class="line">      &lt;/Card&gt;</span><br><span class="line">    &lt;/Box&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定義欄位 type %?%</span></span><br><span class="line">type WeatherCardState = <span class="string">&#x27;loading&#x27;</span> | <span class="string">&#x27;error&#x27;</span> | <span class="string">&#x27;ready&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WeatherCard: React.FC&lt;&#123;</span><br><span class="line">  city: string</span><br><span class="line">  tempScale: OpenWeatherTempScale</span><br><span class="line">  onDelete?: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;&gt; = <span class="function">(<span class="params">&#123; city, tempScale, onDelete &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [weatherData, setWeatherData] = useState&lt;OpenWeatherData | <span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> [cardState, setCardState] = useState&lt;WeatherCardState&gt;(<span class="string">&#x27;loading&#x27;</span>)</span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    fetchOpenWeatherData(city, tempScale)</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(data)</span></span><br><span class="line">        setWeatherData(data)</span><br><span class="line">        setCardState(<span class="string">&#x27;ready&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> setCardState(<span class="string">&#x27;error&#x27;</span>))</span><br><span class="line">  &#125;, [city, tempScale])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cardState == <span class="string">&#x27;loading&#x27;</span> || cardState == <span class="string">&#x27;error&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;WeatherCardContainer onDelete=&#123;onDelete&#125;&gt;</span><br><span class="line">        &lt;Typography className=<span class="string">&quot;weatherCrad-title&quot;</span>&gt;&#123;city&#125;&lt;/Typography&gt;</span><br><span class="line">        &lt;Typography className=<span class="string">&quot;weatherCard-body&quot;</span>&gt;</span><br><span class="line">          &#123;cardState == <span class="string">&#x27;loading&#x27;</span></span><br><span class="line">            ? <span class="string">&#x27;Loading...&#x27;</span></span><br><span class="line">            : <span class="string">&#x27;Error: could not retrive weather data for this city.&#x27;</span>&#125;</span><br><span class="line">        &lt;/Typography&gt;</span><br><span class="line">      &lt;/WeatherCardContainer&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;WeatherCardContainer onDelete=&#123;onDelete&#125;&gt;</span><br><span class="line">      &lt;Grid container justifyContent=<span class="string">&quot;space-around&quot;</span>&gt;</span><br><span class="line">        &lt;Grid item&gt;</span><br><span class="line">          &lt;Typography className=<span class="string">&quot;weatherCrad-title&quot;</span>&gt;</span><br><span class="line">            &#123;weatherData.name&#125;</span><br><span class="line">          &lt;/Typography&gt;</span><br><span class="line">          &lt;Typography className=<span class="string">&quot;weatherCard-temp&quot;</span>&gt;</span><br><span class="line">            &#123;<span class="built_in">Math</span>.round(weatherData.main.temp)&#125;</span><br><span class="line">          &lt;/Typography&gt;</span><br><span class="line">          &lt;Typography variant=<span class="string">&quot;body1&quot;</span>&gt;</span><br><span class="line">            Feels like: &#123;<span class="built_in">Math</span>.round(weatherData.main.feels_like)&#125;</span><br><span class="line">          &lt;/Typography&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">        &lt;Grid item&gt;</span><br><span class="line">          &#123;weatherData.weather.length &gt; <span class="number">0</span> &amp;&amp; (</span><br><span class="line">            &lt;&gt;</span><br><span class="line">              &lt;img src=&#123;getWeatherIconSrc(weatherData.weather[<span class="number">0</span>].icon)&#125; /&gt;</span><br><span class="line">              &lt;Typography className=<span class="string">&quot;weatherCard-body&quot;</span>&gt;</span><br><span class="line">                &#123;weatherData.weather[<span class="number">0</span>].main&#125;</span><br><span class="line">              &lt;/Typography&gt;</span><br><span class="line">            &lt;/&gt;</span><br><span class="line">          )&#125;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">      &lt;/Grid&gt;</span><br><span class="line">    &lt;/WeatherCardContainer&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> WeatherCard</span><br></pre></td></tr></table></figure>

<h5 id="WearthCard-css"><a href="#WearthCard-css" class="headerlink" title="WearthCard.css"></a>WearthCard.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.weatherCard-title</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">24px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.weatherCard-body</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: ecnter <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.weatherCard-temp</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">46px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: ecnter <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="options-3"><a href="#options-3" class="headerlink" title="options"></a>options</h4><h5 id="options-tsx-1"><a href="#options-tsx-1" class="headerlink" title="options.tsx"></a>options.tsx</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Box,</span><br><span class="line">  Button,</span><br><span class="line">  Card,</span><br><span class="line">  CardContent,</span><br><span class="line">  Grid,</span><br><span class="line">  Switch,</span><br><span class="line">  TextField,</span><br><span class="line">  Typography,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@mui/material&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@fontsource/roboto&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./options.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  LocalStorageOptions,</span><br><span class="line">  getStoredOptions,</span><br><span class="line">  setStoredOptions,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line">type FormState = <span class="string">&#x27;ready&#x27;</span> | <span class="string">&#x27;saving&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: React.FC&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [options, setOptions] = useState&lt;LocalStorageOptions | <span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> [formState, setFormState] = useState&lt;FormState&gt;(<span class="string">&#x27;ready&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getStoredOptions().then(<span class="function">(<span class="params">options</span>) =&gt;</span> setOptions(options))</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleHomeCityChange = <span class="function">(<span class="params">homeCity: string</span>) =&gt;</span> &#123;</span><br><span class="line">    setOptions(&#123;</span><br><span class="line">      ...options,</span><br><span class="line">      homeCity,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleAutoOverayChange = <span class="function">(<span class="params">hasAutoOverlay: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">    setOptions(&#123;</span><br><span class="line">      ...options,</span><br><span class="line">      hasAutoOverlay,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSaveButtonClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setFormState(<span class="string">&#x27;saving&#x27;</span>)</span><br><span class="line">    setStoredOptions(options).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setFormState(<span class="string">&#x27;ready&#x27;</span>)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!options) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> isFieldsDisabled = formState === <span class="string">&#x27;saving&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Box mx=<span class="string">&quot;10%&quot;</span> my=<span class="string">&quot;2%&quot;</span>&gt;</span><br><span class="line">      &lt;Card&gt;</span><br><span class="line">        &lt;CardContent&gt;</span><br><span class="line">          &lt;Grid container direction=<span class="string">&quot;column&quot;</span> spacing=<span class="string">&quot;10&quot;</span>&gt;</span><br><span class="line">            &lt;Grid item&gt;</span><br><span class="line">              &lt;Typography variant=<span class="string">&quot;h4&quot;</span>&gt;Weather Extension Options&lt;/Typography&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">            &lt;Grid item&gt;</span><br><span class="line">              &lt;Typography variant=<span class="string">&quot;body1&quot;</span>&gt;Home City name&lt;/Typography&gt;</span><br><span class="line">              &lt;TextField</span><br><span class="line">                fullWidth</span><br><span class="line">                placeholder=<span class="string">&quot;Enter a home city name&quot;</span></span><br><span class="line">                value=&#123;options.homeCity&#125;</span><br><span class="line">                onChange=&#123;<span class="function">(<span class="params">event</span>) =&gt;</span> handleHomeCityChange(event.target.value)&#125;</span><br><span class="line">                disabled=&#123;isFieldsDisabled&#125;</span><br><span class="line">                variant=<span class="string">&quot;standard&quot;</span></span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">            &lt;Grid item&gt;</span><br><span class="line">              &lt;Typography variant=<span class="string">&quot;body1&quot;</span>&gt;</span><br><span class="line">                Auto toggle overlay on webpage load</span><br><span class="line">              &lt;/Typography&gt;</span><br><span class="line">              &lt;Switch</span><br><span class="line">                color=<span class="string">&quot;primary&quot;</span></span><br><span class="line">                checked=&#123;options.hasAutoOverlay&#125;</span><br><span class="line">                onChange=&#123;<span class="function">(<span class="params">event, checked</span>) =&gt;</span> handleAutoOverayChange(checked)&#125;</span><br><span class="line">                disabled=&#123;isFieldsDisabled&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">            &lt;Grid item&gt;</span><br><span class="line">              &lt;Button</span><br><span class="line">                variant=<span class="string">&quot;contained&quot;</span></span><br><span class="line">                color=<span class="string">&quot;primary&quot;</span></span><br><span class="line">                onClick=&#123;handleSaveButtonClick&#125;</span><br><span class="line">                disabled=&#123;isFieldsDisabled&#125;</span><br><span class="line">              &gt;</span><br><span class="line">                &#123;formState === <span class="string">&#x27;ready&#x27;</span> ? <span class="string">&#x27;Save&#x27;</span> : <span class="string">&#x27;Saving...&#x27;</span>&#125;</span><br><span class="line">              &lt;/Button&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">          &lt;/Grid&gt;</span><br><span class="line">        &lt;/CardContent&gt;</span><br><span class="line">      &lt;/Card&gt;</span><br><span class="line">    &lt;/Box&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(rootElement)</span><br><span class="line"><span class="keyword">const</span> root = ReactDOM.createRoot(rootElement)</span><br><span class="line"></span><br><span class="line">root.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>)</span><br></pre></td></tr></table></figure>

<h5 id="options-css-3"><a href="#options-css-3" class="headerlink" title="options.css"></a>options.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Roboto&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="popup-4"><a href="#popup-4" class="headerlink" title="popup"></a>popup</h4><h5 id="popup-tsx-1"><a href="#popup-tsx-1" class="headerlink" title="popup.tsx"></a>popup.tsx</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Box, Grid, InputBase, Paper, IconButton &#125; <span class="keyword">from</span> <span class="string">&#x27;@mui/material&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Add <span class="keyword">as</span> AddIcon,</span><br><span class="line">  PictureInPicture <span class="keyword">as</span> PictureInPictureIcon,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@mui/icons-material&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@fontsource/roboto&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./popup.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> WeatherCard <span class="keyword">from</span> <span class="string">&#x27;../components/WeatherCard&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getStoredCities,</span><br><span class="line">  setStoredCities,</span><br><span class="line">  getStoredOptions,</span><br><span class="line">  setStoredOptions,</span><br><span class="line">  LocalStorageOptions,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/storage&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Messages &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/messages&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: React.FC&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [cities, setCities] = useState&lt;string[]&gt;([])</span><br><span class="line">  <span class="keyword">const</span> [cityInput, setCityInput] = useState&lt;string&gt;(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> [options, setOptions] = useState&lt;LocalStorageOptions | <span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getStoredCities().then(<span class="function">(<span class="params">cities</span>) =&gt;</span> setCities(cities))</span><br><span class="line">    getStoredOptions().then(<span class="function">(<span class="params">options</span>) =&gt;</span> setOptions(options))</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add city</span></span><br><span class="line">  <span class="keyword">const</span> handleCityButtonClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cityInput == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> updateCities = [...cities, cityInput]</span><br><span class="line">    setStoredCities(updateCities).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setCities(updateCities)</span><br><span class="line">      setCityInput(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// delete city</span></span><br><span class="line">  <span class="keyword">const</span> handleCityDeleteButtonClick = <span class="function">(<span class="params">index: number</span>) =&gt;</span> &#123;</span><br><span class="line">    cities.splice(index, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">const</span> updateCites = [...cities]</span><br><span class="line">    setStoredCities(updateCites).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setCities(updateCites)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// toggle show temperature type</span></span><br><span class="line">  <span class="keyword">const</span> handleTempScaleButtonClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> updateOptions: LocalStorageOptions = &#123;</span><br><span class="line">      ...options,</span><br><span class="line">      tempScale: options.tempScale === <span class="string">&#x27;metric&#x27;</span> ? <span class="string">&#x27;imperial&#x27;</span> : <span class="string">&#x27;metric&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    setStoredOptions(updateOptions).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      setOptions(updateOptions)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Overlay control</span></span><br><span class="line">  <span class="keyword">const</span> handleOverlayButtonClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// send message from current tab %?%</span></span><br><span class="line">    chrome.tabs.query(</span><br><span class="line">      &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        currentWindow: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      (tabs) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (tabs.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">// console.log(&#x27;tabs =&gt;&#x27;, tabs)</span></span><br><span class="line">          <span class="comment">// send when url = https://* %?%</span></span><br><span class="line">          <span class="comment">// 若未設定 在 chrome://extensions/ 或 blank tab 會有問題</span></span><br><span class="line">          <span class="comment">// need set tabs at &quot;permissions&quot; %?%</span></span><br><span class="line">          <span class="comment">// 未設定抓不到 url</span></span><br><span class="line">          <span class="keyword">if</span> (tabs[<span class="number">0</span>].url.match(<span class="string">&#x27;https://*&#x27;</span>)) &#123;</span><br><span class="line">            chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, Messages.TOGGLE_OVERLAY)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!options) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Box mx=<span class="string">&quot;8px&quot;</span> my=<span class="string">&quot;16px&quot;</span>&gt;</span><br><span class="line">      &lt;Grid container justifyContent=<span class="string">&quot;space-evenly&quot;</span>&gt;</span><br><span class="line">        &lt;Grid item&gt;</span><br><span class="line">          &lt;Paper&gt;</span><br><span class="line">            &lt;Box px=<span class="string">&quot;15px&quot;</span> py=<span class="string">&quot;5px&quot;</span>&gt;</span><br><span class="line">              &lt;InputBase</span><br><span class="line">                placeholder=<span class="string">&quot;Add a city name&quot;</span></span><br><span class="line">                value=&#123;cityInput&#125;</span><br><span class="line">                onChange=&#123;<span class="function">(<span class="params">event</span>) =&gt;</span> setCityInput(event.target.value)&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">              &lt;IconButton onClick=&#123;handleCityButtonClick&#125;&gt;</span><br><span class="line">                &lt;AddIcon /&gt;</span><br><span class="line">              &lt;/IconButton&gt;</span><br><span class="line">            &lt;/Box&gt;</span><br><span class="line">          &lt;/Paper&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">        &lt;Grid item&gt;</span><br><span class="line">          &lt;Paper&gt;</span><br><span class="line">            &lt;Box py=<span class="string">&quot;4px&quot;</span>&gt;</span><br><span class="line">              &lt;IconButton onClick=&#123;handleTempScaleButtonClick&#125;&gt;</span><br><span class="line">                &#123;<span class="comment">/* %?% options != null show 後面內容 */</span>&#125;</span><br><span class="line">                &#123;options != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                  (options.tempScale === <span class="string">&#x27;metric&#x27;</span> ? <span class="string">&#x27;\u2103&#x27;</span> : <span class="string">&#x27;\u2109&#x27;</span>)&#125;</span><br><span class="line">              &lt;/IconButton&gt;</span><br><span class="line">            &lt;/Box&gt;</span><br><span class="line">          &lt;/Paper&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">        &lt;Grid item&gt;</span><br><span class="line">          &lt;Paper&gt;</span><br><span class="line">            &lt;Box py=<span class="string">&quot;4px&quot;</span>&gt;</span><br><span class="line">              &lt;IconButton onClick=&#123;handleOverlayButtonClick&#125;&gt;</span><br><span class="line">                &lt;PictureInPictureIcon /&gt;</span><br><span class="line">              &lt;/IconButton&gt;</span><br><span class="line">            &lt;/Box&gt;</span><br><span class="line">          &lt;/Paper&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">      &lt;/Grid&gt;</span><br><span class="line">      &#123;options != <span class="literal">null</span> &amp;&amp; options.homeCity != <span class="string">&#x27;&#x27;</span> &amp;&amp; (</span><br><span class="line">        &lt;WeatherCard city=&#123;options.homeCity&#125; tempScale=&#123;options.tempScale&#125; /&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">      &#123;cities.map(<span class="function">(<span class="params">city, index</span>) =&gt;</span> (</span><br><span class="line">        &lt;WeatherCard</span><br><span class="line">          city=&#123;city&#125;</span><br><span class="line">          tempScale=&#123;options.tempScale&#125;</span><br><span class="line">          key=&#123;index&#125;</span><br><span class="line">          onDelete=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            handleCityDeleteButtonClick(index)</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">      &lt;Box height=<span class="string">&quot;16px&quot;</span>&gt; &lt;/Box&gt;</span><br><span class="line">    &lt;/Box&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(rootElement)</span><br><span class="line"><span class="keyword">const</span> root = ReactDOM.createRoot(rootElement)</span><br><span class="line"></span><br><span class="line">root.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>)</span><br></pre></td></tr></table></figure>


<h5 id="popup-css-4"><a href="#popup-css-4" class="headerlink" title="popup.css"></a>popup.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">360px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">512px</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Robot&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="contentScript"><a href="#contentScript" class="headerlink" title="contentScript"></a>contentScript</h4><h5 id="contentScript-tsx"><a href="#contentScript-tsx" class="headerlink" title="contentScript.tsx"></a>contentScript.tsx</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Card &#125; <span class="keyword">from</span> <span class="string">&#x27;@mui/material&#x27;</span></span><br><span class="line"><span class="keyword">import</span> WeatherCard <span class="keyword">from</span> <span class="string">&#x27;../components/WeatherCard&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getStoredOptions, LocalStorageOptions &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/storage&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Messages &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/messages&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./contentScript.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: React.FC&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [options, setOptions] = useState&lt;LocalStorageOptions | <span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> [isActive, setIsActive] = useState&lt;boolean&gt;(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getStoredOptions().then(<span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">      setOptions(options)</span><br><span class="line">      setIsActive(options.hasAutoOverlay)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// message receive %?%</span></span><br><span class="line">    chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(&#x27;msg:&#x27;, msg)</span></span><br><span class="line">      <span class="keyword">if</span> (msg == Messages.TOGGLE_OVERLAY) &#123;</span><br><span class="line">        setIsActive(!isActive)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [isActive])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!options) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &#123;isActive &amp;&amp; (</span><br><span class="line">        &lt;Card className=<span class="string">&quot;overlayCard&quot;</span>&gt;</span><br><span class="line">          &lt;WeatherCard</span><br><span class="line">            city=&#123;options.homeCity&#125;</span><br><span class="line">            tempScale=&#123;options.tempScale&#125;</span><br><span class="line">            onDelete=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              setIsActive(<span class="literal">false</span>)</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Card&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(rootElement)</span><br><span class="line"><span class="keyword">const</span> root = ReactDOM.createRoot(rootElement)</span><br><span class="line"></span><br><span class="line">root.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>)</span><br></pre></td></tr></table></figure>

<h5 id="contentScript-css-1"><a href="#contentScript-css-1" class="headerlink" title="contentScript.css"></a>contentScript.css</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.overlayCard</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">5%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">15%</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">240px</span>;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">240px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">99999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AdBlock-Extension"><a href="#AdBlock-Extension" class="headerlink" title="AdBlock Extension"></a>AdBlock Extension</h3><h4 id="說明-2"><a href="#說明-2" class="headerlink" title="說明"></a>說明</h4><h5 id="API"><a href="#API" class="headerlink" title="API"></a>API</h5><ul>
<li>chrome.webRequest : 分析,攔截,中斷,處理 traffic</li>
</ul>
<h4 id="install-1"><a href="#install-1" class="headerlink" title="install"></a>install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># remove popup and options</span></span><br><span class="line"><span class="comment"># change &quot;manifest_version&quot;: 2 - webRequestBlocking not support by version 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://www.nytimes.com/section/opinion/editorials</span></span><br><span class="line"></span><br><span class="line">npm i</span><br></pre></td></tr></table></figure>

<h4 id="version-2-1"><a href="#version-2-1" class="headerlink" title="version 2"></a>version 2</h4><h5 id="manifest-json-11"><a href="#manifest-json-11" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;manifest_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;AdBlock Extension&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Chrome Extension for AdBlock&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;webRequest&quot;</span>,</span><br><span class="line">		<span class="string">&quot;webRequestBlocking&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&lt;all_urls&gt;&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;matches&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;&lt;all_urls&gt;&quot;</span></span><br><span class="line">			],</span><br><span class="line">			<span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;contentScript.js&quot;</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="background-ts-3"><a href="#background-ts-3" class="headerlink" title="background.ts"></a>background.ts</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">chrome.webRequest.onBeforeRequest.addListener(</span><br><span class="line">  (details) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> url = details.url</span><br><span class="line">    <span class="keyword">const</span> filters = [<span class="string">&#x27;gooleadserves&#x27;</span>, <span class="string">&#x27;googlesyndication&#x27;</span>, <span class="string">&#x27;g.doubleclick&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> filter <span class="keyword">of</span> filters) &#123;</span><br><span class="line">      <span class="keyword">if</span> (url.indexOf(filter) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// print ==&gt; https://securepubads.g.doubleclick.net/tag/js/gpt.js</span></span><br><span class="line">        <span class="built_in">console</span>.log(url)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          cancel: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      cancel: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(&#x27;details:&#x27;, details)</span></span><br><span class="line">    <span class="comment">// set block</span></span><br><span class="line">    <span class="comment">// return &#123;</span></span><br><span class="line">    <span class="comment">//   cancel: true,</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// block all</span></span><br><span class="line">    urls: [<span class="string">&#x27;&lt;all_urls&gt;&#x27;</span>],</span><br><span class="line">    <span class="comment">// no block</span></span><br><span class="line">    <span class="comment">// urls: [&#x27;&#x27;],</span></span><br><span class="line">    <span class="comment">// define block</span></span><br><span class="line">    <span class="comment">// urls: [</span></span><br><span class="line">    <span class="comment">//   &#x27;&lt;all_urls&gt;&#x27;,</span></span><br><span class="line">    <span class="comment">//   &#x27;*://*.gooleadserves.com/*&#x27;,</span></span><br><span class="line">    <span class="comment">//   &#x27;*://*.tpc.googlesyndication.com/*&#x27;,</span></span><br><span class="line">    <span class="comment">//   &#x27;*://googleads.g.doubleclick.net/*&#x27;,</span></span><br><span class="line">    <span class="comment">//   &#x27;*://tpc.googlesyndication.com/*&#x27;,</span></span><br><span class="line">    <span class="comment">// ],</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="string">&#x27;blocking&#x27;</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="version-3"><a href="#version-3" class="headerlink" title="version 3"></a>version 3</h4><h5 id="manifest-json-12"><a href="#manifest-json-12" class="headerlink" title="manifest.json"></a>manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;AdBlock Extension&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Chrome Extension for AdBlock&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;declarativeNetRequest&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;declarative_net_request&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;rule_resources&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">&quot;id&quot;</span>: <span class="string">&quot;ruleset_1&quot;</span>,</span><br><span class="line">				<span class="attr">&quot;enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">				<span class="attr">&quot;path&quot;</span>: <span class="string">&quot;rules_1.json&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;matches&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;&lt;all_urls&gt;&quot;</span></span><br><span class="line">			],</span><br><span class="line">			<span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;contentScript.js&quot;</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="rules-1-json"><a href="#rules-1-json" class="headerlink" title="rules_1.json"></a>rules_1.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;priority&quot;</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;type&quot;</span>: <span class="string">&quot;block&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">&quot;condition&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;urlFilter&quot;</span>: <span class="string">&quot;googlesyndication&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;resourceTypes&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;image&quot;</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;priority&quot;</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;type&quot;</span>: <span class="string">&quot;block&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">&quot;condition&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;urlFilter&quot;</span>: <span class="string">&quot;googleadservices&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;resourceTypes&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;image&quot;</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;priority&quot;</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">&quot;action&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;type&quot;</span>: <span class="string">&quot;block&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">&quot;condition&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;urlFilter&quot;</span>: <span class="string">&quot;doubleclick&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;resourceTypes&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;image&quot;</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="version-block-by-JS"><a href="#version-block-by-JS" class="headerlink" title="version block by JS"></a>version block by JS</h4><h5 id="manifest-json-“enabled”-false-不使用-declarativeNetRequest"><a href="#manifest-json-“enabled”-false-不使用-declarativeNetRequest" class="headerlink" title="manifest.json (“enabled”: false 不使用 declarativeNetRequest)"></a>manifest.json (“enabled”: false 不使用 declarativeNetRequest)</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">	<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;AdBlock Extension&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Chrome Extension for AdBlock&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon.png&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon.png&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;declarativeNetRequest&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;declarative_net_request&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;rule_resources&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">&quot;id&quot;</span>: <span class="string">&quot;ruleset_1&quot;</span>,</span><br><span class="line">				<span class="attr">&quot;enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">				<span class="attr">&quot;path&quot;</span>: <span class="string">&quot;rules_1.json&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;matches&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;&lt;all_urls&gt;&quot;</span></span><br><span class="line">			],</span><br><span class="line">			<span class="attr">&quot;js&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;contentScript.js&quot;</span></span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="contentScript-tsx-1"><a href="#contentScript-tsx-1" class="headerlink" title="contentScript.tsx"></a>contentScript.tsx</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// remove ad by JavaScript</span></span><br><span class="line"><span class="comment">// set to &quot;enabled&quot;: false,</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// &quot;declarative_net_request&quot;: &#123;</span></span><br><span class="line"><span class="comment">// 	&quot;rule_resources&quot;: [</span></span><br><span class="line"><span class="comment">// 		&#123;</span></span><br><span class="line"><span class="comment">// 			&quot;id&quot;: &quot;ruleset_1&quot;,</span></span><br><span class="line"><span class="comment">// 			&quot;enabled&quot;: false,</span></span><br><span class="line"><span class="comment">// 			&quot;path&quot;: &quot;rules_1.json&quot;</span></span><br><span class="line"><span class="comment">// 		&#125;</span></span><br><span class="line"><span class="comment">// 	]</span></span><br><span class="line"><span class="comment">// &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 對特定網頁執行特定功能 %?%</span></span><br><span class="line"><span class="keyword">const</span> rules: &#123;</span><br><span class="line">  [url: string]: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125; = &#123;</span><br><span class="line">  <span class="string">&#x27;https://www.nytimes.com/section/opinion/editorials&#x27;</span>:</span><br><span class="line">    filterNYTOpinionEeditorials2,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// block by id</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterNYTOpinionEeditorials</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;site-content&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> wrapper = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;top-wrapper&#x27;</span>)</span><br><span class="line">  app.removeChild(wrapper)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// block by class</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterNYTOpinionEeditorials2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> divs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> div <span class="keyword">of</span> divs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (div.className.indexOf(<span class="string">&#x27;ad&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">      div.style.display = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.URL <span class="keyword">in</span> rules) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;document.URL:&#x27;</span>, <span class="built_in">document</span>.URL)</span><br><span class="line">  rules[<span class="built_in">document</span>.URL]()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev axios</span><br><span class="line">npm i --save-dev striptags</span><br></pre></td></tr></table></figure>



<h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h3><ul>
<li><p>Basic ref</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/mv3/manifest/">Manifest file format</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/reference/storage/">chrome.storage</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/webstore/i18n/#choosing-locales-to-support">chrome - Choose locales to support</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/showNotification">ServiceWorkerRegistration</a></li>
</ul>
</li>
<li><p>TV shwo extension ref</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/reference/">API reference</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/">Content scripts</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a></li>
<li><a target="_blank" rel="noopener" href="https://www.tvmaze.com/api#show-search">TVMAZE</a></li>
</ul>
</li>
<li><p>React extension ref</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/terminal/basics#_windows">VS Code Terminal Basics</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/JasonXian/react-chrome-extension-boilerplate">Boilerplate Github Link</a></li>
<li><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/tsconfig">TypeScript tsconfig documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/getting-started.html">React documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.js.org/concepts/">Webpack documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/chrome">DefinitelyTyped chrome extension types</a></li>
</ul>
</li>
<li><p>Weather Extension</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://openweathermap.org/api">Open Weather API</a></li>
<li><a target="_blank" rel="noopener" href="https://material-ui.com/getting-started/installation/">Material UI components</a></li>
<li><a target="_blank" rel="noopener" href="https://openweathermap.org/weather-conditions">Open Weather API weather conditions reference</a></li>
<li><a target="_blank" rel="noopener" href="https://www.flaticon.com/">Source for weather icon</a></li>
</ul>
</li>
<li><p>AdBlock Extension</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/reference/">Chrome extension APIs reference</a></li>
<li><a target="_blank" rel="noopener" href="https://easylist.to/">Easy List</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gorhill/uBlock">uBlock Origin source code:</a></li>
<li><a target="_blank" rel="noopener" href="https://gitlab.com/eyeo/adblockplus">Adblock Plus source code</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.chromium.org/2019/06/web-request-and-declarative-net-request.html">Chromium blog about new net request API</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xda-developers.com/google-chrome-manifest-v3-ad-blocker-extension-api/">XDA developers blog about new request API</a></li>
</ul>
</li>
<li><p>chrome extension publish</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/webstore/register/">Chrome developer documentation for publishing</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/devconsole/">Chrome Web Store dev console</a></li>
</ul>
</li>
<li><p>Common</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.freecodecamp.org/news/using-typescript-in-react-apps/">How to Use TypeScript in React Apps</a></li>
<li><a target="_blank" rel="noopener" href="https://willh.gitbook.io/typescript-tutorial/">TypeScript 新手指南</a></li>
<li><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/">TypeScript</a></li>
<li><a target="_blank" rel="noopener" href="https://react.dev/reference/react">React</a></li>
<li><a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react">React Chinese</a></li>
<li><a target="_blank" rel="noopener" href="https://zh-hant.legacy.reactjs.org/docs/hooks-state.html">使用 State Hook - old</a></li>
<li><a target="_blank" rel="noopener" href="https://www.w3schools.com/jsref/dom_obj_document.asp">W3school HTML DOM Documents</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Guide/Using_promises">MDN 使用 Promise</a></li>
<li><a target="_blank" rel="noopener" href="https://icons8.com/">ICONS8</a></li>
<li><a target="_blank" rel="noopener" href="https://hackernoon.com/">HACKERNOON</a></li>
<li><a target="_blank" rel="noopener" href="https://www.javascripttutorial.net/">JavaScript Tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://doc.yilijishu.info/chrome/">Chrome 扩展V3 中文文档</a></li>
<li><a target="_blank" rel="noopener" href="https://ssshooter.com/2020-08-26-chrome-extension/">Chrome插件開發全攻略</a></li>
</ul>
</li>
<li><p>publish</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/webstore/register/">Register your developer account</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/devconsole/register?hl=en">Register as a Chrome Web Store Developer</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/easy-clipboard/lkpiolleljimgohflbgekkbeoiajighj?hl=zh-TW">Easy Clipboard</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/nflxmultisubs-netflix-mul/pjhnilfooknlkdonmjnleaomamfehkli?hl=zh-TW">NflxMultiSubs</a></li>
</ul>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/chrome/" rel="tag"># chrome</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/04/28/udemy-1/" rel="prev" title="Udemy">
                  <i class="fa fa-chevron-left"></i> Udemy
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/05/26/devops-1/" rel="next" title="devops-1">
                  devops-1 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Robert Kao</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="總字數">2.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="所需總閱讀時間">41:16</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 強力驅動
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  




  


<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://hot5656-blog.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://hot5656.github.io/2023/05/23/chrome-3/";
    this.page.identifier = "2023/05/23/chrome-3/";
    this.page.title = "Chrome Extension";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://hot5656-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
